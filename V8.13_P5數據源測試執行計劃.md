# V8.13 P5數據源測試執行計劃

**日期**：2026-01-19  
**當前進度**：數據源 P5測試  
**測試方式**：逐步執行，一步一步來

---

## 📋 測試架構回顧

根據討論的測試架構，P5數據源測試包含：

### 三大新聞管線測試
1. **第一大：一般當日新聞的宏觀數據（A-F大類）**
2. **第二大：一般當日新聞的個股相關數據**（已建立個股新聞索引）
3. **第三大：機構評級新聞管線**

### 測試重點
- ✅ 時效性（`is_today_news`判斷）
- ✅ 正確性（數據驗證機制）
- ✅ 準確度（分類標籤正確）
- ✅ 雜訊過濾（Flash清洗）
- ✅ 多語去重（Gemini Pro去重）
- ✅ 分類正確（多維度標籤系統）
- ✅ 索引正確（個股新聞索引建立）
- ✅ 資料庫頁面正確（表格結構）
- ✅ 程式計算部分正確（波動度、驗證標記等）
- ✅ **確認有確實引用給Weekly決策系統和動態學習系統**

---

## 🎯 測試執行計劃（逐步進行）

### 第一步：數據源測試（Daily市場數據）

**測試按鍵**：`🧪 數據源測試（Daily市場數據）`

**測試內容**：
1. 宏觀數據收集（油價、貴金屬、匯率、國債利率、VIX等）
2. 所有 Tier 1 + Tier 2 數據（V8.12 新增）
3. 數據完整性檢查

**執行步驟**：
1. 點擊選單：`🚀 Nuclear Project` → `🧪 數據源測試（Daily市場數據）`
2. 確認對話框後，系統開始測試
3. 查看測試結果對話框
4. 查看 Logger 日誌（詳細執行過程）

**需要回傳的結果**：
- [ ] 測試結果對話框內容（截圖或文字）
- [ ] Logger 日誌（關鍵部分）
- [ ] 是否有錯誤訊息？
- [ ] 收集到的數據數量是否符合預期？

---

### 第二步：一般新聞源測試（一般當日新聞）

**測試按鍵**：`📰 一般新聞源測試（一般當日新聞）`

**測試內容**：
1. 新聞收集數量：英文50則、中文25則、日文25則
2. 時效性：測試模式放寬到前一天
3. Flash清洗：雜訊過濾、時效性檢查
4. Gemini Pro：多語去重、多維度標籤分類
5. 驗證機制：數據驗證、Proxy驗證
6. 個股索引：建立反向索引
7. 資料庫頁面：確認`NEWS_ATOMS_DAILY`表格正確寫入

**執行步驟**：
1. 點擊選單：`🚀 Nuclear Project` → `📰 一般新聞源測試（一般當日新聞）`
2. 確認對話框後，系統開始測試
3. 查看測試結果對話框
4. 查看 Logger 日誌（詳細執行過程）
5. 檢查`NEWS_ATOMS_DAILY`表格是否有新數據寫入

**需要回傳的結果**：
- [ ] 測試結果對話框內容（截圖或文字）
- [ ] Logger 日誌（關鍵部分）
- [ ] 是否有錯誤訊息？
- [ ] 收集到的新聞數量（英文/中文/日文各多少？）
- [ ] Flash清洗後保留多少則新聞？
- [ ] Gemini Pro去重後保留多少則新聞？
- [ ] 多維度標籤是否正確（Event Type、Impact Scope、Sentiment Polarity、Related Tickers）？
- [ ] 驗證標記是否正確（DATA_TYPE、DATA_RECENCY、DATA_COHERENCE等）？
- [ ] `NEWS_ATOMS_DAILY`表格是否有新數據寫入？
- [ ] 個股新聞索引是否建立（`STOCK_NEWS_INDEX_DAILY`表格）？

---

### 第三步：機構評級源測試（機構評級新聞）

**測試按鍵**：`⭐ 機構評級源測試（機構評級新聞）`

**測試內容**：
1. 機構評級收集（各市場五大龍頭機構）
2. 時效性檢查
3. Flash清洗：雜訊過濾
4. Gemini Pro：多語去重
5. 機構名稱標準化
6. 評級動作標準化
7. 資料庫頁面：確認`INSTITUTIONAL_RATINGS_DAILY`表格正確寫入

**執行步驟**：
1. 點擊選單：`🚀 Nuclear Project` → `⭐ 機構評級源測試（機構評級新聞）`
2. 確認對話框後，系統開始測試
3. 查看測試結果對話框
4. 查看 Logger 日誌（詳細執行過程）
5. 檢查`INSTITUTIONAL_RATINGS_DAILY`表格是否有新數據寫入

**需要回傳的結果**：
- [ ] 測試結果對話框內容（截圖或文字）
- [ ] Logger 日誌（關鍵部分）
- [ ] 是否有錯誤訊息？
- [ ] 收集到的機構評級數量？
- [ ] 機構名稱是否正確標準化？
- [ ] 評級動作是否正確標準化？
- [ ] `INSTITUTIONAL_RATINGS_DAILY`表格是否有新數據寫入？

---

## 📝 測試檢查清單

### 數據源測試檢查項目
- [ ] 宏觀數據收集是否完整（商品、匯率、國債、指數）
- [ ] Tier 1 數據是否收集（TLT.VOL、LQD、RSP等）
- [ ] Tier 2 數據是否收集（BITO/IBIT、XME、LIT、REMX、URA、TAN、XLK、SOXX/SMH、IGV等）
- [ ] 數據格式是否正確
- [ ] 是否有缺值或錯誤標記

### 一般新聞源測試檢查項目
- [ ] 新聞收集數量是否符合預期（英文50、中文25、日文25）
- [ ] Flash清洗是否正確過濾雜訊
- [ ] 時效性檢查是否正確（測試模式放寬到前一天）
- [ ] Gemini Pro去重是否正確（多語版本合併）
- [ ] 多維度標籤是否正確：
  - [ ] Event Type（事件屬性）
  - [ ] Impact Scope（影響層級：GLOBAL/SECTOR/STOCK）
  - [ ] Sentiment Polarity（情緒極性）
  - [ ] Related Tickers（關聯股票代碼）
- [ ] 驗證標記是否正確：
  - [ ] DATA_TYPE（HARD/SEMI/NARRATIVE）
  - [ ] DATA_RECENCY（OK/STALE/UNCLEAR）
  - [ ] DATA_COHERENCE（CONSISTENT/QUESTIONABLE/INCONSISTENT）
  - [ ] DATA_VERIFICATION（VERIFIED/NOT_VERIFIED/NOT_APPLICABLE）
- [ ] 個股新聞索引是否建立（`STOCK_NEWS_INDEX_DAILY`表格）
- [ ] 資料庫頁面是否正確寫入（`NEWS_ATOMS_DAILY`表格）

### 機構評級源測試檢查項目
- [ ] 機構評級收集是否完整（各市場五大龍頭機構）
- [ ] Flash清洗是否正確過濾雜訊
- [ ] Gemini Pro去重是否正確
- [ ] 機構名稱是否正確標準化（如`GOLDMAN_SACHS`）
- [ ] 評級動作是否正確標準化
- [ ] 資料庫頁面是否正確寫入（`INSTITUTIONAL_RATINGS_DAILY`表格）
- [ ] 是否按機構分開存儲（`rating_firm`欄位）

---

## 🚀 開始測試

**請先執行第一步：數據源測試（Daily市場數據）**

1. 打開 Google Sheets
2. 點擊選單：`🚀 Nuclear Project` → `🧪 數據源測試（Daily市場數據）`
3. 確認對話框後開始測試
4. 等待測試完成
5. **回傳測試結果**（對話框內容、Logger日誌、是否有錯誤）

**完成第一步後，我們再進行第二步。**
