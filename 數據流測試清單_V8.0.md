# 數據流測試清單 V8.0

**建立日期**：2026-01-16  
**目的**：測試所有數據收集是否正常（CSE 白名單或爬蟲），檢查資料正確性和筆數合理性

---

## 📋 測試原則

1. **測試所有數據收集點**：
   - CSE 白名單搜尋
   - 爬蟲（UrlFetchApp）
   - API 調用

2. **檢查項目**：
   - ✅ 數據能否正常搜尋到
   - ✅ 資料正確性（格式、數值範圍）
   - ✅ 筆數合理性（不應為 0，不應過多）

3. **測試順序**：
   - 按照 Phase 順序測試
   - 先測試基礎數據收集，再測試依賴數據

---

## 📊 數據收集點清單

### P2：基本面財務分析

#### 1. P2 財務數據收集（CSE 白名單）

**測試項目**：
- ✅ **美股/台股財務數據**（P2_US_TAIWAN CSE - 財報狗）
  - 測試股票：AAPL（美股）、2330（台股）
  - 檢查項目：
    - CSE 搜尋是否成功
    - 搜尋結果筆數（應 >= 3）
    - 財務指標提取是否成功（ROE、ROA、毛利率、負債比等）
    - 數據格式是否正確

- ✅ **日股財務數據**（P2_JAPAN CSE - buffet code）
  - 測試股票：7203（日股）
  - 檢查項目：
    - CSE 搜尋是否成功
    - 搜尋結果筆數（應 >= 3）
    - 財務指標提取是否成功
    - 數據格式是否正確

**測試函數**：
- `collectFinancialDataForCompanies()` - 主函數
- `searchFinancialDataWithCSE()` - CSE 搜尋
- `extractFinancialIndicators()` - 指標提取

**預期結果**：
- 每個股票應有 >= 3 筆搜尋結果
- 財務指標應完整提取（至少 5 個指標）
- 數據格式應符合預期（數字、百分比等）

---

#### 2. P2 同業數據收集（CSE 白名單）

**測試項目**：
- ✅ **同業財務數據**（使用相同 CSE）
  - 測試股票：AAPL（美股）
  - 同業：MSFT, GOOGL, AMZN（美股）
  - 檢查項目：
    - 同業識別是否正確（AI Stage 1）
    - 同業數據收集是否成功（程式 Stage 2）
    - 同業數據筆數（應 >= 3 家）
    - 數據來源是否一致（都來自 P2_US_TAIWAN CSE）

**測試函數**：
- `collectPeerFinancialData()` - 同業數據收集
- `calculateRelativePositions()` - 相對位置計算

**預期結果**：
- 應識別出 3-5 家同業
- 同業數據應完整收集
- 相對位置計算應正確（前段/中段/後段）

---

### P2.5：機構級籌碼分析

#### 3. P2.5 機構數據收集（CSE 白名單）

**測試項目**：
- ✅ **13F 持倉數據**（INSTITUTIONAL_DATA CSE - SEC EDGAR）
  - 測試股票：AAPL（美股）
  - 檢查項目：
    - CSE 搜尋是否成功
    - 搜尋結果筆數（應 >= 1）
    - 13F 數據提取是否成功

- ✅ **內部人交易數據**（INSTITUTIONAL_DATA CSE - SEC EDGAR）
  - 測試股票：AAPL（美股）
  - 檢查項目：
    - CSE 搜尋是否成功
    - Form 4 數據提取是否成功

- ✅ **Dark Pool 活動**（INSTITUTIONAL_DATA CSE）
  - 測試股票：AAPL（美股）
  - 檢查項目：
    - CSE 搜尋是否成功
    - Dark Pool 數據提取是否成功

**測試函數**：
- `collectInstitutionalData()` - 機構數據收集
- `searchInstitutionalDataWithCSE()` - CSE 搜尋

**預期結果**：
- 13F 數據應有 >= 1 筆結果
- 內部人交易數據應有 >= 1 筆結果
- Dark Pool 數據應有 >= 1 筆結果

---

### P3：技術面分析

#### 4. P3 歷史 OHLCV 數據收集（白名單數據源）

**測試項目**：
- ✅ **美股/日股 OHLCV**（stooq.com - Cloud Function 代理）
  - 測試股票：AAPL（美股）、7203（日股）
  - 檢查項目：
    - 數據獲取是否成功
    - 歷史數據筆數（應 >= 252 筆，1 年）
    - 數據格式是否正確（OHLCV）

- ✅ **台股 OHLCV**（TAIWAN_STOCK CSE - TWSE/TPEX）
  - 測試股票：2330（台股）
  - 檢查項目：
    - CSE 搜尋是否成功
    - 歷史數據筆數（應 >= 252 筆）
    - 數據格式是否正確

**測試函數**：
- `getHistoricalOHLCV()` - 歷史 OHLCV 獲取
- `collectOHLCVFromStooq()` - stooq.com 數據收集
- `collectOHLCVFromTWSE()` - 台股數據收集

**預期結果**：
- 歷史數據應有 >= 252 筆（1 年）
- 數據格式應正確（Date, Open, High, Low, Close, Volume）
- 數據應按日期排序

---

#### 5. P3 技術指標數據（從表格讀取）

**測試項目**：
- ✅ **技術指標讀取**（MARKET_INDICATORS_DAILY 表格）
  - 測試股票：AAPL（美股）
  - 檢查項目：
    - 表格讀取是否成功
    - 技術指標是否完整（RSI, MACD, ATR, MA 等）
    - 數據時效性（應為最新）

**測試函數**：
- `getTechnicalIndicators()` - 技術指標讀取

**預期結果**：
- 技術指標應完整（至少 5 個指標）
- 數據應為最新（當天或前一天）

---

### P5 Daily：數據監控

#### 6. P5 Daily 新聞收集（CSE 白名單）

**測試項目**：
- ✅ **多語新聞收集**（P5_NEWS CSE）
  - 測試關鍵字："Apple earnings"（英文）、"台積電"（中文）
  - 檢查項目：
    - CSE 搜尋是否成功
    - 搜尋結果筆數（應 >= 5）
    - 新聞來源是否在白名單內
    - 多語新聞是否都能收集到

**測試函數**：
- `collectNewsWithCSE()` - 新聞收集
- `searchNewsWithCSE()` - CSE 搜尋

**預期結果**：
- 每個關鍵字應有 >= 5 筆結果
- 新聞來源應在白名單內
- 多語新聞應都能收集到

---

#### 7. P5 Daily 宏觀數據收集（stooq.com）

**測試項目**：
- ✅ **宏觀數據**（stooq.com - Cloud Function 代理）
  - 測試項目：油價、貴金屬、匯率、國債利率、VIX
  - 檢查項目：
    - 數據獲取是否成功
    - 數據格式是否正確
    - 數據時效性（應為最新）

**測試函數**：
- `collectMacroData()` - 宏觀數據收集
- `getMacroDataFromStooq()` - stooq.com 數據獲取

**預期結果**：
- 所有宏觀數據應成功獲取
- 數據格式應正確（數字、百分比等）
- 數據應為最新（當天）

---

#### 8. P5 Daily OHLCV 數據收集（白名單數據源）

**測試項目**：
- ✅ **美股/日股 OHLCV**（stooq.com - Cloud Function 代理）
  - 測試股票：AAPL（美股）、7203（日股）
  - 檢查項目：
    - 數據獲取是否成功
    - 數據格式是否正確（OHLCV）
    - 數據時效性（應為最新）

- ✅ **台股 OHLCV**（TAIWAN_STOCK CSE - TWSE/TPEX）
  - 測試股票：2330（台股）
  - 檢查項目：
    - CSE 搜尋是否成功
    - 數據格式是否正確
    - 數據時效性（應為最新）

**測試函數**：
- `collectOHLCVData()` - OHLCV 數據收集
- `collectOHLCVFromStooq()` - stooq.com 數據收集
- `collectOHLCVFromTWSE()` - 台股數據收集

**預期結果**：
- 所有股票應成功獲取 OHLCV 數據
- 數據格式應正確
- 數據應為最新（當天）

---

#### 9. P5 Daily 衍生品數據收集（爬蟲）

**測試項目**：
- ✅ **期權數據**（爬蟲 - 多個數據源）
  - 測試項目：VIX, SKEW, Put/Call Ratio, IV
  - 檢查項目：
    - 數據獲取是否成功
    - 數據格式是否正確
    - 數據時效性（應為最新）

**測試函數**：
- `collectDerivativesData()` - 衍生品數據收集
- `getVIXData()` - VIX 數據獲取
- `getPutCallRatio()` - Put/Call Ratio 獲取

**預期結果**：
- 所有衍生品數據應成功獲取
- 數據格式應正確
- 數據應為最新（當天）

---

### P5 Weekly：策略制定

#### 10. P5 Weekly FPE_B 數據收集（爬蟲）

**測試項目**：
- ✅ **FPE_B 數據**（Yahoo Finance 爬蟲）
  - 測試股票：AAPL（美股）、2330.TW（台股）、7203.T（日股）
  - 檢查項目：
    - 爬蟲是否成功
    - FPE_B 值是否合理（應 > 0）
    - 數據格式是否正確（數字）

**測試函數**：
- `collectMarketSentimentIndicators()` - 市場情緒指標收集
- `getFPE_B_FromYahooFinance()` - Yahoo Finance 爬蟲
- `parseYahooForwardPE()` - 解析 Forward P/E
- `parseYahooAnalysisPage()` - 解析分析師共識 EPS

**預期結果**：
- 所有股票應成功獲取 FPE_B
- FPE_B 值應合理（> 0，通常在 5-50 之間）
- 數據格式應正確（數字）

---

#### 11. P5 Weekly Sector ETF Flow 數據收集（CSE 白名單）

**測試項目**：
- ✅ **Sector ETF Flow**（P5_SECTOR_ETF CSE）
  - 測試 ETF：XLK（科技）、XLE（能源）
  - 檢查項目：
    - CSE 搜尋是否成功
    - 搜尋結果筆數（應 >= 1）
    - ETF Flow 數據提取是否成功

**測試函數**：
- `collectSectorETFFlowData()` - Sector ETF Flow 收集
- `analyzeSectorETFFlows()` - Sector ETF Flow 分析

**預期結果**：
- 每個 ETF 應有 >= 1 筆結果
- ETF Flow 數據應成功提取

---

## 🔍 測試方法

### 步驟 1：準備測試數據

1. **準備測試股票清單**：
   - 美股：AAPL, MSFT, GOOGL
   - 台股：2330, 2317
   - 日股：7203, 6758

2. **準備測試關鍵字**：
   - 新聞：公司名稱、財報關鍵字
   - 宏觀：油價、VIX、匯率

### 步驟 2：執行測試

1. **逐個測試數據收集點**：
   - 按照清單順序測試
   - 記錄每個測試的結果

2. **檢查結果**：
   - 數據是否成功獲取
   - 數據格式是否正確
   - 數據筆數是否合理

### 步驟 3：記錄問題

1. **記錄失敗的測試**：
   - 失敗原因
   - 錯誤訊息
   - 建議修正方案

2. **記錄異常的測試**：
   - 數據筆數異常（0 筆或過多）
   - 數據格式異常
   - 數據時效性異常

---

## ✅ 測試檢查表

### P2 數據收集

- [ ] P2 美股財務數據（CSE）
- [ ] P2 台股財務數據（CSE）
- [ ] P2 日股財務數據（CSE）
- [ ] P2 同業數據收集（CSE）

### P2.5 數據收集

- [ ] P2.5 13F 持倉數據（CSE）
- [ ] P2.5 內部人交易數據（CSE）
- [ ] P2.5 Dark Pool 活動（CSE）

### P3 數據收集

- [ ] P3 美股/日股歷史 OHLCV（stooq.com）
- [ ] P3 台股歷史 OHLCV（CSE）
- [ ] P3 技術指標讀取（表格）

### P5 Daily 數據收集

- [ ] P5 Daily 新聞收集（CSE）
- [ ] P5 Daily 宏觀數據（stooq.com）
- [ ] P5 Daily 美股/日股 OHLCV（stooq.com）
- [ ] P5 Daily 台股 OHLCV（CSE）
- [ ] P5 Daily 衍生品數據（爬蟲）

### P5 Weekly 數據收集

- [ ] P5 Weekly FPE_B 數據（爬蟲）
- [ ] P5 Weekly Sector ETF Flow（CSE）

---

## 📝 測試結果記錄格式

```
測試項目：[項目名稱]
測試時間：[日期時間]
測試股票/關鍵字：[測試對象]
測試結果：[成功/失敗]
數據筆數：[筆數]
數據格式：[正確/異常]
異常說明：[如有]
```

---

**下一步**：開始執行數據流測試，按照清單逐個測試。
