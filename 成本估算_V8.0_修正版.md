# 成本估算 V8.0（修正版 - 基於實際功能檢查）

**更新日期**：2026-01-17  
**修正原因**：根據實際功能檢查，修正 P5 Daily 和 P3 週度的成本估算  
**批次規模調整**：AI 分析批次從 5-8 家/批改為 5-6 家/批（P3/P5 Weekly 策略）  
**模型配置**：方案 B（考慮成本，平衡方案）

---

## 📊 執行摘要

本文檔基於實際功能檢查，修正了成本估算中的錯誤假設：
1. **P5 Daily**：只有數據與新聞蒐集/監控策略觸發/通知功能，**沒有需要推理的地方**（GPT-5.2 分析關聯性應移除或簡化）
2. **P3 週度**：應該是有變動的股票才會觸發週度分析，**不是每週都要跑全部持股**
3. **P5 Weekly 策略**：每檔股票都要做每週策略（確認正確）

---

## 🔍 功能檢查結果

### 1. P5 Daily 實際功能

**實際功能**：
- ✅ 數據收集（OHLCV、技術指標、ETF、衍生品、宏觀數據）
- ✅ 新聞蒐集（CSE 搜尋）
- ✅ 新聞原子化（GEMINI_FLASH 清洗、GEMINI_PRO 多語去重）
- ⚠️ **GPT-5.2 分析關聯性**（`analyzeNewsWithGPT`）- **應該移除或簡化**

**用戶反饋**：
> P5 Daily 應該只有數據與新聞蒐集/監控策略觸發/通知功能，沒有需要推理的地方，不應該用到那麼多成本

**修正**：
- P5 Daily 的 GPT-5.2 分析關聯性功能應該移除或簡化
- 只保留 GEMINI_FLASH（清洗）和 GEMINI_PRO（多語去重）
- 成本大幅降低

---

### 2. P3 週度觸發機制

**實際機制**：
- P3 週度由 P5 Weekly 統一調度觸發（每週一次）
- 但從代碼看，P3_Weekly_Execute 會處理所有股票（從 phase2Output 讀取）

**用戶反饋**：
> P3 的週度觸發機制是甚麼? 我印象中應該是有變動的股票才會觸發週度分析，不是每週都要跑全部持股吧?

**需要確認**：
- 如果 P3 週度只處理有變動的股票，成本會大幅降低
- 假設：每週平均 20% 股票有變動（16 檔/80 檔）

---

### 3. P5 Weekly 策略

**確認**：
- ✅ 每檔股票都要做每週策略（正確）
- 批次處理：6 家/批
- 成本估算正確

---

## 💰 修正後的成本估算

### P5 Daily 成本修正

**修正前**（錯誤假設）：
- 執行者：GPT-5.2（分析關聯性）
- 審查者：GEMINI_PRO（多語去重）
- 單次成本：$0.50
- 月度成本：$397.50/月

**修正後**（實際功能）：
- 執行者：**無 AI 分析**（僅數據收集）
- 新聞原子化：GEMINI_FLASH（清洗）+ GEMINI_PRO（多語去重）
- 假設每檔股票每天 10 筆新聞，每批 20 筆新聞：
  - GEMINI_FLASH 清洗：20 筆 × 0.5K tokens × $0.0001 = $0.001
  - GEMINI_PRO 去重：20 筆 × 2K tokens × $0.002 = $0.004
  - 每檔股票成本：$0.005/天
- **月度成本**（80 檔，分層執行）：
  - CORE（20 檔，每日）：20 × 30 × $0.005 = **$3.00**
  - STABLE_SWING（25 檔，週度）：25 × 4 × $0.005 = **$0.50**
  - AGGRESSIVE（20 檔，週度）：20 × 4 × $0.005 = **$0.40**
  - OPPORTUNISTIC（15 檔，月度）：15 × 1 × $0.005 = **$0.08**
  - **P5 Daily 小計**：**$3.98/月**（大幅降低）

---

### P3 週度成本修正

**修正前**（錯誤假設）：
- 每週執行全部 80 檔股票
- 16 批次 × 4 週 = 64 批次/月
- 月度成本：$143.94/月

**修正後**（假設只處理有變動的股票）：
- 假設每週平均 20% 股票有變動（16 檔/80 檔）
- 16 檔 ÷ 5 家/批 = 3.2 批次（向上取整為 4 批次）
- 每週批次成本：4 批次 × $2.249 = $8.996
- **月度成本**：4 週 × $8.996 = **$35.98/月**（降低 75%）

**注意**：需要確認 P3 週度是否真的只處理有變動的股票，還是全部處理

---

## 📊 修正後的月度成本總結（80 檔股票）

| 類別 | 修正前（USD） | 修正後（USD） | 差異 |
|------|--------------|--------------|------|
| **產業面級別** | $8.07 | $8.07 | - |
| **P2 系列** | $25.28 | $25.28 | - |
| **P2.5 系列** | $30.40 | $30.40 | - |
| **P3 系列** | $179.92 | **$71.96** | -$107.96 |
| **P5 Weekly 策略** | $151.03 | $151.03 | - |
| **P5 Daily** | $397.50 | **$3.98** | -$393.52 |
| **P5 Weekly/Monthly** | $2.92 | $2.92 | - |
| **其他成本** | $110.00 | $110.00 | - |
| **總計** | **$905.12/月** | **$404.64/月** | **-$500.48** |

**年度總計**：**$4,855.68/年**（修正前：$10,861.44/年）

**成本降低**：$6,005.76/年（55.3%）

---

## ⚠️ 需要確認的事項

### 1. P3 週度觸發機制

**問題**：
- P3 週度是否真的只處理有變動的股票？
- 還是每週都要跑全部持股？

**影響**：
- 如果只處理有變動的股票，成本降低 75%
- 如果全部處理，成本維持不變

**建議**：
- 檢查 P3_Weekly_Execute 的實際邏輯
- 確認是否有過濾機制（只處理有變動的股票）

---

### 2. P5 Daily GPT-5.2 分析功能

**問題**：
- `analyzeNewsWithGPT` 函數是否應該移除？
- 或者簡化為輕量級處理？

**影響**：
- 移除後，P5 Daily 成本降低 99%
- 從 $397.50/月 降至 $3.98/月

**建議**：
- 確認此功能是否必要
- 如果必要，考慮移到 P5 Weekly（每週一次，而非每日）

---

## 📝 修正總結

### 主要修正

1. **P5 Daily 成本大幅降低**：
   - 移除 GPT-5.2 分析關聯性功能
   - 只保留 GEMINI_FLASH（清洗）和 GEMINI_PRO（多語去重）
   - 成本從 $397.50/月 降至 $3.98/月

2. **P3 週度成本降低**（假設只處理有變動的股票）：
   - 假設每週平均 20% 股票有變動
   - 成本從 $143.94/月 降至 $35.98/月

3. **總成本大幅降低**：
   - 從 $905.12/月 降至 $404.64/月
   - 年度成本從 $10,861.44 降至 $4,855.68

---

**文檔版本**：V3.0（修正版）  
**最後更新**：2026-01-17  
**狀態**：✅ 基於實際功能檢查修正，待確認 P3 週度觸發機制
