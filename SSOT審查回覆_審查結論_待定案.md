# SSOT 審查回覆 — 審查結論（已定案並執行）

**說明**：本文檔審查您對「發現的問題與建議」的回覆，判斷是否合理、是否有需進一步討論或請示之處。**已依您確認於 2026-01-26 執行 SSOT 修改**（V8.35）。

---

## 1. P2 澄清 + 檢查還有沒有舊 SSOT 寫 P2 尚未釐清是 P2-1 還是 P2-2 的地方

**您的回覆**：補充澄清，並檢查還有沒有本來舊 SSOT 寫 P2、尚未釐清是 P2-1 還是 P2-2 工作的地方。

**審查結論**：✅ **合理，建議採納。**

**補充**：
- 實作時建議：對 SSOT 全文搜尋「P2」在**描述「誰做什麼、產出寫到哪、誰讀取」**的脈絡，逐處判斷應標註為 **P2-1**、**P2-2** 或 **P2 整體**（例如「P2 財務數據由 P2 完成後 P3 繼承」應改為「P2-2 產出 Phase2_Output 後 P3 繼承」）。
- 目前已見需釐清處（grep 結果）：  
  - 「P2 財務指標由 P2 完成後 P3 繼承使用」→ 宜改為「P2-2 產出 Phase2_Output 後 P3 繼承」。  
  - 「P2 財務數據」「從 Phase2_Output 讀取」等已正確，可保留並在總述中強調「下游一律讀 Phase2_Output」。  
  - 原則 2 / 2.1 / 2.2 標題為「P2 同業比較」「P2 統一數據源」「P2 雙 FPE」— 屬 P2 **整體**原則，可在該節開頭加一句「以下為 P2 整體（含 P2-1/P2-2）之原則；產出與介面分工見『P2 工作拆分』。」  
- **建議**：除在「P2: 基本面財務分析」章節開頭加總述外，另做一次**全文件 P2 脈絡掃描**，列出「僅寫 P2 未區分 P2-1/P2-2」的句子清單，再決定是改寫還是加括註。

---

## 2. 舊設計文字集中一處、標註清楚，不要混雜到新設計中

**您的回覆**：若要保留舊設計文字作為對照，應將舊設計文字集中到一處，標註清楚此為舊有設計僅單純做對照使用，不要混雜到新設計中，會讓後續工程師混淆或錯誤引用。

**審查結論**：✅ **合理，建議採納。**

**需事先決策的點**：
- **「舊設計」範圍**：目前最容易混淆的是 **Weekly**（P5-B/P5-A vs WB-1/WB-2/W-A）。是否還包含：GAS 可重入/Trigger、Sheets 當 DB、GOOGLEFINANCE 為主、6 分鐘斷頭台等？建議定義為：**「舊設計」= 僅供對照、新系統不實作**的段落；**版本說明／已實現清單**裡對 GAS 現況的描述可保留在原文，但加一句「以下為 GAS 現行實現，對照用」。
- **集中方式二選一**：  
  - **方案 A**：主架構只寫目標設計（WB-1/WB-2/W-A、任務隊列、DB、可靠 API）；另開一節「**附錄：GAS 時代／現行設計對照（僅供對照，實作以目標架構為準）**」，把 P5-B/P5-A 雙層架構、可重入、Sheets 表名等**移過去或複製過去**，並在舊處改為「見附錄 X」。  
  - **方案 B**：主架構保留目標設計為主，舊設計**不移動**，但在每段舊設計前加明顯標籤，例如「**【GAS 對照】** P5-B/P5-A 雙層架構：…」；文末附錄只做索引（列出所有「GAS 對照」段落位置）。  
- **建議**：若希望「後續工程師只看主文就不會誤用」，**方案 A** 較佳；若希望減少大段搬動、保留版本脈絡，**方案 B** 也可行。請您擇一或指示混合方式。

---

## 3. Daily 史官 vs Weekly 世界觀重建 — 補充澄清

**您的回覆**：補充澄清。

**審查結論**：✅ **合理，建議採納。**

無需補充；實作時在史官鐵律或 WB-1/W-A 旁加 3～4 句（D-4 產出為 append-only、WB-1 讀 Daily 累積產出當週快照、「世界觀重建」指週級 NEW_WORLDVIEW_FRAMEWORK、不改寫 Daily 歷史）即可。

---

## 4. P6 清除時機：改為「每週策略產生後清除上週」、可留存更長

**您的回覆**：P6 隔天清除一般正常情況的 OHLCV 數據，若改為「每週策略產生後清除『上週』（非當週）」是否較好？時間太短怕查證或引用時沒有數據；100 檔個股 OHLCV 一週份量也不大，甚至可留存更長。

**審查結論**：✅ **合理，建議採納。**

**建議寫進 SSOT 的規則**：
- **清除對象**：上週（**上一個完整交易週**）的「一般正常情況」OHLCV／監測數據（**未**標記需保留者）。當週剛分析完的數據不刪。
- **清除時機**：**本週策略產出完成後**（例如 P5 Weekly 產出 weekly_trade_actions 並寫入完成後），再清除上週一般數據；避免 Daily/Weekly 尚未讀完就被清掉。
- **保留長度**：建議**至少保留一週**；可依存儲成本與查證需求保留更長（例如 2～4 週），在 SSOT 或工程備忘錄寫「建議至少 1 週，可選 2～4 週」即可。
- **需保留的異常數據**：維持現有設計——觸發異常的當天詳細數據進入 P5 Daily 留存的日更資料；P6 清除時**不刪**已整合到 Daily 的引用與需保留標記。

**一項請您確認**：「清除」是否僅限 **P6 自己產出的盤中監測數據**（例如 20 分鐘快照、一般日誌），而不包括「從 GOOGLEFINANCE 等抓下來、已寫入共用 OHLCV 表」的資料？若共用 OHLCV 由其他模組管理、保留策略另定，建議在 SSOT 註明「P6 清除範圍僅限 P6 產出之一般監測數據，不包含共用 OHLCV 表之保留策略」。

---

## 5. DSFP 宏觀商品數據來源 + D-4 產出：Daily 負責、D-4 各類別現狀快照與歷史銜接

**您的回覆**：DSFP 其中宏觀類金融商品（貴金屬、油價、日圓、美債等）的現狀資料來源是否應為 Daily 每天的數據工作？由 D-4 更新的各大類別宏觀世界觀快照，不應只有一個「目前金融市場與金融」現況快照，也要把每個不同的宏觀財經商品根據各自數據產出當天的現狀概念快照，並與歷史快照銜接統整，作為各分析工作的引入參考資料。

**審查結論**：✅ **合理，建議採納。**

**建議寫進 SSOT 的區分**：
- **數據收集（Daily）**：宏觀類金融商品（貴金屬、油價、匯率、美債等）的**當日價格／指標／流量**由 **Daily** 收集並更新（可視為「各宏觀商品的當日現狀數據」）；WB-1 做 DSFP 時讀取 Daily 產出的該類數據（及當週摘要）。
- **D-4 產出**：  
  - **不只**一個「目前金融市場與金融」總覽快照；  
  - **還要有**：各宏觀財經商品**各自**的「當日現狀概念快照」（例如：黃金當日、美債當日、日圓當日…），並與**歷史快照銜接統整**（趨勢／變化／延續或轉折）；  
  - 用途：作為各分析工作（含 Weekly WB-1 DSFP、P4 Market Climate、P5 世界觀）的**引入參考資料**。
- **職責邊界**：D-4 做「現狀概念快照」與「與歷史銜接統整」，**不做** DSFP 的「身份裁決」（身份裁決仍為 Weekly WB-1）；避免 Daily 越權到 Weekly 的裁決層。

**一項請您確認**：「與歷史快照銜接統整」是否由 D-4 當次執行時**一併產出**（例如當日快照 + 與前 N 日銜接的摘要），還是由另一條 Daily 或 Weekly 任務事後統整？若由 D-4 一併產出，SSOT 可寫「D-4 產出各宏觀商品當日現狀概念快照，並與前幾日快照銜接統整（趨勢／變化）」。

---

## 6. Batch 錯誤處理 / fallback 清單

**您的回覆**：採納，之後會補上 fallback 的模型或 provider（若有鎖 provider）清單。

**審查結論**：✅ **合理，建議採納。**

**建議**：SSOT 在 Batch API 或 M0 一節預留一句：「Batch/API 失敗時之重試、部分成功處理、超時降級見本文（或工程備忘錄）；**fallback 模型或 provider 清單**（含鎖 provider 時之備援）見工程備忘錄或 M0 配置，後補。」實作時再把清單補進備忘錄或 M0 配置即可。

---

## 7. 動態學習記憶庫改到 DB 後，是否還需要每週壓縮一次？

**您的回覆**：若動態學習記憶庫改到資料庫而非 sheet，還需要每週就壓縮一次嗎？考慮工程上更換平台的最佳方式。

**審查結論**：✅ **合理，建議採納。**

**建議寫進 SSOT 或工程備忘錄的區分**：
- **Sheet 時代（GAS）**：單 Cell 字數限制、需控制膨脹 → 「每週壓縮」「覆蓋原 Cell」有其必要。
- **DB 時代（目標架構）**：  
  - 無單 Cell 限制，可 **append-only 或版本化表** 存更多筆、更細紀錄。  
  - 「壓縮」目的改為：**(1) 控制給 P5 Weekly 的 memory_pack 讀取量**（例如最近 N 週完整、較舊的改為摘要）；**(2) 歸檔**（舊資料標記為 archived 或移入 archive 表，常規讀取不載入）。  
  - **不需**像 Sheet 時代「每週覆蓋原數據」；可改為：**每週／每月執行一次「歸檔或摘要」任務**（將超過 12 週的記錄寫入摘要或標記歸檔），或**讀取時按時間窗過濾**（最近 6 週完整、7–12 週摘要、12 週外僅 lesson）。  
- **一句話**：目標架構下「壓縮」改為「歸檔或摘要」，可依排程或讀取時過濾處理，不必每週覆蓋寫入；這樣更符合換平台後的最佳實踐。

---

## 8. P3 週線：若數據源有直接提供週線也可直接下載使用

**您的回覆**：採納，若數據源有直接提供週線數據，也可以直接下載使用。

**審查結論**：✅ **合理，建議採納。**

SSOT 補一句即可：P3 週線數據可來自 **(1) 日線聚合（aggregateDailyToWeekly）** 或 **(2) 數據源直接提供之週線（若有則可直接下載使用）**；Prompt 中仍須明確標註 [WEEKLY_CHART] 與 [DAILY_CHART]。

---

## 9. Learning State 回寫頻率與防重複

**您的回覆**：採納。

**審查結論**：✅ **合理，建議採納。**

無需補充；實作時補上「本週是否已調整過」的版本或時間戳、同一週只調整一次（含補跑）、可選的調整歷史表與月度重置即可。

---

## 10. P0.5 簡化建議（只實作 Mode 2），但要確定 P0 的 baseline 有做到

**您的回覆**：可以，但要確定 P0 的 baseline 工作有確實做到。

**審查結論**：✅ **合理，建議採納。**

**建議寫進 SSOT 的條件**：  
「新系統可考慮僅實作 P0.5 **Mode 2**（Chain Dynamics Monitor），Baseline 由 **P0 產出**以降低複雜度；**惟須確保 P0 的 baseline 產出（如生態系報告／產業邏輯卡等）已涵蓋 P0.5 Mode 2 所需之產業鏈 baseline**，否則仍須保留 Mode 1 或另行補足 baseline 來源。」  
這樣可避免只做 Mode 2 時缺了 P0 的產業鏈 baseline 而引用落空。

---

## 11. 「殘影」更換為「20 分鐘動能追蹤」，小心誤刪

**您的回覆**：更換，但小心誤刪。

**審查結論**：✅ **合理，建議採納。**

**實作注意**：  
- 僅替換**用語**（「殘影機制」→「20 分鐘動能追蹤」或「動能追蹤（原殘影機制）」）；  
- **不刪**任何功能描述、檔案名、表名說明；  
- 保留 **P6_SHADOW_PRICES** 及「保留以兼容既有 schema」之註解；  
- 建議用搜尋「殘影」逐處確認，避免誤改到「P2_Financial_Evidence」等無關字串。

---

## 總結：待您確認的項目

| # | 項目 | 結論 | 待您確認／擇一 |
|---|------|------|----------------|
| 2 | 舊設計集中方式 | 採納 | **方案 A**（舊設計移／複製到附錄）還是 **方案 B**（主文加標籤＋附錄索引）？或混合？ |
| 4 | P6 清除範圍 | 採納 | 清除是否**僅限 P6 產出之一般監測數據**，不包含共用 OHLCV 表的保留策略？ |
| 5 | D-4 與歷史銜接 | 採納 | 「與歷史快照銜接統整」由 **D-4 當次一併產出**，還是**另一任務**事後統整？ |

其餘項目皆可依您回覆與上述建議直接採納；**尚未對 SSOT 進行任何修改**。若您確認上述三項與舊設計集中方式，即可依此定案並開始修改 SSOT。
