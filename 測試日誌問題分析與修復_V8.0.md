# æ¸¬è©¦æ—¥èªŒå•é¡Œåˆ†æžèˆ‡ä¿®å¾© V8.0

**åˆ†æžæ—¥æœŸ**ï¼š2026-01-17  
**æ¸¬è©¦æ™‚é–“**ï¼š2026-01-17 æ¸…æ™¨ 7:48:27

---

## ðŸ” æ¸¬è©¦æ—¥èªŒå•é¡Œåˆ†æž

### å•é¡Œ 1ï¼šå®è§€æ•¸æ“š HTTP 500 éŒ¯èª¤

**ç¾è±¡**ï¼š
- æ‰€æœ‰å•†å“ï¼ˆWTI åŽŸæ²¹ã€é»ƒé‡‘ã€ç™½éŠ€ã€éŠ…ï¼‰éƒ½è¿”å›ž HTTP 500 éŒ¯èª¤
- æ‰€æœ‰åŒ¯çŽ‡ï¼ˆæ­å…ƒ/ç¾Žå…ƒã€è‹±éŽŠ/ç¾Žå…ƒã€ç¾Žå…ƒ/æ—¥åœ“ã€ç¾Žå…ƒ/äººæ°‘å¹£ï¼‰éƒ½è¿”å›ž HTTP 500 éŒ¯èª¤
- ä½† S&P 500 å’Œ NASDAQ 100 æˆåŠŸæ”¶é›†ï¼ˆ2/13 é …æˆåŠŸï¼‰

**å¯èƒ½åŽŸå› **ï¼š
1. **Cloud Function ä»£ç†å•é¡Œ**ï¼šstooq.com çš„ Cloud Function ä»£ç†å¯èƒ½å°æŸäº› ticker è¿”å›ž HTTP 500
2. **Stooq ä»£è™Ÿæ ¼å¼å•é¡Œ**ï¼šé›–ç„¶ä»£ç¢¼å·²ä¿®æ­£ç‚º `cl.f`, `gc.f` ç­‰ï¼Œä½† Cloud Function å¯èƒ½é‚„åœ¨ä½¿ç”¨èˆŠæ ¼å¼
3. **Stooq æ•¸æ“šæºå•é¡Œ**ï¼šæŸäº›å•†å“/åŒ¯çŽ‡åœ¨ stooq.com ä¸Šå¯èƒ½æ²’æœ‰æ•¸æ“šæˆ–æ ¼å¼ä¸åŒ

**æ—¥èªŒé¡¯ç¤ºå•é¡Œ**ï¼š
- æ—¥èªŒé¡¯ç¤º `P5 Dailyï¼šæ”¶é›† WTI åŽŸæ²¹ (^cl)`ï¼Œä½†å¯¦éš›ä»£ç¢¼æ‡‰è©²æ˜¯ `cl.f`
- é€™è¡¨ç¤ºæ—¥èªŒé¡¯ç¤ºçš„æ˜¯ `item.stooqTicker`ï¼Œä½†å¯¦éš›èª¿ç”¨æ‡‰è©²æ˜¯æ­£ç¢ºçš„
- **å·²ä¿®æ­£**ï¼šæ—¥èªŒç¾åœ¨æœƒåŒæ™‚é¡¯ç¤º symbol å’Œ stooqTickerï¼Œä¾‹å¦‚ï¼š`P5 Dailyï¼šWTI åŽŸæ²¹ (cl.f) HTTP 500 éŒ¯èª¤`

**å»ºè­°**ï¼š
1. æª¢æŸ¥ Cloud Function ä»£ç†çš„æ—¥èªŒï¼Œç¢ºèªå¯¦éš›ä½¿ç”¨çš„ ticker æ ¼å¼
2. é©—è­‰ stooq.com ä¸Šé€™äº› ticker æ˜¯å¦çœŸçš„å­˜åœ¨ï¼ˆä¾‹å¦‚ï¼š`cl.f`, `gc.f`, `eurusd`ï¼‰
3. å¦‚æžœ Cloud Function ä»£ç†æœ‰å•é¡Œï¼Œè€ƒæ…®ç›´æŽ¥å¾ž stooq.com æŠ“å–ï¼ˆå¦‚æžœ GAS å…è¨±ï¼‰

---

### å•é¡Œ 2ï¼šFPE_B è‚¡åƒ¹æå–éŒ¯èª¤ï¼ˆ32.64ï¼‰

**ç¾è±¡**ï¼š
- æ‰€æœ‰è‚¡ç¥¨ï¼ˆAAPL, 2330.TW, 7203.Tï¼‰éƒ½é¡¯ç¤ºè‚¡åƒ¹ = 32.64
- é€™æ˜Žé¡¯æ˜¯éŒ¯èª¤çš„ï¼š
  - AAPL æ‡‰è©²æ˜¯ 255 å·¦å³
  - 2330.TW æ‡‰è©²æ˜¯å°è‚¡åƒ¹æ ¼ï¼ˆç´„ 500-600ï¼‰
  - 7203.T æ‡‰è©²æ˜¯æ—¥è‚¡åƒ¹æ ¼ï¼ˆç´„ 2000-3000ï¼‰

**æ ¹æœ¬åŽŸå› **ï¼š
- `getCurrentPriceFromYahoo` å‡½æ•¸çš„æ­£å‰‡è¡¨é”å¼å¯èƒ½åŒ¹é…åˆ°äº†éŒ¯èª¤çš„æ•¸æ“š
- Yahoo Finance çš„ HTML çµæ§‹å¯èƒ½åŒ…å«å¤šå€‹ `regularMarketPrice`ï¼Œå‡½æ•¸åŒ¹é…åˆ°äº†ç¬¬ä¸€å€‹ï¼ˆå¯èƒ½æ˜¯å…¶ä»–è‚¡ç¥¨çš„åƒ¹æ ¼æˆ–éŒ¯èª¤æ•¸æ“šï¼‰

**å·²å¯¦ä½œçš„ä¿®å¾©**ï¼š
1. âœ… **å„ªå…ˆåŒ¹é… quoteSummaryStore å’Œ root.App.main**ï¼šé€™äº›æ˜¯ç•¶å‰è‚¡ç¥¨çš„åƒ¹æ ¼æ•¸æ“š
2. âœ… **æ·»åŠ åˆç†æ€§æª¢æŸ¥**ï¼šè‚¡åƒ¹æ‡‰è©²åœ¨ 0.01 åˆ° 100000 ä¹‹é–“
3. âœ… **æ”¹é€²éŒ¯èª¤æ—¥èªŒ**ï¼šå¦‚æžœåƒ¹æ ¼ä¸åˆç†ï¼Œæœƒè¨˜éŒ„è­¦å‘Šä¸¦è·³éŽè©²æ–¹æ³•
4. âœ… **æ”¹é€²æ‰€æœ‰æå–æ–¹æ³•**ï¼šæ‰€æœ‰æ–¹æ³•éƒ½æ·»åŠ äº†åˆç†æ€§æª¢æŸ¥

**ä¿®å¾©å…§å®¹**ï¼š
```javascript
// æ–¹æ³• 1ï¼šå„ªå…ˆåŒ¹é… quoteSummaryStore ä¸­çš„ regularMarketPrice
const pricePattern1 = /"quoteSummaryStore":\s*\{[^}]*"regularMarketPrice":\s*\{[^}]*"raw":\s*([\d.]+)/i;

// å‚™ç”¨ï¼šåŒ¹é… root.App.main ä¸­çš„ regularMarketPrice
const pricePattern1b = /root\.App\.main\s*=\s*\{[^}]*"regularMarketPrice":\s*\{[^}]*"raw":\s*([\d.]+)/i;

// æœ€å¾Œå‚™ç”¨ï¼šåŒ¹é…ä»»ä½• regularMarketPriceï¼ˆä½†éœ€è¦åˆç†æ€§æª¢æŸ¥ï¼‰
const pricePattern1c = /"regularMarketPrice":\s*\{[^}]*"raw":\s*([\d.]+)/i;
if (match1c && match1c[1]) {
  const price = parseFloat(match1c[1]);
  // âš ï¸ æ·»åŠ åˆç†æ€§æª¢æŸ¥ï¼šè‚¡åƒ¹æ‡‰è©²åœ¨åˆç†ç¯„åœå…§ï¼ˆ0.01 åˆ° 100000ï¼‰
  if (!isNaN(price) && price > 0 && price < 100000) {
    // ä½¿ç”¨æ­¤åƒ¹æ ¼
  } else {
    Logger.log(`âš ï¸ æå–çš„è‚¡åƒ¹ ${price.toFixed(2)} ä¸åˆç†ï¼Œè·³éŽæ­¤æ–¹æ³•`);
  }
}
```

**ä¸‹ä¸€æ­¥å»ºè­°**ï¼š
1. é‡æ–°æ¸¬è©¦ FPE_B æ•¸æ“šæ”¶é›†ï¼Œç¢ºèªè‚¡åƒ¹æ˜¯å¦æ­£ç¢º
2. å¦‚æžœä»ç„¶å¤±æ•—ï¼Œå¯èƒ½éœ€è¦æª¢æŸ¥ Yahoo Finance çš„å¯¦éš› HTML çµæ§‹
3. è€ƒæ…®ä½¿ç”¨ Yahoo Finance APIï¼ˆå¦‚æžœå¯ç”¨ï¼‰æˆ–å°‹æ‰¾å…¶ä»–æ•¸æ“šæº

---

### å•é¡Œ 3ï¼šåœ‹å‚µåˆ©çŽ‡å’Œ VIX HTTP 500 éŒ¯èª¤

**ç¾è±¡**ï¼š
- æ—¥èªŒé¡¯ç¤º `P5 Dailyï¼šæ”¶é›† åå¹´ç¾Žå‚µåˆ©çŽ‡ (^tnx)` å’Œ `P5 Dailyï¼šæ”¶é›† VIX (^vix)` éƒ½è¿”å›ž HTTP 500 éŒ¯èª¤
- ä½†ä»£ç¢¼å·²ç¶“æ”¹ç‚ºä½¿ç”¨ `getYahooFinanceQuote`ï¼Œä¸æ‡‰è©²è¿”å›ž HTTP 500

**å¯èƒ½åŽŸå› **ï¼š
1. **æ—¥èªŒé¡¯ç¤ºçš„æ˜¯èˆŠçš„éŒ¯èª¤è¨Šæ¯**ï¼š`getYahooFinanceQuote` å‡½æ•¸å¯èƒ½é‚„æ²’æœ‰è¢«æ­£ç¢ºèª¿ç”¨
2. **Yahoo Finance è«‹æ±‚å¤±æ•—**ï¼šYahoo Finance å¯èƒ½å°æŸäº› ticker è¿”å›ž HTTP 500
3. **URL ç·¨ç¢¼å•é¡Œ**ï¼š`^` ç¬¦è™Ÿåœ¨ URL ä¸­éœ€è¦ç·¨ç¢¼ç‚º `%5E`ï¼Œå¯èƒ½ç·¨ç¢¼æœ‰å•é¡Œ

**å·²å¯¦ä½œçš„ä¿®å¾©**ï¼š
1. âœ… **æ·»åŠ  HTTP 500 é‡è©¦**ï¼š`getYahooFinanceQuote` ç¾åœ¨æœƒå° HTTP 500 é€²è¡Œé‡è©¦
2. âœ… **æ”¹é€²éŒ¯èª¤æ—¥èªŒ**ï¼šæ—¥èªŒæœƒé¡¯ç¤ºå¯¦éš›ä½¿ç”¨çš„ ticker å’Œ URL

**ä¿®å¾©å…§å®¹**ï¼š
```javascript
// getYahooFinanceQuote ç¾åœ¨æœƒå° HTTP 500 é€²è¡Œé‡è©¦
} else if (statusCode === 500 || statusCode === 503 || statusCode === 429) {
  retryCount++;
  if (retryCount < maxRetries) {
    const delay = Math.min(2000 * retryCount, 10000);
    Logger.log(`P5 Dailyï¼š${yahooTicker} HTTP ${statusCode} éŒ¯èª¤ï¼Œç­‰å¾… ${delay}ms å¾Œé‡è©¦ï¼ˆç¬¬ ${retryCount} æ¬¡ï¼‰`);
    Utilities.sleep(delay);
    continue;
  }
}
```

**ä¸‹ä¸€æ­¥å»ºè­°**ï¼š
1. é‡æ–°æ¸¬è©¦åœ‹å‚µåˆ©çŽ‡å’Œ VIX æ•¸æ“šæ”¶é›†
2. æª¢æŸ¥ Yahoo Finance çš„å¯¦éš› URL æ˜¯å¦æ­£ç¢ºï¼ˆä¾‹å¦‚ï¼š`https://finance.yahoo.com/quote/%5ETNX`ï¼‰
3. å¦‚æžœä»ç„¶å¤±æ•—ï¼Œå¯èƒ½éœ€è¦æª¢æŸ¥ Yahoo Finance æ˜¯å¦å°é€™äº› ticker æœ‰è¨ªå•é™åˆ¶

---

## âœ… å·²å®Œæˆçš„ä¿®å¾©

### 1. FPE_B è‚¡åƒ¹æå–æ”¹é€²

**ä¿®å¾©å…§å®¹**ï¼š
- âœ… å„ªå…ˆåŒ¹é… `quoteSummaryStore` å’Œ `root.App.main` ä¸­çš„ `regularMarketPrice`
- âœ… æ·»åŠ åˆç†æ€§æª¢æŸ¥ï¼ˆè‚¡åƒ¹ç¯„åœï¼š0.01 åˆ° 100000ï¼‰
- âœ… æ”¹é€²æ‰€æœ‰æå–æ–¹æ³•çš„éŒ¯èª¤è™•ç†
- âœ… æ”¹é€²éŒ¯èª¤æ—¥èªŒï¼Œé¡¯ç¤ºæ›´å¤šèª¿è©¦ä¿¡æ¯

**ç‹€æ…‹**ï¼šâœ… å·²ä¿®å¾©ï¼ˆéœ€è¦é‡æ–°æ¸¬è©¦é©—è­‰ï¼‰

---

### 2. å®è§€æ•¸æ“šéŒ¯èª¤æ—¥èªŒæ”¹é€²

**ä¿®å¾©å…§å®¹**ï¼š
- âœ… æ—¥èªŒç¾åœ¨æœƒåŒæ™‚é¡¯ç¤º symbol å’Œ stooqTicker
- âœ… æ”¹é€²éŒ¯èª¤è¨Šæ¯ï¼ŒåŒ…å«æ›´å¤šèª¿è©¦ä¿¡æ¯

**ç‹€æ…‹**ï¼šâœ… å·²æ”¹é€²ï¼ˆä½† HTTP 500 éŒ¯èª¤å¯èƒ½æ˜¯ Cloud Function ä»£ç†å•é¡Œï¼Œéœ€è¦æª¢æŸ¥ä»£ç†ï¼‰

---

### 3. åœ‹å‚µåˆ©çŽ‡å’Œ VIX é‡è©¦æ©Ÿåˆ¶

**ä¿®å¾©å…§å®¹**ï¼š
- âœ… `getYahooFinanceQuote` ç¾åœ¨æœƒå° HTTP 500 é€²è¡Œé‡è©¦
- âœ… æ”¹é€²éŒ¯èª¤æ—¥èªŒ

**ç‹€æ…‹**ï¼šâœ… å·²ä¿®å¾©ï¼ˆéœ€è¦é‡æ–°æ¸¬è©¦é©—è­‰ï¼‰

---

## ðŸ“Š æ¸¬è©¦çµæžœæ‘˜è¦

### âœ… æˆåŠŸçš„æ¸¬è©¦é …ç›®

1. **P2 è²¡å‹™æ•¸æ“šæ”¶é›†**ï¼šâœ… æˆåŠŸ
   - AAPL (US)ï¼š4 ç­†çµæžœ
   - 2330 (TW)ï¼š10 ç­†çµæžœ
   - 7203 (JP)ï¼š10 ç­†çµæžœ

2. **P2 åŒæ¥­æ•¸æ“šæ”¶é›†**ï¼šâœ… æˆåŠŸ
   - æˆåŠŸæ”¶é›† 3 å€‹åŒæ¥­ï¼ˆMSFT, GOOGL, AMZNï¼‰

3. **P3 æ­·å² OHLCV**ï¼šâœ… æˆåŠŸ
   - AAPLï¼šå¾ž stooq.com è£œå……äº† 10421 ç­†æ­·å²æ•¸æ“š

4. **P5 Daily æ–°èžæ”¶é›†**ï¼šâœ… æˆåŠŸ
   - æˆåŠŸæ”¶é›† 5 æ¢æ–°èžçµæžœ

5. **P5 Daily OHLCV**ï¼šâœ… æˆåŠŸ
   - AAPLï¼šæˆåŠŸæ”¶é›†ï¼ˆæ—¥æœŸï¼š2026-01-16ï¼Œæ”¶ç›¤åƒ¹ï¼š255.517ï¼‰

6. **P5 Weekly Sector ETF**ï¼šâœ… æˆåŠŸ
   - æˆåŠŸæ”¶é›† 11/11 å€‹ ETF

---

### âš ï¸ å¤±æ•—çš„æ¸¬è©¦é …ç›®

1. **P5 Daily å®è§€æ•¸æ“š**ï¼šâš ï¸ éƒ¨åˆ†å¤±æ•—
   - å•†å“ï¼ˆWTI åŽŸæ²¹ã€é»ƒé‡‘ã€ç™½éŠ€ã€éŠ…ï¼‰ï¼šHTTP 500 éŒ¯èª¤
   - åŒ¯çŽ‡ï¼ˆæ­å…ƒ/ç¾Žå…ƒã€è‹±éŽŠ/ç¾Žå…ƒã€ç¾Žå…ƒ/æ—¥åœ“ã€ç¾Žå…ƒ/äººæ°‘å¹£ï¼‰ï¼šHTTP 500 éŒ¯èª¤
   - åœ‹å‚µåˆ©çŽ‡ï¼ˆ^TNX, ^IRXï¼‰ï¼šHTTP 500 éŒ¯èª¤
   - VIXï¼ˆ^VIXï¼‰ï¼šHTTP 500 éŒ¯èª¤
   - S&P 500 å’Œ NASDAQ 100ï¼šâœ… æˆåŠŸ

2. **P5 Weekly FPE_B**ï¼šâš ï¸ è‚¡åƒ¹æå–éŒ¯èª¤
   - æ‰€æœ‰è‚¡ç¥¨éƒ½é¡¯ç¤ºè‚¡åƒ¹ = 32.64ï¼ˆæ˜Žé¡¯éŒ¯èª¤ï¼‰
   - Forward EPS æå–æˆåŠŸï¼ˆAAPL: 2.67, 2330.TW: 20.60, 7203.T: 74.05ï¼‰

---

## ðŸŽ¯ ä¸‹ä¸€æ­¥å»ºè­°

### å„ªå…ˆç´š 1ï¼ˆç«‹å³è™•ç†ï¼‰

1. **é‡æ–°æ¸¬è©¦ FPE_B è‚¡åƒ¹æå–**
   - é©—è­‰ä¿®å¾©å¾Œçš„è‚¡åƒ¹æå–é‚è¼¯æ˜¯å¦æ­£ç¢º
   - ç¢ºèªåˆç†æ€§æª¢æŸ¥æ˜¯å¦æœ‰æ•ˆéŽæ¿¾éŒ¯èª¤åƒ¹æ ¼

2. **æª¢æŸ¥ Cloud Function ä»£ç†**
   - é©—è­‰ stooq.com çš„ Cloud Function ä»£ç†æ˜¯å¦æ­£å¸¸é‹ä½œ
   - æª¢æŸ¥ä»£ç†æ—¥èªŒï¼Œç¢ºèªå¯¦éš›ä½¿ç”¨çš„ ticker æ ¼å¼
   - ç¢ºèªä»£ç†æ˜¯å¦å°æŸäº› ticker æœ‰ç‰¹æ®Šè™•ç†

3. **é‡æ–°æ¸¬è©¦åœ‹å‚µåˆ©çŽ‡å’Œ VIX**
   - é©—è­‰ `getYahooFinanceQuote` æ˜¯å¦æ­£ç¢ºèª¿ç”¨
   - ç¢ºèª Yahoo Finance URL æ˜¯å¦æ­£ç¢ºç·¨ç¢¼

---

### å„ªå…ˆç´š 2ï¼ˆå¾ŒçºŒè™•ç†ï¼‰

1. **èª¿æŸ¥å®è§€æ•¸æ“š HTTP 500 éŒ¯èª¤**
   - æª¢æŸ¥ stooq.com ä¸Šé€™äº› ticker æ˜¯å¦çœŸçš„å­˜åœ¨
   - é©—è­‰ Cloud Function ä»£ç†çš„é…ç½®
   - è€ƒæ…®æ·»åŠ å‚™ç”¨æ•¸æ“šæº

2. **æ”¹é€² FPE_B Forward P/E æå–**
   - èª¿æŸ¥ç‚ºä»€éº¼ç„¡æ³•ç›´æŽ¥æå– Forward P/E
   - æ”¹é€² `parseYahooForwardPE` çš„è§£æžé‚è¼¯
   - è€ƒæ…®ä½¿ç”¨ Yahoo Finance APIï¼ˆå¦‚æžœå¯ç”¨ï¼‰

---

## ðŸ“ ä¿®å¾©æ‘˜è¦

### å·²ä¿®æ”¹çš„æª”æ¡ˆ

1. `src/24_P5_WEEKLY_SENTIMENT.js`
   - âœ… æ”¹é€² `getCurrentPriceFromYahoo` çš„è‚¡åƒ¹æå–é‚è¼¯
   - âœ… å„ªå…ˆåŒ¹é… `quoteSummaryStore` å’Œ `root.App.main`
   - âœ… æ·»åŠ åˆç†æ€§æª¢æŸ¥ï¼ˆè‚¡åƒ¹ç¯„åœï¼š0.01 åˆ° 100000ï¼‰
   - âœ… æ”¹é€²éŒ¯èª¤æ—¥èªŒ

2. `src/24_P5_DAILY_MACRO.js`
   - âœ… æ”¹é€²éŒ¯èª¤æ—¥èªŒï¼ŒåŒæ™‚é¡¯ç¤º symbol å’Œ stooqTicker
   - âœ… `getYahooFinanceQuote` æ·»åŠ  HTTP 500 é‡è©¦

---

**åˆ†æžå®Œæˆæ™‚é–“**ï¼š2026-01-17  
**æ‰€æœ‰ä¿®å¾©å·²ä¸Šå‚³åˆ° Google Apps Script**
