# 快速修復指南：新聞品質測試問題

## 問題診斷

1. ❌ UI 選單中沒有「⭐ V8.9 測試新聞品質」按鈕
2. ❌ NEWS_ATOMS_DAILY 表格空白
3. ❌ 沒有 INSTITUTIONAL_RATINGS_DAILY 這個 tab

---

## 解決方案

### 步驟 1：初始化表格

在 Google Apps Script 編輯器中，執行以下函數來創建缺失的表格：

```javascript
// 執行這個函數來初始化所有表格（包括 INSTITUTIONAL_RATINGS_DAILY）
initializeSheets();
```

**執行方式：**
1. 打開 Google Sheets
2. 點擊選單：`擴充功能` → `Apps Script`
3. 在編輯器中，找到 `initializeSheets` 函數（在 `01_SHEETS_STRUCTURE.js` 中）
4. 點擊「執行」按鈕（▶️）
5. 選擇 `initializeSheets` 函數
6. 點擊「執行」

---

### 步驟 2：重新載入 UI 選單

UI 按鈕已經在代碼中（第 270 行），但可能需要重新載入：

1. **關閉側邊欄**：點擊側邊欄右上角的「×」
2. **重新打開側邊欄**：
   - 點擊選單：`擴充功能` → `Nuclear Project` → `控制面板`
   - 或者執行：`showSidebar()` 函數

3. **檢查按鈕**：
   - 在「🔍 數據流測試系統（V8.0）」區塊中
   - 應該能看到「⭐ V8.9 測試新聞品質」按鈕（在第 270 行）

---

### 步驟 3：執行 P5 Daily 收集新聞

如果 `NEWS_ATOMS_DAILY` 表格是空白的，需要執行 P5 Daily 來收集新聞：

**方法 1：使用 UI 選單**
1. 打開側邊欄
2. 在「🧪 輕測試系統」區塊中
3. 點擊「🧪 測試 P5 Daily」按鈕

**方法 2：直接執行函數**
在 Apps Script 編輯器中執行：
```javascript
P5_Daily_Execute({ trigger: "MANUAL" });
```

---

### 步驟 4：驗證表格已創建

執行後，檢查 Google Sheets 中是否有以下表格：

1. ✅ `NEWS_ATOMS_DAILY` - 一般新聞表格
2. ✅ `INSTITUTIONAL_RATINGS_DAILY` - 機構評級表格

如果表格已存在但沒有數據，表示：
- P5 Daily 執行時沒有收集到新聞（可能是 CSE 沒有結果，或時間不對）
- 需要檢查 P5 Daily 的執行日誌

---

## 快速檢查清單

- [ ] 執行 `initializeSheets()` 創建所有表格
- [ ] 重新載入 UI 側邊欄（關閉後重新打開）
- [ ] 檢查「⭐ V8.9 測試新聞品質」按鈕是否出現
- [ ] 執行 P5 Daily 收集新聞數據
- [ ] 檢查 `NEWS_ATOMS_DAILY` 表格是否有數據
- [ ] 檢查 `INSTITUTIONAL_RATINGS_DAILY` 表格是否存在

---

## 如果問題仍然存在

### 問題 1：UI 按鈕仍然看不到

**可能原因：**
- UI HTML 文件沒有正確部署到 GAS
- 需要重新部署 HTML 服務

**解決方法：**
1. 確認 `25_UI_SIDEBAR.html` 文件已上傳到 GAS 專案
2. 檢查 `showSidebar()` 函數是否正確引用 HTML 文件

### 問題 2：NEWS_ATOMS_DAILY 仍然是空白

**可能原因：**
- P5 Daily 執行時新聞收集失敗
- CSE 沒有返回結果
- 當天沒有新聞

**檢查方法：**
1. 查看 P5 Daily 執行日誌（Apps Script 執行記錄）
2. 檢查是否有錯誤訊息
3. 確認 CSE 配置是否正確

### 問題 3：INSTITUTIONAL_RATINGS_DAILY 表格不存在

**解決方法：**
1. 手動執行 `initializeInstitutionalRatingsTable()` 函數
2. 或執行完整的 `initializeSheets()` 函數

---

**最後更新：** 2026-01-18
