{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "D3_Stock_Daily_Output",
    "description": "D-3 個股專屬統整師每日輸出 (§10.6)",
    "type": "object",
    "required": [
        "ticker",
        "date",
        "authoritative_impacts",
        "forum_impacts",
        "daily_summary",
        "identity_shift_signals",
        "event_cluster_update",
        "weekly_escalation_hint"
    ],
    "properties": {
        "ticker": {
            "type": "string"
        },
        "date": {
            "type": "string",
            "format": "date"
        },
        "authoritative_impacts": {
            "type": "array",
            "description": "Section A: D1A + D2 權威新聞影響",
            "items": {
                "type": "object",
                "required": [
                    "news_id",
                    "source_type",
                    "impact_direction",
                    "impact_reasoning"
                ],
                "properties": {
                    "news_id": {
                        "type": "string"
                    },
                    "source_type": {
                        "type": "string",
                        "enum": [
                            "D1A_DIRECT",
                            "D2_INFERENCE"
                        ]
                    },
                    "impact_direction": {
                        "type": "string",
                        "enum": [
                            "POSITIVE",
                            "NEUTRAL",
                            "NEGATIVE",
                            "PENDING",
                            "REQUIRES_MULTI_FACTOR"
                        ]
                    },
                    "impact_reasoning": {
                        "type": "string"
                    }
                }
            }
        },
        "forum_impacts": {
            "type": "array",
            "description": "Section B: D1B 散戶論壇影響",
            "items": {
                "type": "object",
                "required": [
                    "source",
                    "sentiment_score",
                    "buzz_level"
                ],
                "properties": {
                    "source": {
                        "type": "string",
                        "const": "D1B"
                    },
                    "sentiment_score": {
                        "type": "number",
                        "minimum": -1,
                        "maximum": 1
                    },
                    "buzz_level": {
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 100
                    },
                    "dominant_emotion": {
                        "type": "string",
                        "enum": [
                            "fear",
                            "greed",
                            "hope",
                            "anger"
                        ]
                    }
                }
            }
        },
        "daily_summary": {
            "type": "string"
        },
        "identity_shift_signals": {
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "event_cluster_update": {
            "type": [
                "object",
                "null"
            ]
        },
        "weekly_escalation_hint": {
            "type": [
                "string",
                "null"
            ]
        },
        "thesis_broken_check": {
            "type": "object",
            "properties": {
                "triggered": {
                    "type": "boolean"
                },
                "severity": {
                    "type": "string",
                    "enum": [
                        "NONE",
                        "WARNING",
                        "CRITICAL"
                    ]
                },
                "evidence": {
                    "type": "string"
                }
            }
        },
        "peer_relative_tracking": {
            "type": "object",
            "properties": {
                "peer_rank_current": {
                    "type": "integer"
                },
                "peer_rank_delta": {
                    "type": "integer"
                },
                "peer_rank_trend": {
                    "type": "string"
                }
            }
        },
        "contradiction_pattern": {
            "type": [
                "string",
                "null"
            ]
        },
        "event_stability": {
            "type": "string",
            "enum": [
                "REVERSAL_NOISE",
                "STABLE_EVENT",
                "INSUFFICIENT_DATA"
            ]
        }
    }
}