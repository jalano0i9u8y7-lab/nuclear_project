{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "WB2_Strategy_Output",
    "description": "WB-2 策略制定與掛單執行層 AI 輸出 (§12.3.4)",
    "type": "object",
    "required": [
        "ticker",
        "final_buy_1",
        "final_buy_2",
        "final_buy_3",
        "final_sell",
        "final_stop",
        "size_multiplier",
        "cash_bias",
        "concentration_bias",
        "urgency",
        "no_trade_flag",
        "rationale"
    ],
    "properties": {
        "ticker": {
            "type": "string"
        },
        "final_buy_1": {
            "type": "number"
        },
        "final_buy_2": {
            "type": "number"
        },
        "final_buy_3": {
            "type": "number"
        },
        "final_sell": {
            "type": "number"
        },
        "final_stop": {
            "type": "number"
        },
        "size_multiplier": {
            "type": "number",
            "minimum": 0
        },
        "cash_bias": {
            "type": "string",
            "enum": [
                "increase",
                "neutral",
                "decrease"
            ]
        },
        "concentration_bias": {
            "type": "string",
            "enum": [
                "focus",
                "neutral",
                "diversify"
            ]
        },
        "urgency": {
            "type": "string",
            "enum": [
                "high",
                "medium",
                "low"
            ]
        },
        "no_trade_flag": {
            "type": "boolean"
        },
        "skeleton_status_note": {
            "type": "string",
            "enum": [
                "CURRENT",
                "STALE_ADJUSTED",
                "N/A"
            ]
        },
        "valuation_brake_override": {
            "type": "object",
            "properties": {
                "applied": {
                    "type": "boolean"
                },
                "final_brake": {
                    "type": "number"
                },
                "reasoning": {
                    "type": "string"
                }
            }
        },
        "sector_flag_assessment": {
            "type": "object",
            "properties": {
                "flags_received": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "impact_on_this_stock": {
                    "type": "string"
                },
                "adjustment": {
                    "type": "number",
                    "minimum": 0.75,
                    "maximum": 1.15
                }
            }
        },
        "thesis_broken_check": {
            "type": "object",
            "properties": {
                "severity": {
                    "type": "string",
                    "enum": [
                        "NONE",
                        "WARNING",
                        "CRITICAL"
                    ]
                },
                "impact_on_strategy": {
                    "type": "string"
                }
            }
        },
        "trailing_stop_config": {
            "type": "object",
            "description": "Cat=3 持倉的 trailing stop 配置 (§11.3)",
            "properties": {
                "trailing_pct": {
                    "type": "number"
                },
                "ma_reference": {
                    "type": "string",
                    "enum": [
                        "MA10",
                        "MA20"
                    ]
                },
                "exit_ratio": {
                    "type": "number"
                },
                "core_holding_max_exit": {
                    "type": "number"
                }
            }
        },
        "rationale": {
            "type": "string",
            "minLength": 1
        }
    }
}