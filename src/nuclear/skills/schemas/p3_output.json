{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "P3_Strategy_Skeleton",
    "description": "P3 技術面與機構視角完整版輸出 (§8.6)",
    "type": "object",
    "required": [
        "ticker",
        "cat",
        "cat_confidence",
        "cat_reasoning",
        "support_levels",
        "resistance_levels",
        "trend_structure",
        "risk_overlay_level",
        "distortion_risk",
        "rs_score_5d",
        "rs_score_20d",
        "buy_prices",
        "stop_prices",
        "weekly_trend",
        "volume_profile"
    ],
    "properties": {
        "ticker": {
            "type": "string"
        },
        "cat": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5
        },
        "cat_confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
        },
        "cat_reasoning": {
            "type": "string",
            "minLength": 1
        },
        "cat_reversal_evidence": {
            "type": [
                "string",
                "null"
            ]
        },
        "support_levels": {
            "type": "array",
            "items": {
                "type": "object",
                "required": [
                    "price",
                    "strength",
                    "type"
                ],
                "properties": {
                    "price": {
                        "type": "number"
                    },
                    "strength": {
                        "type": "string"
                    },
                    "type": {
                        "type": "string"
                    }
                }
            }
        },
        "resistance_levels": {
            "type": "array",
            "items": {
                "type": "object",
                "required": [
                    "price",
                    "strength",
                    "type"
                ],
                "properties": {
                    "price": {
                        "type": "number"
                    },
                    "strength": {
                        "type": "string"
                    },
                    "type": {
                        "type": "string"
                    }
                }
            }
        },
        "trend_structure": {
            "type": "string",
            "enum": [
                "BULLISH",
                "BEARISH",
                "NEUTRAL",
                "TRANSITIONING"
            ]
        },
        "icdz_applied": {
            "type": "boolean"
        },
        "icdz_range": {
            "type": [
                "object",
                "null"
            ],
            "properties": {
                "lower": {
                    "type": "number"
                },
                "upper": {
                    "type": "number"
                },
                "confidence": {
                    "type": "number"
                }
            }
        },
        "risk_overlay_level": {
            "type": "integer",
            "minimum": 0,
            "maximum": 3
        },
        "distortion_risk": {
            "type": "string",
            "enum": [
                "NONE",
                "LOW",
                "MED",
                "HIGH"
            ]
        },
        "rs_score_5d": {
            "type": "number"
        },
        "rs_score_20d": {
            "type": "number"
        },
        "re_entry_signal": {
            "type": "boolean"
        },
        "re_entry_price": {
            "type": [
                "number",
                "null"
            ]
        },
        "fpe_a": {
            "type": [
                "number",
                "null"
            ]
        },
        "fpe_b": {
            "type": [
                "number",
                "null"
            ]
        },
        "fpe_b_vs_peers_pct": {
            "type": [
                "number",
                "null"
            ]
        },
        "fpe_divergence": {
            "type": [
                "number",
                "null"
            ]
        },
        "valuation_flag": {
            "type": "string",
            "enum": [
                "VALUATION_ATTRACTIVE",
                "VALUATION_STRETCHED",
                "FPE_DIVERGENCE_ALERT",
                "NONE"
            ]
        },
        "buy_prices": {
            "type": "object",
            "required": [
                "buy1",
                "buy2",
                "buy3"
            ],
            "properties": {
                "buy1": {
                    "type": "number"
                },
                "buy2": {
                    "type": "number"
                },
                "buy3": {
                    "type": "number"
                }
            }
        },
        "stop_prices": {
            "type": "object",
            "required": [
                "stop1",
                "stop2"
            ],
            "properties": {
                "stop1": {
                    "type": "number"
                },
                "stop2": {
                    "type": "number"
                }
            }
        },
        "weekly_trend": {
            "type": "string"
        },
        "volume_profile": {
            "type": "string"
        },
        "alpha_exempt": {
            "type": "boolean"
        },
        "next_delta_run_date": {
            "type": [
                "string",
                "null"
            ],
            "format": "date"
        },
        "snapshot_id": {
            "type": "string"
        },
        "version_chain_id": {
            "type": "string"
        }
    }
}