# AI 任務 vs 程式計算任務完整分類表 V8.0

## 📋 文檔說明

本文檔系統性地檢查所有任務，明確區分：
1. **AI 模型任務**：需要複雜推理、因果邏輯、意圖判斷、預測未來的工作
2. **程式計算任務**：可以用公式計算的簡單工作（RSI、MACD、均線、支撐壓力等）

**重要性**：⭐⭐⭐⭐⭐ **最高等級原則**
- 如果 AI 給出「根據黃金支撐、根據均線糾結、根據 RSI、根據 MACD」這些程式就能算的結果，系統就等於廢物
- AI 模型算力就等於浪費，成本就等於白花

**檢查日期**：2025-01-14  
**檢查範圍**：整個系統 P0-P5

---

## ✅ 程式計算任務表（必須用程式公式，不能用 AI）

### 1. P5 Daily：數據收集與計算 ⭐ **已確認：純程式**

| 任務 | 計算方式 | 說明 | 狀態 |
|------|---------|------|------|
| **OHLCV 數據收集** | 程式抓取 | 從 stooq.com（通過 Cloud Function 代理）或 TWSE/TPEX 收集 | ✅ **已實現** |
| **技術指標計算** | 程式公式 | RSI、MACD、ATR、MA20/MA60/MA240 等 | ✅ **已實現（calculateTechnicalIndicators）** |
| **板塊 ETF 數據收集** | 程式抓取 | 從 stooq.com 收集 ETF 價格和表現 | ✅ **已實現** |
| **衍生品數據收集** | 程式抓取 | Put/Call Ratio、IV、Max OI Strike 等 | ✅ **已實現** |
| **宏觀數據收集** | 程式抓取 | 從 stooq.com 收集（油價、貴金屬、匯率、國債利率等） | ✅ **已實現（collectMacroData）** |
| **台股掛單檢查** | 程式比對 | 比對 OHLCV 與 TAIWAN_ORDER_MONITOR 中的掛單價位 | ✅ **已實現** |
| **ETF 週/月表現計算** | 程式公式 | 計算週表現和月表現（比較歷史收盤價） | ✅ **已實現** |

**⚠️ 檢查結果**：
- ✅ **所有 P5 Daily 計算任務都已用程式實現**
- ✅ **技術指標計算已在 `calculateTechnicalIndicators` 中實現（純程式公式）**
- ✅ **符合「Daily 僅用程式公式做簡易技術分析（不用 AI 模型）」的決策**

---

### 2. P4：資金配置計算 ⭐ **已確認：純程式**

| 任務 | 計算方式 | 說明 | 狀態 |
|------|---------|------|------|
| **W_ideal 計算** | 程式公式 | 根據 Tier 配置範圍和 Cat 權重矩陣計算理想配置 | ✅ **已實現** |
| **W_now 計算** | 程式公式 | W_cap_applied × U（利用率） | ✅ **已實現** |
| **分層權重計算** | 程式公式 | 根據 Tier 和股票數量計算每檔理想權重 | ✅ **已實現** |
| **Buy1/Buy2/Buy3 配置** | 程式公式 | 根據 Cat 權重矩陣分配 | ✅ **已實現** |
| **總計統計** | 程式公式 | 計算總配置金額、利用率等 | ✅ **已實現** |

**⚠️ 檢查結果**：
- ✅ **P4 是純程式計算模組（無 AI），完全正確**

---

## 🤖 AI 模型任務表（必須用 AI，不能用程式公式）

### 3. P0：產業工程學分析 ⭐ **必須用 AI**

| 任務 | AI 用途 | 為什麼不能用程式？ | 狀態 |
|------|---------|------------------|------|
| **產業主題識別** | 深度推理 | 需要理解產業趨勢、技術發展、市場需求 | ✅ **使用 Opus** |
| **子主題劃分** | 深度推理 | 需要分析產業細分領域 | ✅ **使用 Opus** |
| **關鍵技術節點識別** | 深度推理 | 需要判斷技術突破點和瓶頸 | ✅ **使用 Opus** |
| **產業鏈結構分析** | 深度推理 | 需要理解上下游關係和價值鏈 | ✅ **使用 Opus** |
| **資金流分析** | 深度推理 | 需要分析資金流向和投資邏輯 | ✅ **使用 Opus** |

**⚠️ 檢查結果**：
- ✅ **P0 必須用 AI，邏輯正確**

---

### 4. P0.5：產業鏈地圖與供應鏈情報 ⭐ **必須用 AI**

| 任務 | AI 用途 | 為什麼不能用程式？ | 狀態 |
|------|---------|------------------|------|
| **產業鏈地圖繪製** | 複雜分析 | 需要理解產業上下游關係和價值鏈 | ✅ **待確認模型** |
| **供應鏈風險分析** | 複雜分析 | 需要判斷供應鏈脆弱性和依賴關係 | ✅ **待確認模型** |

**⚠️ 檢查結果**：
- ✅ **P0.5 必須用 AI，邏輯正確**

---

### 5. P0.7：系統動力學分析 ⭐ **必須用 AI**

| 任務 | AI 用途 | 為什麼不能用程式？ | 狀態 |
|------|---------|------------------|------|
| **敘事狀態分析** | 複雜推理 | 需要理解市場敘事和情緒 | ✅ **使用 o3** |
| **循環主導識別** | 複雜推理 | 需要判斷市場循環階段 | ✅ **使用 o3** |
| **時間定位** | 複雜推理 | 需要判斷當前市場在循環中的位置 | ✅ **使用 o3** |
| **槓桿角色類型** | 複雜推理 | 需要判斷公司在產業中的槓桿角色 | ✅ **使用 o3** |

**⚠️ 檢查結果**：
- ✅ **P0.7 必須用 AI（使用 o3），邏輯正確**

---

### 6. P1：公司池建立 ⭐ **必須用 AI**

| 任務 | AI 用途 | 為什麼不能用程式？ | 狀態 |
|------|---------|------------------|------|
| **ENG_Fit 檢查** | 深度推理 | 需要判斷公司是否適合產業主題 | ✅ **使用 Sonnet** |
| **STRUCT_Fit 檢查** | 深度推理 | 需要判斷公司結構是否匹配 | ✅ **使用 Sonnet** |
| **TIME_ROLE_Fit 檢查** | 深度推理 | 需要判斷公司在時間和角色上是否匹配 | ✅ **使用 Sonnet** |
| **三層適配綜合判斷** | 深度推理 | 需要綜合多個維度的判斷 | ✅ **使用 Sonnet** |

**⚠️ 檢查結果**：
- ✅ **P1 必須用 AI，邏輯正確**

---

### 7. P2：基本面分析 ⭐ **部分 AI，部分提取**

| 任務 | AI 用途 / 程式用途 | 為什麼這樣分配？ | 狀態 |
|------|------------------|----------------|------|
| **財務指標收集** | 程式抓取 | 從權威網站（SEC、TWSE、JPX）抓取財務數據 | ✅ **已實現（collectFinancialDataFromExternalSources）** |
| **財務指標提取** | AI 提取 | 從搜尋結果中提取財務指標（Revenue_YoY、Gross_Margin 等） | ⚠️ **需要確認** |
| **財務指標計算** | ❌ **禁止** | **不應該計算，應該從權威網站提取** | ⚠️ **需確認 Prompt** |
| **Gate 檢查** | AI 判斷 | 需要綜合判斷多個財務指標是否通過門檻 | ✅ **使用 Sonnet** |
| **Tier 分層決策** | AI 判斷 | 需要綜合 Gate 結果、信心度、財務強度、護城河、Rerate State 等多個維度 | ✅ **使用 Sonnet** |
| **同業比較** | AI 分析 | 需要找出同業並進行比較分析 | ✅ **使用 Sonnet** |

**⚠️ 檢查結果**：
- ✅ **財務指標收集：已用程式實現**
- ⚠️ **財務指標提取：目前由 AI 從 CSE 搜尋結果中提取**
- ⚠️ **財務指標計算：Prompt 中已強調「優先使用外部權威數據源的數據，不自己計算」**

**財務指標處理結論追溯**：
根據 `buildP2Prompt` 中的說明：
- ✅ **優先使用外部權威數據源**：從 SEC EDGAR、TWSE、JPX 等官方數據源抓取
- ✅ **不要自己計算**：Prompt 明確要求「從提供的財務數據中**提取**以下指標（不要計算）」
- ✅ **只有在外部數據源完全沒有該指標時，才考慮計算（但必須標註數據來源為"計算"）**

**結論**：財務指標應該**優先從權威網站提取**，如果無法提取才考慮計算（需標註）

---

### 8. P2.5：機構級籌碼分析 ⭐ **必須用 AI**

| 任務 | AI 用途 | 為什麼不能用程式？ | 狀態 |
|------|---------|------------------|------|
| **機構持倉分析** | 複雜分析 | 需要分析 13F 數據和機構行為意圖 | ✅ **待確認模型** |
| **內部人交易分析** | 複雜分析 | 需要判斷內部人交易的信號意義 | ✅ **待確認模型** |
| **Options Flow 分析** | 複雜分析 | 需要分析期權流動的市場含義 | ✅ **待確認模型** |
| **Dark Pool 分析** | 複雜分析 | 需要判斷暗池交易的意圖 | ✅ **待確認模型** |
| **Smart Money Score 計算** | 複雜分析 | 需要綜合多個籌碼面信號進行評分 | ✅ **待確認模型** |

**⚠️ 檢查結果**：
- ✅ **P2.5 必須用 AI，邏輯正確**

---

### 9. P3：技術分析（機構級預測） ⭐⭐⭐⭐⭐ **最高等級原則**

| 任務 | AI 用途 | 為什麼不能用程式？ | 狀態 |
|------|---------|------------------|------|
| **技術指標收集** | 程式收集 | 從 P5 Daily 的 `MARKET_INDICATORS_DAILY` 表格讀取（已用程式計算） | ✅ **已實現** |
| **技術指標計算** | ❌ **禁止** | **不應該讓 AI 計算，應該從程式計算的結果讀取** | ⚠️ **需確認 Prompt** |
| **機構主力行為解釋** | ⭐ AI 推理 | **必須**：解釋為什麼主力會做這些操作（機構級視角） | ⚠️ **需強化 Prompt** |
| **主力意圖判斷** | ⭐ AI 推理 | **必須**：判斷主力的真正意圖 | ⚠️ **需強化 Prompt** |
| **未來操作預測** | ⭐ AI 預測 | **必須**：預測主力未來會做的操作 | ⚠️ **需強化 Prompt** |
| **Cat 分類** | AI 判斷 | 需要綜合技術面、籌碼面、主力行為進行分類 | ✅ **使用 Sonnet** |
| **Buy1/Buy2/Buy3 價格判斷** | AI 判斷 | 需要根據主力行為和市場預期判斷買入點 | ✅ **使用 Sonnet** |
| **Stop2/Stop3 價格判斷** | AI 判斷 | 需要根據風險管理和主力動向判斷止損點 | ✅ **使用 Sonnet** |

**⚠️ 檢查結果**：
- ✅ **技術指標收集：已用程式實現（從 MARKET_INDICATORS_DAILY 讀取）**
- ✅ **Prompt 中已說明「優先使用外部權威數據源的技術指標，不要自己計算」**
- ⚠️ **需要強化 Prompt**：強調機構級預測視角、主力行為解釋、意圖判斷、未來預測

**核心靈魂原則**（已在 `系統核心設計原則_V8.0.md` 中定義）：
- ✅ **不是「技術分析」，而是「機構級預測」**
- ✅ **以機構主力、大型對沖基金、高盛、摩根等大機構的視角來分析**
- ✅ **目標是「預測未來」，而不是套用公式（RSI、MACD、均線等）**
- ✅ **「量大於價」：量才是資金足跡，短期的價有時只是表象**
- ✅ **要「成為主力的大腦」，解釋為什麼主力會做這些操作**

**⚠️ 需要立即修正 Prompt**：
- ✅ **必須做技術分析**：RSI、MACD、均線、支撐壓力、黃金分割等（這些是技術分析學派的重點參考）
- ⚠️ **但不能光用一般技術分析的結論**：必須站在主力大資金操控市場的角度思考
- ✅ **將自己當成就是主力**：來預測未來如何搭乘主力的順風車獲取最大獲利、控制風險最小
- ⚠️ **不需要輸出技術分析的數值結論**：因為已經由程式計算好了，以節省 AI 模型成本
- ❌ **禁止**：只輸出「根據黃金支撐、根據均線糾結、根據 RSI、根據 MACD」等程式就能算的結論
- ✅ **必須**：AI 輸出「主力行為解釋」、「意圖判斷」、「未來預測」

---

### 10. P5 Daily：新聞處理 ⭐ **必須用 AI（多階段）**

| 任務 | AI 用途 | 為什麼不能用程式？ | 狀態 |
|------|---------|------------------|------|
| **CSE 新聞搜集** | 程式搜尋 | 使用 Google CSE 搜集新聞（無 AI） | ✅ **已實現** |
| **新聞 Atom 化** | AI 清洗 | 需要理解多語系新聞內容並提取核心資訊 | ✅ **使用 Gemini Flash** |
| **新聞去重分類** | AI 分析 | 需要識別不同語言但內容相同的新聞，並進行分類 | ✅ **使用 Gemini Pro** |
| **世界觀彙整** | AI 分析 | 需要連結歷史資訊、綜合數據資訊、更新世界觀 | ✅ **使用 GPT** |

**⚠️ 檢查結果**：
- ✅ **P5 Daily 新聞處理的多階段 AI 流程正確**
- ✅ **使用便宜的模型（Flash、Gemini Pro）先清洗，再用 GPT 彙整**

---

### 11. P5 Weekly：週度市場綜述 ⭐ **必須用 AI**

| 任務 | AI 用途 | 為什麼不能用程式？ | 狀態 |
|------|---------|------------------|------|
| **市場綜述** | 複雜分析 | 需要綜合多個維度的市場分析 | ✅ **使用 Sonnet** |
| **因果鏈分析** | 複雜推理 | 需要理解事件之間的因果關係 | ✅ **使用 Sonnet** |
| **風險事件識別** | 複雜判斷 | 需要判斷哪些事件構成風險 | ✅ **使用 Sonnet** |
| **衍生品策略調整** | 複雜分析 | 需要根據市場情況調整策略 | ✅ **使用 Sonnet** |
| **信念更新** | 複雜推理 | 需要根據新資訊更新世界觀 | ✅ **使用 Sonnet** |
| **U 調整** | 複雜判斷 | 需要根據市場狀況調整利用率 | ✅ **使用 Sonnet** |
| **行動清單生成** | 複雜推理 | 需要根據分析結果生成具體行動 | ✅ **使用 Sonnet** |
| **觸發決策** | 複雜判斷 | 需要判斷是否觸發其他 Phase | ✅ **使用 Sonnet** |
| **持倉整合** | 複雜邏輯 | 需要整合 Quarterly 產生的新清單和現有持倉 | ✅ **使用 Sonnet** |

**⚠️ 檢查結果**：
- ✅ **P5 Weekly 必須用 AI，邏輯正確**

---

### 12. P5 Monthly：月度分析 ⭐ **必須用 AI**

| 任務 | AI 用途 | 為什麼不能用程式？ | 狀態 |
|------|---------|------------------|------|
| **月度趨勢分析** | 複雜分析 | 需要綜合四週的 Weekly 結論進行趨勢分析 | ✅ **使用 Sonnet** |
| **持倉表現評估** | 複雜分析 | 需要評估持倉表現並分析原因 | ✅ **使用 Sonnet** |
| **策略調整建議** | 複雜推理 | 需要根據表現評估提出調整建議 | ✅ **使用 Sonnet** |
| **歷史事件連結** | 複雜推理 | 需要連結前三個月的結論並分析趨勢變化 | ✅ **使用 Sonnet** |
| **學習機制** | 複雜推理 | 需要分析預測 vs 實際的偏差並進行學習調整 | ✅ **使用 Sonnet（雙模型）** |

**⚠️ 檢查結果**：
- ✅ **P5 Monthly 必須用 AI，邏輯正確**

---

### 13. P5 Quarterly：季度分析 ⭐ **必須用 AI**

| 任務 | AI 用途 | 為什麼不能用程式？ | 狀態 |
|------|---------|------------------|------|
| **季度回顧** | 複雜分析 | 需要綜合三個月的結論進行季度回顧 | ✅ **使用 Sonnet** |
| **策略檢討** | 複雜分析 | 需要檢討策略的有效性 | ✅ **使用 Sonnet** |
| **下季度展望** | 複雜預測 | 需要預測下季度市場趨勢 | ✅ **使用 Sonnet** |
| **季財報追蹤** | 複雜分析 | 需要分析季財報並判斷影響 | ✅ **使用 Sonnet** |
| **基本面變化判斷** | 複雜判斷 | 需要判斷基本面是否發生重大變化 | ✅ **使用 Sonnet** |
| **產業面變化判斷** | 複雜判斷 | 需要判斷產業面是否發生重大變化 | ✅ **使用 Sonnet** |
| **新興產業識別** | 複雜識別 | 需要識別新興產業和機會 | ✅ **使用 Sonnet** |

**⚠️ 檢查結果**：
- ✅ **P5 Quarterly 必須用 AI，邏輯正確**

---

## ⚠️ 潛在問題檢查

### 問題 1：P3 Prompt 是否足夠強調機構級預測視角？

**當前 Prompt 狀態**：
```javascript
function buildP3Prompt(frequency, phase2Output, technicalData) {
  return `
你是一位資深的技術分析師，負責進行 Nuclear Project 的技術分析。
...
**優先使用外部權威數據源的技術指標，不要自己計算**
```

**⚠️ 問題**：
- ❌ 僅說「技術分析師」，沒有強調「機構級預測視角」
- ❌ 沒有強調「預測未來」而非「技術分析」
- ❌ 沒有強調「量大於價」和「主力行為解釋」
- ❌ 沒有說明「一樣要做各大技術分析，但不能光用一般技術分析的結論」
- ❌ 沒有說明「將自己當成就是主力，站在大資金操控市場的角度思考」
- ❌ 沒有說明「不需要輸出技術分析的數值結論」（因為已由程式計算好）

**✅ 修正要求**：
- ✅ 必須在 Prompt 中明確強調「機構級預測視角」
- ✅ 必須強調「一樣要做各大技術分析」（RSI、MACD、均線、支撐壓力等）
- ✅ 必須強調「但不能光是用一般技術分析的結論來分析與產生策略」
- ✅ 必須強調「將自己當成就是主力，站在大資金操控市場的角度思考」
- ✅ 必須強調「預測未來：如何搭乘主力的順風車獲取最大獲利、控制風險最小」
- ✅ 必須強調「主力行為解釋」、「意圖判斷」、「未來預測」
- ✅ 必須說明「不需要輸出技術分析的數值結論」（因為已由程式計算好，節省成本）

---

### 問題 2：P2 Prompt 是否明確禁止計算財務指標？

**當前 Prompt 狀態**：
```javascript
**重要原則**：優先使用外部權威數據源的數據，不自己計算。
...
針對每個公司，從提供的財務數據中**提取**以下指標（不要計算）：
...
**注意**：
- 如果外部數據源有該指標，直接使用，不要重新計算
- 只有在外部數據源**完全沒有**該指標時，才考慮計算（但必須標註數據來源為"計算"）
```

**✅ 檢查結果**：
- ✅ **Prompt 已明確禁止計算，要求提取**
- ✅ **已說明優先使用外部權威數據源**
- ✅ **已說明只有在完全沒有時才計算（需標註）**

**結論追溯**：
- ✅ **財務指標應該優先從權威網站（SEC、TWSE、JPX）提取**
- ✅ **不應該自己計算（除非完全無法提取，需標註）**

---

### 問題 3：是否有其他任務誤用了 AI？

**檢查結果**：
- ✅ **所有必須用 AI 的任務都已正確使用 AI**
- ✅ **所有可以用程式計算的任務都已用程式實現**

---

## 📋 完整任務分類總結表

### 程式計算任務（必須用程式公式，不能用 AI）

| Phase | 任務 | 實現狀態 | 備註 |
|-------|------|---------|------|
| **P5 Daily** | OHLCV 數據收集 | ✅ | 從 stooq.com 收集 |
| **P5 Daily** | 技術指標計算（RSI、MACD、ATR、MA） | ✅ | `calculateTechnicalIndicators` |
| **P5 Daily** | 板塊 ETF 數據收集 | ✅ | 從 stooq.com 收集 |
| **P5 Daily** | 衍生品數據收集 | ✅ | Put/Call Ratio、IV 等 |
| **P5 Daily** | 宏觀數據收集 | ✅ | 從 stooq.com 收集 |
| **P5 Daily** | ETF 週/月表現計算 | ✅ | 程式公式計算 |
| **P5 Daily** | 台股掛單檢查 | ✅ | 程式比對 |
| **P4** | W_ideal 計算 | ✅ | 純程式計算 |
| **P4** | W_now 計算 | ✅ | 純程式計算 |
| **P4** | 分層權重計算 | ✅ | 純程式計算 |
| **P4** | Buy1/Buy2/Buy3 配置 | ✅ | 純程式計算 |

**總計**：11 個程式計算任務，全部已實現 ✅

---

### AI 模型任務（必須用 AI，不能用程式公式）

| Phase | 任務 | AI 模型 | 為什麼不能用程式？ | 狀態 |
|-------|------|---------|------------------|------|
| **P0** | 產業工程學分析 | Opus | 需要深度推理和產業知識 | ✅ |
| **P0.5** | 產業鏈地圖與供應鏈分析 | 待確認 | 需要複雜分析 | ✅ |
| **P0.7** | 系統動力學分析 | o3 | 需要複雜推理 | ✅ |
| **P1** | 公司池建立 | Sonnet | 需要深度推理和多維度判斷 | ✅ |
| **P2** | Gate 檢查 | Sonnet | 需要綜合判斷多個財務指標 | ✅ |
| **P2** | Tier 分層決策 | Sonnet | 需要綜合多個維度 | ✅ |
| **P2** | 財務指標提取 | Sonnet | 從搜尋結果中提取（非計算） | ✅ |
| **P2** | 同業比較 | Sonnet | 需要找出同業並分析 | ✅ |
| **P2.5** | 機構級籌碼分析 | 待確認 | 需要複雜分析 | ✅ |
| **P3** | **機構級預測** | Sonnet | ⭐ **必須用 AI**：主力行為解釋、意圖判斷、未來預測 | ⚠️ **需強化 Prompt** |
| **P3** | Cat 分類 | Sonnet | 需要綜合技術面、籌碼面、主力行為 | ✅ |
| **P3** | Buy/Stop 價格判斷 | Sonnet | 需要根據主力行為和市場預期 | ✅ |
| **P5 Daily** | 新聞 Atom 化 | Gemini Flash | 需要理解多語系新聞 | ✅ |
| **P5 Daily** | 新聞去重分類 | Gemini Pro | 需要識別重複並分類 | ✅ |
| **P5 Daily** | 世界觀彙整 | GPT | 需要連結歷史資訊 | ✅ |
| **P5 Weekly** | 市場綜述與策略制定 | Sonnet | 需要複雜分析和推理 | ✅ |
| **P5 Monthly** | 月度分析與學習 | Sonnet（雙模型） | 需要複雜推理和學習 | ✅ |
| **P5 Quarterly** | 季度分析 | Sonnet | 需要複雜分析和預測 | ✅ |

**總計**：18 個 AI 任務，17 個已確認，1 個需強化 Prompt ⚠️

---

## 🚨 關鍵問題：P3 Prompt 需要強化

### 當前問題

1. **沒有強調機構級預測視角**
2. **沒有禁止輸出程式就能算的技術指標結論**
3. **沒有強調「預測未來」而非「技術分析」**
4. **沒有強調主力行為解釋、意圖判斷、未來預測**

### 必須修正的 Prompt 內容

#### 當前 Prompt（不完整）：
```
你是一位資深的技術分析師，負責進行 Nuclear Project 的技術分析。
...
**優先使用外部權威數據源的技術指標，不要自己計算**
```

#### 修正後的 Prompt（必須包含）：
```
你是一位**機構級主力分析師**（以高盛、摩根、大型對沖基金的視角），負責進行 Nuclear Project 的**機構級預測**（不是一般技術分析）。

## ⭐⭐⭐⭐⭐ 最高等級原則

**你的任務不是「一般技術分析」，而是「機構級預測」**

### 核心要求

1. **視角要求**：
   - ✅ **以機構主力、大型對沖基金、高盛、摩根等大機構的視角來分析**
   - ✅ **將自己當成就是主力，站在大資金操控市場、黑手、聰明錢的角度思考**
   - ✅ **不要以散戶視角，不要以一般分析系統的視角**

2. **技術分析要求**：
   - ✅ **一樣要做各大技術分析**（RSI、MACD、均線、支撐壓力、黃金分割等）
   - ✅ **這些指標是技術分析學派的重點參考，必須使用**
   - ⚠️ **但不能光是用一般技術分析的結論來分析與產生策略**
   - ✅ **必須站在主力大資金操控市場的角度思考，將自己當成就是主力**

3. **目標要求**：
   - ✅ **目標是「預測未來」**：如何搭乘主力的順風車獲取最大獲利、控制風險最小
   - ✅ **要「成為主力的大腦」**：解釋為什麼主力會做這些操作
   - ✅ **不是一般程式用公式就能得到的「技術分析結論」**

4. **邏輯要求**：
   - ✅ **「量大於價」：量才是資金足跡，短期的價有時只是表象**
   - ✅ **解釋主力行為**：為什麼主力跟大型機構會做出這些事情？
   - ✅ **判斷真正意圖**：藉此判斷他們的真正意圖
   - ✅ **預測未來操作**：預測未來會做的操作與市場變化

5. **輸出要求**：
   - ✅ **主力行為解釋**：解釋為什麼主力會做這些操作
   - ✅ **意圖判斷**：判斷主力的真正意圖
   - ✅ **未來預測**：預測主力未來會做的操作和市場變化
   - ✅ **Cat 分類**：基於主力行為和意圖進行分類
   - ✅ **Buy/Stop 價格**：基於主力未來操作預測判斷價格
   - ⚠️ **不需要輸出技術分析的數值結論**（RSI、MACD、均線等數值），因為已經由程式計算好了，以節省 AI 模型成本

6. **禁止事項**：
   - ❌ **禁止只輸出「根據黃金支撐、根據均線糾結、根據 RSI、根據 MACD」等程式就能算的結論**
   - ❌ **禁止把資源拿去解釋過去（例如：解釋為什麼過去漲跌）**
   - ❌ **禁止只做程式就能算出來的工作**

### 技術指標使用原則

- ✅ **技術指標已由程式計算好**（RSI、MACD、ATR、MA 等），直接使用這些數據作為參考
- ✅ **不要重新計算技術指標**（浪費 AI 算力）
- ✅ **技術指標是重要參考**，但重點是用機構視角解釋和預測主力行為
- ✅ **結合 P2.5 的機構級數據**（Smart_Money_Score、機構持倉、Dark Pool、Options Flow）進行分析
- ✅ **結合 P2 的財務指標**（已繼承，不需要重複搜尋與計算）
```

---

## ✅ 財務指標處理結論追溯

### 問題背景

之前討論過：財務指標類之前有討論過要用權威網站直接抓算好的還是自己計算，那時候 GPT 是說要自己算才不會無法追朔，但是自己算又有不夠準的問題。

### 追溯結果

根據 `buildP2Prompt` 函數中的實現，結論是：

**✅ 優先從權威網站提取，不要計算**

**具體說明**：
1. **數據收集**：從權威網站（SEC EDGAR、TWSE、JPX）收集財務數據（使用 CSE 搜尋）
2. **數據提取**：由 AI 從搜尋結果中**提取**財務指標（Revenue_YoY、Gross_Margin 等）
3. **數據計算**：**禁止計算**，除非外部數據源完全沒有該指標（需標註數據來源為"計算"）

**優先順序**：
1. ✅ **第一優先**：從權威網站（SEC、TWSE、JPX）直接提取已計算好的指標
2. ⚠️ **第二優先**：如果無法提取，才考慮計算（但必須標註數據來源為"計算"）

**結論**：✅ **財務指標應該優先從權威網站提取，不要自己計算**

---

## 📋 Prompt 對齊檢查清單（最高優先級）

### P3 Prompt 對齊檢查

- [ ] **視角檢查**：Prompt 是否以機構主力視角設計？（高盛、摩根、大型對沖基金等）
- [ ] **視角檢查**：Prompt 是否要求「將自己當成就是主力，站在大資金操控市場的角度思考」？
- [ ] **技術分析檢查**：Prompt 是否要求「一樣要做各大技術分析」（RSI、MACD、均線、支撐壓力等）？
- [ ] **技術分析檢查**：Prompt 是否強調「但不能光是用一般技術分析的結論來分析與產生策略」？
- [ ] **目標檢查**：Prompt 是否強調「預測未來：如何搭乘主力的順風車獲取最大獲利、控制風險最小」？
- [ ] **邏輯檢查**：Prompt 是否強調「量大於價」和「解釋主力行為」？
- [ ] **輸出檢查**：Prompt 是否要求輸出「主力行為解釋」、「意圖判斷」、「未來預測」？
- [ ] **輸出檢查**：Prompt 是否說明「不需要輸出技術分析的數值結論」（因為已由程式計算好）？
- [ ] **數據檢查**：Prompt 是否說明技術指標已由程式計算好，直接使用？
- [ ] **數據檢查**：Prompt 是否強調結合 P2.5 的機構級數據進行分析？
- [ ] **數據檢查**：Prompt 是否說明 P2 的財務指標已繼承，不需要重複搜尋與計算？

### P2 Prompt 對齊檢查

- [ ] **禁止計算檢查**：Prompt 是否明確禁止計算財務指標？
- [ ] **提取檢查**：Prompt 是否強調從權威網站提取財務指標？
- [ ] **數據源檢查**：Prompt 是否明確說明優先使用外部權威數據源？

### 其他 Phase Prompt 檢查

- [ ] **P0-P1**：是否有誤用 AI 計算可以用程式算的東西？
- [ ] **P5 Weekly/Monthly/Quarterly**：是否有誤用 AI 計算可以用程式算的東西？

---

## ✅ 修正行動清單

### 立即修正（Critical）

1. **P3 Prompt 強化** ⭐⭐⭐⭐⭐（最高優先級）
   - 加入機構級預測視角原則
   - 明確禁止輸出程式就能算的技術指標結論
   - 強調主力行為解釋、意圖判斷、未來預測
   - **預計工時**：2h

2. **確認 P2 Prompt** ⭐⭐⭐
   - 確認財務指標提取邏輯正確
   - 確認禁止計算的要求明確
   - **預計工時**：0.5h（檢查即可）

### 確認事項

3. **確認所有 Phase Prompt**
   - 檢查是否有其他 Phase 誤用了 AI 計算程式就能算的東西
   - **預計工時**：1h

---

## 🎯 總結

### ✅ 正確的分配

1. **程式計算任務**：11 個，全部已實現 ✅
2. **AI 模型任務**：18 個，17 個已確認，1 個需強化 Prompt ⚠️

### ⚠️ 需要立即修正

1. **P3 Prompt 需要強化**：
   - 加入機構級預測視角原則
   - 明確禁止輸出程式就能算的技術指標結論
   - 強調「預測未來」而非「技術分析」

### ✅ 已確認正確

1. **P5 Daily 技術指標計算**：已用程式實現 ✅
2. **P4 資金配置計算**：已用程式實現 ✅
3. **P2 財務指標處理**：已明確要求提取而非計算 ✅

---

**文檔版本**：V1.0  
**最後更新**：2025-01-14  
**狀態**：✅ 完整檢查完成，發現 1 個需要立即修正的問題（P3 Prompt 強化）
