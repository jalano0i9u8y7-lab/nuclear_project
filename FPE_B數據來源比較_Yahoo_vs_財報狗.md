# FPE_B 數據來源比較：Yahoo Finance vs 財報狗 V8.0

**比較日期**：2026-01-16  
**目的**：評估 Yahoo Finance 和財報狗哪個更適合作為 FPE_B 的數據來源

---

## 📋 背景說明

根據用戶更正：
- 財報狗的 Forward P/E 實際上是 **FPE_B**（分析師預估）
- 可以作為 FPE_B 的數據來源之一
- 需要與目前的 Yahoo Finance 比較哪個更合適

---

## 🔍 方案比較

### 方案 1：Yahoo Finance（目前使用）

**優點**：
- ✅ **跨市場覆蓋最廣**：美股、台股（.TW）、日股（.T）
- ✅ **多分析師共識**：整合 S&P Global Market Intelligence、Morningstar 等大行數據
- ✅ **分析師數量多**：通常有較多分析師參與預估
- ✅ **數據更新頻繁**：
  - Forward P/E 會在有分析師修訂 EPS 預估時更新（通常每日或接近每日，對於活躍覆蓋的股票）
  - 股價變化時也會影響 Forward P/E（因為 Forward P/E = Price / Forward EPS）
  - 數據提供者（S&P Capital IQ）通常在幾分鐘到幾小時內更新預估數據
  - 對於大型、被頻繁覆蓋的公司，更新更頻繁
  - 無固定的公開更新時間表，更新取決於新資訊（財報發布、公司指引、重大新聞等）

**缺點**：
- ❌ **非官方 API**：可能被限流或封鎖
- ❌ **解析複雜度**：需要 HTML 解析，結構可能變動
- ❌ **穩定性和合規風險**：大量抓取可能有合規問題
- ⚠️ **更新頻率不固定**：雖然更新頻繁，但沒有保證的更新時間表，小型公司更新可能較少

**技術實現**：
- 爬蟲方式（UrlFetchApp）
- 需要解析 HTML 提取 Forward P/E 或 EPS
- 已實現：`getFPE_B_FromYahooFinance()`

---

### 方案 2：財報狗（新增選項）

**優點**：
- ✅ **已整合到 CSE**：可以使用現有的 P2_US_TAIWAN CSE 架構
- ✅ **數據格式統一**：與其他財務數據來源一致
- ✅ **穩定性較好**：CSE 架構相對穩定
- ✅ **合規風險較低**：使用 Google CSE，符合系統設計

**缺點**：
- ❌ **僅限美股/台股**：無法覆蓋日股（需要 buffet code）
- ⚠️ **分析師數量未知**：需要確認是否為多分析師共識
- ⚠️ **數據更新頻率未知**：需要確認更新頻率

**技術實現**：
- 可以使用 CSE 搜尋（與 FPE_A 數據收集方式一致）
- 從 CSE 搜尋結果中提取 Forward P/E
- 需要實作：類似於從 CSE 搜尋結果提取其他財務指標的方式

---

## 📊 對比表

| 項目 | Yahoo Finance | 財報狗 |
|------|--------------|--------|
| **市場覆蓋** | ✅ 美股/台股/日股 | ⚠️ 僅美股/台股 |
| **多分析師共識** | ✅ 是（Morningstar、Refinitiv 等） | ⚠️ 需確認 |
| **數據更新頻率** | ✅ 頻繁（通常每日或接近每日，活躍股票）<br/>⚠️ 無固定時間表，取決於分析師修訂和新資訊 | ⚠️ 需確認 |
| **技術實現** | ❌ 爬蟲（複雜） | ✅ CSE 搜尋（簡單） |
| **穩定性** | ⚠️ 中等（可能被限流） | ✅ 高（CSE 架構） |
| **合規風險** | ⚠️ 中等 | ✅ 低（使用 Google CSE） |
| **維護成本** | ⚠️ 高（HTML 解析） | ✅ 低（CSE 搜尋） |

---

## 💡 建議方案

### 方案 A：財報狗優先，Yahoo Finance 備用（推薦）

**理由**：
1. ✅ **技術實現簡單**：可以使用現有的 CSE 架構
2. ✅ **穩定性較好**：CSE 架構相對穩定
3. ✅ **合規風險低**：使用 Google CSE
4. ✅ **維護成本低**：不需要 HTML 解析

**實作方式**：
- 優先：從財報狗 CSE 搜尋結果中提取 Forward P/E（FPE_B）
- 備用：如果財報狗沒有，則使用 Yahoo Finance

**適用市場**：
- 美股/台股：財報狗（P2_US_TAIWAN CSE）
- 日股：需要評估 buffet code 是否有類似數據，或使用 Yahoo Finance

---

### 方案 B：Yahoo Finance 優先，財報狗備用

**理由**：
1. ✅ **跨市場覆蓋廣**：可以統一處理三個市場
2. ✅ **多分析師共識**：數據來源可靠

**實作方式**：
- 優先：Yahoo Finance（目前實現）
- 備用：財報狗（新增）

**適用市場**：
- 所有市場：Yahoo Finance
- 美股/台股：財報狗作為備用

---

### 方案 C：混合使用（最穩健）

**理由**：
1. ✅ **互補性強**：兩個數據源可以互相驗證
2. ✅ **穩定性最高**：一個失效時有備用
3. ✅ **數據可靠性**：可以比較兩個來源的差異

**實作方式**：
- 同時收集兩個來源的數據
- 比較差異，如果差異不大，使用平均值
- 如果差異很大，標註並分析原因

**適用市場**：
- 美股/台股：財報狗 + Yahoo Finance
- 日股：Yahoo Finance（財報狗不適用）

---

## ✅ 推薦方案

**推薦：方案 A（財報狗優先，Yahoo Finance 備用）**

**理由**：
1. ✅ **技術實現簡單**：可以使用現有的 CSE 架構，不需要複雜的 HTML 解析
2. ✅ **穩定性較好**：CSE 架構相對穩定，不會被限流
3. ✅ **合規風險低**：使用 Google CSE，符合系統設計
4. ✅ **維護成本低**：與其他財務數據收集方式一致

**實作步驟**：
1. 實作從財報狗 CSE 搜尋結果中提取 Forward P/E 的邏輯
2. 測試財報狗是否提供 Forward P/E（FPE_B）
3. 如果財報狗數據可靠，優先使用財報狗
4. Yahoo Finance 作為備用（例如：日股、或財報狗失效時）

---

**下一步**：測試財報狗的 Forward P/E 是否適合作為 FPE_B 的數據來源。
