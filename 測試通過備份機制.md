# 測試通過備份機制

## ⚠️ 重要規則

**每次用戶說「測試OK」或「測試通過」時，必須立即執行以下操作：**

### 1. 立即備份

**必須執行**：
```bash
# 1. 創建備份資料夾（使用日期時間戳）
mkdir -p backups/測試通過_YYYY-MM-DD_HHMMSS

# 2. 使用 clasp pull 下載 GAS 上的所有代碼
clasp pull --force

# 3. 複製所有 src/ 目錄下的文件到備份資料夾
cp -r src/ backups/測試通過_YYYY-MM-DD_HHMMSS/

# 4. 創建備份說明文件
echo "測試通過時間：YYYY-MM-DD HH:MM:SS" > backups/測試通過_YYYY-MM-DD_HHMMSS/備份說明.txt
echo "測試內容：[描述測試的步驟]" >> backups/測試通過_YYYY-MM-DD_HHMMSS/備份說明.txt
echo "測試結果：通過" >> backups/測試通過_YYYY-MM-DD_HHMMSS/備份說明.txt
```

### 2. 備份清單

每次備份必須包含：
- ✅ 所有 `src/` 目錄下的 `.js` 文件
- ✅ `appsscript.json`
- ✅ 相關配置文件
- ✅ 測試通過的日誌截圖或記錄（如果有的話）

### 3. 備份命名規則

格式：`測試通過_[功能名稱]_YYYY-MM-DD_HHMMSS`

範例：
- `測試通過_P1_Step1_2026-01-25_003000`
- `測試通過_P1_Step2_2026-01-25_120000`
- `測試通過_P0_完整流程_2026-01-25_180000`

### 4. 恢復流程

如果之後修改導致功能損壞：

1. **立即停止修改**
2. **檢查最近的備份**：找到最後一個「測試通過」的備份
3. **恢復備份**：
   ```bash
   # 恢復所有文件
   cp -r backups/測試通過_XXX/src/* src/
   
   # 上傳到 GAS
   clasp push --force
   ```
4. **驗證恢復**：確認功能恢復正常
5. **重新開始修改**：在恢復的基礎上，小心地進行修改

### 5. 修改前檢查

**在進行任何修改前，必須**：

1. ✅ **確認當前版本是測試通過的版本**
2. ✅ **如果有備份，先確認備份存在**
3. ✅ **記錄要修改的內容和原因**
4. ✅ **修改後立即測試，確保沒有破壞已有功能**

### 6. 自動備份腳本

**建議創建自動備份腳本**：

```bash
#!/bin/bash
# backup_on_test_pass.sh

TIMESTAMP=$(date +"%Y-%m-%d_%H%M%S")
BACKUP_DIR="backups/測試通過_${TIMESTAMP}"

mkdir -p "$BACKUP_DIR"
cp -r src/ "$BACKUP_DIR/"
cp appsscript.json "$BACKUP_DIR/" 2>/dev/null || true

echo "測試通過時間：$(date '+%Y-%m-%d %H:%M:%S')" > "$BACKUP_DIR/備份說明.txt"
echo "測試內容：$1" >> "$BACKUP_DIR/備份說明.txt"
echo "測試結果：通過" >> "$BACKUP_DIR/備份說明.txt"

echo "✅ 備份完成：$BACKUP_DIR"
```

---

## 📋 當前備份清單

### 已確認測試通過的備份

| 日期時間 | 功能 | 備份路徑 | 狀態 |
|---------|------|---------|------|
| 待補充 | - | - | - |

---

## 🚨 緊急恢復

如果當前版本損壞，立即執行：

```bash
# 1. 列出所有備份
ls -la backups/

# 2. 找到最後一個測試通過的備份
# 3. 恢復備份
cp -r backups/測試通過_XXX/src/* src/
clasp push --force
```

---

**創建日期**：2026-01-25  
**目的**：防止修改破壞已測試通過的功能，確保可以快速恢復
