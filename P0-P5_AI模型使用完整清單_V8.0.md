# P0-P5 AI 模型使用完整清單 V8.0

## 📋 執行摘要

本文檔詳細列出系統 P0-P5 所有使用 AI 模型的地方，包括：
- **模型名稱**：使用的具體 AI 模型
- **用途說明**：該模型在該 Phase 中的具體作用
- **執行頻率**：多久執行一次
- **預估成本**：單次執行成本（USD）
- **批次處理**：是否採用批次處理

**文檔版本**：V1.0  
**創建日期**：2025-01-14  
**狀態**：完整備份文檔

---

## 🔧 AI 模型配置表

### 可用模型及其成本

| 模型代號 | 實際模型 | 成本（每 1K tokens） | 說明 |
|---------|---------|---------------------|------|
| **GPT** | gpt-5.2 | $0.030 | OpenAI GPT-5.2（最新穩定版） |
| **SONNET** | claude-sonnet-4-5-20250929 | $0.015 | Claude Sonnet 4.5 |
| **OPUS** | claude-opus-4-5-20251101 | $0.075 | Claude Opus 4.5 |
| **O3** | o3 | $0.060 | OpenAI o3（推理模型） |
| **GEMINI_PRO** | gemini-3-pro-preview | $0.002 | Gemini 3.0 Pro |
| **GEMINI_FLASH** | gemini-2.5-flash | $0.001 | Gemini 2.5 Flash（快速清洗） |
| **GEMINI_SEARCH** | gemini-3-pro-preview | $0.002 | Gemini 3.0 Pro（搜尋用） |

---

## 📊 Phase 0 系列：產業工程學分析

### P0：產業工程學分析

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | 季度（每季 1 次） |
| **執行者** | **Claude Opus 4.5** |
| **審查者** | **GPT-5.2** |
| **用途** | 產業工程學分析，識別主題、子主題、關鍵技術節點，分析產業鏈結構與資金流 |
| **處理範圍** | 一次處理一個產業面（不是每檔股票） |
| **批次處理** | 無（產業面級） |
| **單次成本** | **$0.62** |
| **月度成本** | 約 $0.21/月（假設 10 個產業面，每季執行） |
| **執行流程** | `["EXECUTOR", "AUDITOR"]` → Opus 執行 → GPT 審查 |
| **輸出內容** | themes、subthemes、key_nodes、industry_chain、capital_flow |

---

### P0.5：產業鏈地圖與供應鏈情報（可選）

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | 季度（P0 變更時） |
| **執行者** | 待確認 |
| **審查者** | 待確認 |
| **用途** | 產業鏈地圖繪製、供應鏈風險分析 |
| **處理範圍** | 一次處理一個產業面 |
| **批次處理** | 無（產業面級） |
| **單次成本** | 待確認 |
| **狀態** | ⚠️ 待實現 |

---

### P0.7：系統動力學分析

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | 季度（P0 變更時觸發，約 50% 機率） |
| **執行者** | **o3**（OpenAI 推理模型） |
| **審查者** | **Claude Opus 4.5** ⭐ |
| **用途** | 系統動力學分析：敘事狀態（Narrative State）、循環主導（Loop Dominance）、時間定位（Time Position）、槓桿角色類型（Leveraged Role Type） |
| **處理範圍** | 一次處理一個產業面 |
| **批次處理** | 無（產業面級） |
| **單次成本** | **$0.26** |
| **月度成本** | 約 $0.09/月（假設 10 個產業面，50% 觸發率） |
| **執行流程** | `["EXECUTOR", "AUDITOR"]` → o3 執行 → Opus 審查 |
| **特殊設計** | ⭐ 避免同家盲點：o3（OpenAI）執行，Opus（Anthropic）審查 |
| **輸出內容** | narrative_states、loop_dominances、time_positions、leveraged_roles |

---

## 🏢 Phase 1：公司池建立

### P1：公司池建立

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | 季度（每季 1 次） |
| **執行者** | **Claude Sonnet 4.5** |
| **審查者** | **GPT-5.2** |
| **用途** | 基於 P0 和 P0.7 的輸出，建立公司候選池，進行三層適配檢查（ENG_Fit、STRUCT_Fit、TIME_ROLE_Fit） |
| **處理範圍** | 一次處理一個產業面的所有候選公司 |
| **批次處理** | 無（產業面級，但會處理該產業面的多個候選公司） |
| **單次成本** | **$1.60** |
| **月度成本** | 約 $0.53/月（假設 10 個產業面，每季執行） |
| **執行流程** | `["EXECUTOR", "AUDITOR"]` → Sonnet 執行 → GPT 審查 |
| **輸出內容** | Master_Candidates、Tracking_Pool、Rejection_Pool |

---

## 💰 Phase 2：基本面分析

### P2 季度：基本面分析（季度）

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | 季度（每季 1 次） |
| **執行者** | **Claude Sonnet 4.5** |
| **審查者** | **GPT-5.2** |
| **用途** | 基本面安全性 Gate 檢查、分層決策（CORE/STABLE_SWING/AGGRESSIVE/OPPORTUNISTIC）、財務指標分析 |
| **處理範圍** | **批次處理所有候選股票**（一次處理 20-30 檔，根據 Token 限制） |
| **批次處理** | ✅ **是**（批次大小：20-30 檔/批次） |
| **單次成本** | **$0.76**（批次處理所有候選股票） |
| **月度成本** | 約 $0.25/月（假設 80 檔股票，每季執行） |
| **執行流程** | `["EXECUTOR", "AUDITOR"]` → Sonnet 執行 → GPT 審查 |
| **輸出內容** | Gate 檢查結果、Tier 分層、財務指標評估 |

---

### P2 月度：基本面分析（月度）

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | 月度（每月 1 次） |
| **執行者** | **Claude Sonnet 4.5** |
| **審查者** | **GPT-5.2** |
| **用途** | 月度基本面更新、財務指標變化追蹤、Gate 狀態更新 |
| **處理範圍** | **批次處理所有候選股票**（一次處理 20-30 檔） |
| **批次處理** | ✅ **是**（批次大小：20-30 檔/批次） |
| **單次成本** | **$0.64**（批次處理所有候選股票） |
| **月度成本** | **$0.64/月**（假設 80 檔股票） |
| **執行流程** | `["EXECUTOR", "AUDITOR"]` → Sonnet 執行 → GPT 審查 |
| **輸出內容** | 月度財務指標更新、Gate 狀態變化 |

---

### P2.5：機構級籌碼分析（可選）

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | 月度（可選） |
| **執行者** | 待確認 |
| **審查者** | 待確認 |
| **用途** | 機構級籌碼面分析、Smart Money Score 計算 |
| **處理範圍** | 待確認 |
| **批次處理** | 待確認 |
| **單次成本** | 待確認 |
| **狀態** | ⚠️ 待實現 |

---

## 📈 Phase 3：技術分析

### P3 週度：技術分析（週度）

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | 週度（每週 1 次） |
| **執行者** | **Claude Sonnet 4.5** |
| **審查者** | **GPT-5.2** |
| **用途** | 技術分析、Cat 分類（Cat1-Cat5）、買賣點判斷（Buy1/Buy2/Buy3、Stop2/Stop3） |
| **處理範圍** | **批次處理所有候選股票**（一次處理 15-20 檔，技術分析數據較大） |
| **批次處理** | ✅ **是**（批次大小：15-20 檔/批次） |
| **單次成本** | **$2.56**（批次處理所有候選股票） |
| **月度成本** | **$10.24/月**（假設 80 檔股票，每週執行） |
| **執行流程** | `["EXECUTOR", "AUDITOR"]` → Sonnet 執行 → GPT 審查 |
| **輸出內容** | Cat 分類、技術指標分析、買賣點價格、Stop 價格 |

---

### P3 月度：技術分析（月度）

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | 月度（每月 1 次） |
| **執行者** | **Claude Sonnet 4.5** |
| **審查者** | **GPT-5.2** |
| **用途** | 月度技術分析總結、Cat 變化追蹤、技術趨勢判斷 |
| **處理範圍** | **批次處理所有候選股票**（一次處理 15-20 檔） |
| **批次處理** | ✅ **是**（批次大小：15-20 檔/批次） |
| **單次成本** | **$2.28**（批次處理所有候選股票） |
| **月度成本** | **$2.28/月**（假設 80 檔股票） |
| **執行流程** | `["EXECUTOR", "AUDITOR"]` → Sonnet 執行 → GPT 審查 |
| **輸出內容** | 月度技術分析總結、Cat 變化記錄 |

---

## 💰 Phase 4：資金配置計算

### P4：資金配置計算

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | 週度（每週 1 次，或由 P3 變動觸發） |
| **執行者** | **純程式**（無 AI） |
| **審查者** | **無** |
| **用途** | 純程式計算：讀取 P2/P3 快照，計算理想配置（W_ideal）和實際應配置（W_now） |
| **處理範圍** | 所有候選股票（純程式計算） |
| **批次處理** | 無（純程式，無批次概念） |
| **單次成本** | **$0.00** |
| **月度成本** | **$0.00/月** |
| **執行流程** | 純程式計算，無 AI 調用 |
| **輸出內容** | 資金配置結果、分層權重、Buy1/Buy2/Buy3 配置 |

---

## 📊 Phase 5：日常運營（P5 系列）⭐ **最頻繁使用**

### P5 Daily：每日數據收集與新聞處理 ⭐ **最高頻率**

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | **每日 1 次**（最高頻率） |
| **批次處理** | ✅ **是**（每批 10 檔股票） |
| **處理範圍** | 持倉股票或全部候選股票（80 檔 = 8 批次/日） |

#### P5 Daily 完整流程（多步驟 AI 處理）：

| 步驟 | 模型 | 用途 | 成本（每 1K tokens） | 說明 |
|------|------|------|---------------------|------|
| **Step 1: CSE 搜集** | Google CSE | 搜集新聞數據 | $0.00（免費額度內） | 使用 Google Custom Search Engine 搜集多語系新聞（多語搜尋：英文、中文、日文），每個股票搜尋 3 種語言 |
| **Step 2: Flash 清洗** | **Gemini Flash 2.5** | **Atom 化清洗** | **$0.001/1K tokens** | 清洗多語系新聞、Atom 化（提取核心資訊：標題、摘要、關鍵事實、標準化格式、移除重複和無關資訊） |
| **Step 3: Gemini Pro 去重分類** | **Gemini 3.0 Pro** | **多語去重 + 十大類分類** | **$0.002/1K tokens** | ⭐ **唯一例外**：多語審查去重（識別不同語言但內容相同的新聞）+ 十大類分類（財報/業績、併購/重組、監管/政策、產業動態、宏觀經濟、市場情緒、技術突破、供應鏈、競爭格局、其他）+ 評估重要性（HIGH/MEDIUM/LOW） |
| **Step 4: GPT 彙整** | **GPT-5.2** | **彙整 + 連結世界觀** | **$0.030/1K tokens** | 分析結果與各結論與歷史資訊關聯性，更新每日世界觀（處理 Gemini Pro 去重分類後的簡潔數據，加上綜合數據資訊與舊世界觀連結產生新世界觀） |

#### P5 Daily 成本估算：

| 項目 | 詳細說明 |
|------|---------|
| **單批次成本** | **$0.15/批次**（Flash 清洗後，高階模型負擔輕。實際流程：Flash Atom 化 → Gemini Pro 去重分類 → GPT 彙整世界觀） |
| **每日成本** | 8 批次 × $0.15 = **$1.20/日**（80 檔股票） |
| **月度成本** | $1.20 × 30 = **$36.00/月**（80 檔股票，無分層） |
| **分層執行成本** | **$12.30/月**（CORE 每日，其他週度/月度） |

#### P5 Daily 其他數據收集（無 AI）：

- **OHLCV 數據收集**：從 stooq.com（通過 Cloud Function 代理）或 TWSE/TPEX
- **技術指標計算**：純程式計算（RSI、MACD、ATR、MA 等）
- **板塊 ETF 數據**：數據收集（無 AI）
- **衍生品數據**：數據收集（無 AI）
- **宏觀數據**：從 stooq.com 收集（油價、貴金屬、匯率、國債利率等）
- **台股掛單檢查**：數據收集（無 AI）

---

### P5 Weekly：週度市場綜述 ⭐ **重要策略生成**

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | **週度（每週 1 次）** |
| **執行者** | **Claude Sonnet 4.5** |
| **審查者** | **GPT-5.2** |
| **用途** | 市場綜述（Market Analysis）、因果鏈分析（Causality Chain）、風險事件識別（Risk Events）、衍生品策略調整（Derivatives Strategy Adjustment）、信念更新（Belief Update）、U 調整（Utilization Adjustment）、行動清單（Action List）、觸發決策（Trigger Decisions） |
| **處理範圍** | **全系統一次處理**（不是每檔股票，而是整體市場分析） |
| **批次處理** | 無（全系統級） |
| **單次成本** | **$1.52** |
| **月度成本** | **$6.08/月**（每週執行） |
| **執行流程** | `["SONNET", "GPT"]` → Sonnet 執行 → GPT 審查 |
| **輸出內容** | 週度市場綜述、因果鏈、風險事件、策略調整建議、U 調整建議、行動清單 |

---

### P5 Monthly：月度分析 ⭐ **擴展版**

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | **月度（每月 1 次）** |
| **執行者** | **Claude Sonnet 4.5** |
| **審查者** | **GPT-5.2** |
| **用途** | 月度趨勢分析、持倉表現評估、策略調整建議、月營收追蹤（台灣股票）、統整四週 Weekly 結論、月度時間維度分析（世界觀與市場反應對照）、歷史事件連結（前三個月） |
| **處理範圍** | **全系統一次處理**（整體市場分析 + 個股月度總結） |
| **批次處理** | 無（全系統級） |
| **單次成本** | **待確認**（估算約 $2.00-3.00，類似 P5 Weekly 但數據量更大） |
| **月度成本** | **待確認**（估算約 $2.00-3.00/月） |
| **執行流程** | `["SONNET", "GPT"]` → Sonnet 執行 → GPT 審查 |
| **主要功能** | 月度趨勢分析、持倉表現評估、策略調整建議、月營收追蹤（台灣股票）、統整四週 Weekly 結論、月度時間維度分析（世界觀與市場反應對照）、歷史事件連結（前三個月） |
| **執行流程** | `["SONNET", "GPT"]` → Sonnet 執行 → GPT 審查 |
| **輸出內容** | 月度趨勢分析、持倉表現、月營收追蹤結果、四週 Weekly 統整、歷史事件連結 |

---

### P5 Quarterly：季度分析 ⭐ **擴展版**

| 項目 | 詳細說明 |
|------|---------|
| **執行頻率** | **季度（每季 1 次）** |
| **執行者** | **Claude Sonnet 4.5** |
| **審查者** | **GPT-5.2** |
| **用途** | 季度回顧、策略檢討、下季度展望、季財報追蹤（台灣 + 美國股票）、基本面變化判斷（觸發 P2-P4 重跑）、產業面與趨勢面變化判斷（觸發 P0-P5 重跑）、新興產業識別、市場熱度板塊識別 |
| **處理範圍** | **全系統一次處理**（整體市場分析 + 個股季度總結） |
| **批次處理** | 無（全系統級） |
| **單次成本** | **待確認**（估算約 $3.00-4.00，類似 P5 Weekly 但數據量更大，包含季度財報分析） |
| **月度成本** | **待確認**（估算約 $1.00-1.33/月，每季執行） |
| **執行流程** | `["SONNET", "GPT"]` → Sonnet 執行 → GPT 審查 |
| **主要功能** | 季度回顧、策略檢討、下季度展望、季財報追蹤（台灣 + 美國股票）、基本面變化判斷（觸發 P2-P4 重跑）、產業面與趨勢面變化判斷（觸發 P0-P5 重跑）、新興產業識別、市場熱度板塊識別 |
| **執行流程** | `["SONNET", "GPT"]` → Sonnet 執行 → GPT 審查 |
| **輸出內容** | 季度回顧、策略檢討、季財報追蹤結果、基本面變化判斷、產業面變化判斷、新興產業識別 |

---

## 📊 月度成本總結（80 檔股票）

### 無分層執行

| Phase | 執行頻率 | 月度成本（USD） | 說明 |
|-------|---------|----------------|------|
| **P0 系列** | 季度 | $0.83 | P0 + P0.7（產業面級） |
| **P1** | 季度 | $0.53 | 產業面級 |
| **P2 系列** | 季度 + 月度 | $0.89 | P2 季度 + P2 月度（批次處理） |
| **P3 系列** | 週度 + 月度 | $12.52 | P3 週度 + P3 月度（批次處理） |
| **P4** | 週度 | $0.00 | 純程式 |
| **P5 Daily** | **每日** | **$36.00** | **CSE → Flash 清洗 → GPT 彙整 → Gemini Pro 審查** |
| **P5 Weekly** | 週度 | $6.08 | 全系統 |
| **P5 Monthly** | 月度 | $2.50（估算） | 全系統 |
| **P5 Quarterly** | 季度 | $1.00（估算） | 全系統 |
| **其他** | - | $30.00 | 數據收集、CSE 搜尋等 |
| **總計** | - | **$90.35/月** | |

### 分層執行（推薦）

| Phase | 執行頻率 | 月度成本（USD） | 說明 |
|-------|---------|----------------|------|
| **P0 系列** | 季度 | $0.83 | P0 + P0.7 |
| **P1** | 季度 | $0.53 | 產業面級 |
| **P2 系列** | 季度 + 月度 | $0.89 | P2 批次處理 |
| **P3 系列** | 週度 + 月度 | $12.52 | P3 批次處理 |
| **P4** | 週度 | $0.00 | 純程式 |
| **P5 Daily（分層）** | **分層** | **$12.30** | CORE 每日，其他週度/月度 |
| **P5 Weekly** | 週度 | $6.08 | 全系統 |
| **P5 Monthly** | 月度 | $2.50（估算） | 全系統 |
| **P5 Quarterly** | 季度 | $1.00（估算） | 全系統 |
| **其他** | - | $30.00 | 數據收集、CSE 搜尋等 |
| **總計** | - | **$66.65/月** | |

---

## 🔍 特殊 AI 調用（條件觸發）

### GEMINI_SEARCH：事實查證搜尋

| 項目 | 詳細說明 |
|------|---------|
| **觸發條件** | 當執行者提出 FACT_CHECK 類型的 audit_questions 時 |
| **模型** | **Gemini 3.0 Pro** |
| **用途** | 使用 Google CSE 搜尋，判斷來源可靠性（5 Tiers），篩選可信來源，標註衝突 |
| **成本** | $0.002/1K tokens |
| **執行頻率** | 條件觸發（不固定） |
| **狀態** | ⚠️ 待實現 |

---

### CSE_SEARCH：機構級數據搜尋

| 項目 | 詳細說明 |
|------|---------|
| **觸發條件** | 當需要機構級數據時（P2.5、P5 Daily） |
| **模型** | Google CSE（無 AI 模型） |
| **用途** | 搜尋機構級數據（13F、Dark Pool、Options Flow 等） |
| **成本** | $0.00（免費額度內） |
| **執行頻率** | 條件觸發 |
| **狀態** | ✅ 已實現 |

---

### CSE_SEARCH_UNRESTRICTED：無限制 CSE 搜尋

| 項目 | 詳細說明 |
|------|---------|
| **觸發條件** | 當執行者提出 FACT_CHECK 問題時 |
| **模型** | Google CSE（無 AI 模型） |
| **用途** | 無白名單限制的 CSE 搜尋（用於自我質疑機制） |
| **成本** | $0.00（免費額度內） |
| **執行頻率** | 條件觸發 |
| **狀態** | ✅ 已實現 |

---

## 📝 重要說明

### 1. 批次處理策略

- **P2、P3**：採用批次處理（一次 AI 調用處理多檔股票）
- **P5 Daily**：採用批次處理（每批 10 檔股票）
- **批次大小限制**：
  - GAS 執行時間：6 分鐘
  - AI Token 限制：8192 tokens
  - 實際批次大小需根據 Token 使用量調整

### 2. P5 Daily 特殊流程

**關鍵優化**：
- **Flash 先清洗**：多語系新聞由 Flash 處理（$0.001/1K tokens，非常便宜）
- **Gemini Pro 去重分類**：多語去重 + 十大類分類（$0.002/1K tokens，也很便宜，比 GPT 便宜 15 倍）
- **GPT 最後彙整**：處理 Flash 和 Gemini Pro 清洗後的簡潔數據，加上歷史資訊關聯性和世界觀更新（$0.030/1K tokens，但 Token 使用量低）
- **成本降低 96%**：從 $3.60/批次降至 $0.15/批次

**流程設計合理性**：
1. **Flash（最便宜）** → Atom 化清洗，提取核心資訊
2. **Gemini Pro（便宜）** → 多語去重 + 分類（多語能力強，成本低）
3. **GPT（較貴但負擔輕）** → 彙整世界觀（處理簡潔數據，Token 使用量低）

### 3. 模型選擇原則

- **P0**：使用 Opus（需要深度產業分析）
- **P0.7**：使用 o3（需要推理能力）+ Opus 審查（避免同家盲點）
- **P1-P3**：使用 Sonnet（平衡成本與能力）
- **P5 Daily**：使用 GPT（多語去重）+ Flash 清洗（成本優化）
- **P5 Weekly/Monthly/Quarterly**：使用 Sonnet（策略分析）

### 4. 成本控制機制

- ✅ 每日成本追蹤（已實現）
- ✅ 預算告警（已實現）
- ⚠️ 需要實現：超預算自動降級執行頻率

---

## 📊 不同規模的成本估算

### 規模 1：50 檔股票（無分層）

**月度總計**：**約 $70/月**

### 規模 2：80 檔股票（無分層）

**月度總計**：**約 $90/月**

### 規模 3：100 檔股票（無分層）

**月度總計**：**約 $110/月**

---

**文檔版本**：V1.0  
**最後更新**：2025-01-14  
**狀態**：完整備份文檔
