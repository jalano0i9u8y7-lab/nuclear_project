# 系統數據線完整性檢查報告 V8.0

## 📋 檢查日期

**檢查日期**：2026-01-16  
**版本**：V8.0  
**目的**：確認所有數據和新聞收集都有對應的白名單 CSE，避免重複工作和浪費成本

---

## ✅ 已配置的 CSE 清單

根據 `src/02_M0_CONFIG.js` 的 `GOOGLE_CSE_CONFIG`，系統已配置以下 CSE：

1. **P5_OHLCV** ✅
   - CX: `GOOGLE_CSE_CX_P5_OHLCV`
   - Sites: stooq.com, nasdaq.com, nyse.com
   - 用途：OHLCV 數據收集

2. **P5_SECTOR_ETF** ✅
   - CX: `GOOGLE_CSE_CX_P5_SECTOR_ETF`
   - Sites: ishares.com, ssga.com, spdrs.com, vanguard.com, etfdb.com
   - 用途：板塊 ETF 數據收集

3. **P5_DERIVATIVES** ✅
   - CX: `GOOGLE_CSE_CX_P5_DERIVATIVES`
   - Sites: cboe.com, theocc.com, cmegroup.com, nasdaq.com, taifex.com.tw, jpx.co.jp, lseg.com
   - 用途：衍生品數據收集

4. **P5_NEWS** ✅
   - CX: `GOOGLE_CSE_CX_P5_NEWS`
   - Sites: reuters.com, ft.com, wsj.com, nikkei.com, federalreserve.gov, bis.org, imf.org, ecb.europa.eu, boj.or.jp, treasury.gov, whitehouse.gov, pbc.gov.cn, ndrc.gov.cn, mof.gov.cn, meti.go.jp, cbc.gov.tw, ndc.gov.tw
   - 用途：新聞收集

5. **P5_WORLD** ✅
   - CX: `GOOGLE_CSE_CX_P5_WORLD`
   - Sites: fred.stlouisfed.org, bea.gov, bls.gov, treasury.gov, worldbank.org
   - 用途：宏觀經濟數據收集

6. **INSTITUTIONAL_DATA** ✅
   - CX: `GOOGLE_CSE_CX_INSTITUTIONAL`
   - Sites: sec.gov, finra.org, nasdaq.com, cboe.com, dtcc.com
   - 用途：機構級數據（13F、Dark Pool、Options Flow、交割清算）

7. **P2_TAIWAN** ✅
   - CX: `GOOGLE_CSE_CX_P2_TAIWAN`
   - Sites: mops.twse.com.tw, twse.com.tw, tpex.org.tw
   - 用途：台股財務數據收集

8. **P2_JAPAN** ✅
   - CX: `GOOGLE_CSE_CX_P2_JAPAN`
   - Sites: jpx.co.jp, tdnet.info, edinet-fsa.go.jp, kabutan.jp
   - 用途：日股財務數據收集

9. **SUPPLY_CHAIN** ✅
   - CX: `GOOGLE_CSE_CX_SUPPLY_CHAIN`
   - Sites: sec.gov, mops.twse.com.tw, bloomberg.com, reuters.com, importyeti.com, panjiva.com, marinetraffic.com
   - 用途：供應鏈數據收集

10. **EARNINGS_CALENDAR** ✅
    - CX: `GOOGLE_CSE_CX_EARNINGS`
    - Sites: sec.gov, edgar.sec.gov, ir.stockpr.com, edinet-fsa.go.jp, tdnet.info, mops.twse.com.tw
    - 用途：財報日曆數據收集

11. **HUMAN_SIGNAL** ⚠️
    - CX: `GOOGLE_CSE_CX_HUMAN_SIGNAL`
    - Sites: unusualwhales.com, spotgamma.com, mentorq.com, statementdog.com, moneydj.com, cmoney.tw, buffett-code.com
    - 用途：人類手動使用，不進系統

---

## 📊 各 Phase 數據收集需求與 CSE 對應檢查

### ✅ P2：財務數據收集

**數據需求**：
- 台股財務數據（營收、毛利率、營業利益率、淨利率、CFO、FCF、ROIC 等）
- 美股財務數據（10-Q/10-K）
- 日股財務數據（財報）

**CSE 使用情況**：
- ✅ **台股**：`collectTaiwanStockFinancialData()` → 使用 `P2_TAIWAN` CSE
- ✅ **美股**：`collectUSStockFinancialData()` → 使用 `INSTITUTIONAL_DATA` CSE
- ✅ **日股**：`collectJapanStockFinancialData()` → 使用 `P2_JAPAN` CSE

**狀態**：✅ **完全符合白名單原則**

---

### ✅ P2.5：機構級籌碼面數據收集

**數據需求**：
- 13F 機構持倉（季度）
- Insider Trading（每週）
- Dark Pool 活動（每週）
- 異常期權活動（每日）

**CSE 使用情況**：
- ✅ **13F 持倉**：`collectF13FHoldingsQuarterly()` → 使用 `INSTITUTIONAL_DATA` CSE
- ✅ **Insider Trading**：`collectInsiderTradingWeekly()` → 使用 `INSTITUTIONAL_DATA` CSE
- ✅ **Dark Pool**：`collectDarkPoolActivityWeekly()` → 使用 `INSTITUTIONAL_DATA` CSE
- ✅ **期權活動**：從 DERIVATIVES_DAILY 讀取（由 P5 Daily 收集，使用 `P5_DERIVATIVES` CSE）

**狀態**：✅ **完全符合白名單原則**

---

### ✅ P3：技術數據收集

**數據需求**：
- OHLCV 歷史數據（用於技術分析）

**CSE 使用情況**：
- ✅ **OHLCV**：從 `MARKET_OHLCV_DAILY` 表格讀取（由 P5 Daily 收集，使用 `P5_OHLCV` CSE）

**狀態**：✅ **完全符合白名單原則**

---

### ⚠️ P5 Daily：數據收集（部分問題）

#### 1. OHLCV 數據 ✅

**數據需求**：
- 每日 OHLCV 數據（美股、台股、日股）

**CSE 使用情況**：
- ✅ **主要方式**：使用 stooq.com（通過 Cloud Function 代理）
- ✅ **Fallback**：`collectOHLCVDataViaCSE()` → 使用 `P5_OHLCV` CSE

**狀態**：✅ **符合白名單原則**（主要使用 stooq.com，fallback 使用 CSE）

---

#### 2. Sector ETF 數據 ⚠️

**數據需求**：
- 板塊 ETF 數據（XLK、XLF、XLE 等）

**CSE 使用情況**：
- ⚠️ **目前實現**：`collectSectorETFData()` → 使用 stooq.com（通過 Cloud Function 代理）
- ❌ **問題**：沒有使用 `P5_SECTOR_ETF` CSE

**建議**：
- 應該使用 `P5_SECTOR_ETF` CSE 作為主要數據源（ishares.com, ssga.com, vanguard.com）
- stooq.com 可以作為 fallback

**狀態**：⚠️ **需要補強**：應該使用 `P5_SECTOR_ETF` CSE

---

#### 3. Derivatives 數據 ⚠️

**數據需求**：
- 期權數據（Put/Call Ratio、IV、異常期權活動）

**CSE 使用情況**：
- ❌ **目前實現**：`collectUSDerivatives()` → TODO，返回 PENDING 狀態
- ✅ **已配置 CSE**：`P5_DERIVATIVES` CSE（cboe.com, theocc.com, nasdaq.com 等）

**建議**：
- 實現 `collectUSDerivatives()` 函數，使用 `P5_DERIVATIVES` CSE
- 實現 `collectTaiwanDerivatives()` 函數，使用 `P5_DERIVATIVES` CSE（taifex.com.tw）
- 實現 `collectJapanDerivatives()` 函數，使用 `P5_DERIVATIVES` CSE（jpx.co.jp）

**狀態**：❌ **未實現**：需要實現並使用 `P5_DERIVATIVES` CSE

---

#### 4. Macro 數據 ⚠️

**數據需求**：
- 商品價格（油價、貴金屬、銅）
- 匯率（美元指數、EUR/USD、USD/JPY 等）
- 國債利率（10年期、3個月、30年期）
- 市場指數（VIX 等）

**CSE 使用情況**：
- ⚠️ **目前實現**：`collectMacroData()` → 使用 stooq.com（通過 Cloud Function 代理）
- ✅ **已配置 CSE**：`P5_WORLD` CSE（fred.stlouisfed.org, bea.gov, bls.gov, treasury.gov, worldbank.org）

**建議**：
- 應該使用 `P5_WORLD` CSE 作為主要數據源（FRED、BEA、BLS、Treasury 等官方數據源）
- stooq.com 可以作為 fallback

**狀態**：⚠️ **需要補強**：應該使用 `P5_WORLD` CSE

---

#### 5. News 數據 ✅

**數據需求**：
- 新聞原子化（公司新聞、宏觀新聞）

**CSE 使用情況**：
- ✅ **目前實現**：`collectNewsAtoms()` → 使用 `P5_NEWS` CSE

**狀態**：✅ **完全符合白名單原則**

---

#### 6. Market Breadth 數據 ⚠️

**數據需求**：
- Advance/Decline Ratio
- New High/Low Ratio
- Stocks Above MA50/MA200

**CSE 使用情況**：
- ⚠️ **目前實現**：`collectMarketBreadthData()` → 從 OHLCV 數據計算（沒有使用 CSE）
- ⚠️ **問題**：需要從交易所官方數據源獲取市場寬度數據

**建議**：
- 美股：可以使用 `P5_WORLD` CSE（NYSE、Nasdaq 官方數據）
- 台股：可以使用 `P2_TAIWAN` CSE（TWSE 官方數據）
- 日股：可以使用 `P2_JAPAN` CSE（JPX 官方數據）

**狀態**：⚠️ **需要補強**：應該從官方數據源獲取，而非僅從 OHLCV 計算

---

### ✅ P5 Weekly：數據收集

**數據需求**：
- 籌碼面數據（從 P5 Weekly Smart Money 收集）
- 宏觀數據（從 P5 Daily 的 MACRO_DATA_DAILY 表格讀取）

**CSE 使用情況**：
- ✅ **籌碼面數據**：使用 `INSTITUTIONAL_DATA` CSE（13F、Insider Trading、Dark Pool）
- ✅ **宏觀數據**：從表格讀取（由 P5 Daily 收集，應使用 `P5_WORLD` CSE）

**狀態**：✅ **完全符合白名單原則**

---

### ⚠️ P0.5：供應鏈數據收集

**數據需求**：
- 供應鏈風險監控
- 供應商財務追蹤
- 報關單數據
- 海運實物流數據

**CSE 使用情況**：
- ✅ **已配置 CSE**：`SUPPLY_CHAIN` CSE（importyeti.com, panjiva.com, marinetraffic.com, sec.gov, mops.twse.com.tw）
- ❌ **目前實現**：`P0_5_SupplyChainRiskMonitoring()` → 僅有框架，沒有實際數據收集

**建議**：
- 實現供應鏈數據收集函數，使用 `SUPPLY_CHAIN` CSE
- 收集報關單數據（importyeti.com, panjiva.com）
- 收集海運實物流數據（marinetraffic.com）
- 收集供應商財報數據（sec.gov, mops.twse.com.tw）

**狀態**：❌ **未實現**：需要實現並使用 `SUPPLY_CHAIN` CSE

---

### ⚠️ P5 Daily Earnings Monitor：財報日曆數據

**數據需求**：
- 財報日期（10-Q、10-K、日股財報、台股財報）

**CSE 使用情況**：
- ✅ **已配置 CSE**：`EARNINGS_CALENDAR` CSE（sec.gov, edgar.sec.gov, ir.stockpr.com, edinet-fsa.go.jp, tdnet.info, mops.twse.com.tw）
- ⚠️ **目前實現**：`monitorEarningsStrategiesFromWeekly()` → 僅監控策略，沒有數據收集

**建議**：
- 實現財報日曆數據收集函數，使用 `EARNINGS_CALENDAR` CSE
- 從 SEC EDGAR、EDINET、台灣公開資訊觀測站收集財報日期

**狀態**：⚠️ **部分實現**：需要實現數據收集並使用 `EARNINGS_CALENDAR` CSE

---

## ❌ 發現的問題

### 1. P5 Daily Sector ETF：未使用 CSE ⚠️

**問題**：
- `collectSectorETFData()` 使用 stooq.com（通過 Cloud Function），但沒有使用 `P5_SECTOR_ETF` CSE
- `P5_SECTOR_ETF` CSE 已配置但未使用

**影響**：
- 無法從 ETF 發行人官方網站（ishares.com, ssga.com, vanguard.com）獲取原始數據
- 依賴第三方數據源（stooq.com），不符合白名單原則

**建議修正**：
- 修改 `collectSectorETFData()`，優先使用 `P5_SECTOR_ETF` CSE
- stooq.com 作為 fallback

---

### 2. P5 Daily Derivatives：未實現 ⚠️

**問題**：
- `collectUSDerivatives()` 返回 PENDING 狀態，沒有實際實現
- `P5_DERIVATIVES` CSE 已配置但未使用

**影響**：
- 無法收集期權數據（Put/Call Ratio、IV、異常期權活動）
- P5 Daily 的衍生品數據收集功能不完整

**建議修正**：
- 實現 `collectUSDerivatives()`，使用 `P5_DERIVATIVES` CSE（cboe.com, theocc.com, nasdaq.com）
- 實現 `collectTaiwanDerivatives()`，使用 `P5_DERIVATIVES` CSE（taifex.com.tw）
- 實現 `collectJapanDerivatives()`，使用 `P5_DERIVATIVES` CSE（jpx.co.jp）

---

### 3. P5 Daily Macro：未使用 CSE ⚠️

**問題**：
- `collectMacroData()` 使用 stooq.com（通過 Cloud Function），但沒有使用 `P5_WORLD` CSE
- `P5_WORLD` CSE 已配置但未使用

**影響**：
- 無法從官方數據源（FRED、BEA、BLS、Treasury）獲取宏觀數據
- 依賴第三方數據源（stooq.com），不符合白名單原則

**建議修正**：
- 修改 `collectMacroData()`，優先使用 `P5_WORLD` CSE
- stooq.com 作為 fallback

---

### 4. P5 Daily Market Breadth：未使用 CSE ⚠️

**問題**：
- `collectMarketBreadthData()` 從 OHLCV 數據計算，沒有從官方數據源獲取
- 需要從交易所官方獲取 Advance/Decline、New High/Low 數據

**影響**：
- 市場寬度數據可能不準確（需要從交易所官方獲取）
- 無法驗證計算結果

**建議修正**：
- 美股：使用 `P5_WORLD` CSE 或 `P5_OHLCV` CSE（NYSE、Nasdaq 官方數據）
- 台股：使用 `P2_TAIWAN` CSE（TWSE 官方數據）
- 日股：使用 `P2_JAPAN` CSE（JPX 官方數據）

---

### 5. P0.5 供應鏈：未實現 ❌

**問題**：
- `P0_5_SupplyChainRiskMonitoring()` 僅有框架，沒有實際數據收集
- `SUPPLY_CHAIN` CSE 已配置但未使用

**影響**：
- 無法收集供應鏈數據（報關單、海運實物流、供應商財報）
- P0.5 供應鏈風險監控功能不完整

**建議修正**：
- 實現供應鏈數據收集函數，使用 `SUPPLY_CHAIN` CSE
- 收集報關單數據（importyeti.com, panjiva.com）
- 收集海運實物流數據（marinetraffic.com）

---

### 6. P5 Daily Earnings Monitor：未實現數據收集 ⚠️

**問題**：
- `monitorEarningsStrategiesFromWeekly()` 僅監控策略，沒有數據收集
- `EARNINGS_CALENDAR` CSE 已配置但未使用

**影響**：
- 無法自動收集財報日期
- 需要手動維護財報日曆

**建議修正**：
- 實現財報日曆數據收集函數，使用 `EARNINGS_CALENDAR` CSE
- 從 SEC EDGAR、EDINET、台灣公開資訊觀測站收集財報日期

---

## ✅ 已正確使用 CSE 的部分

1. **P2 財務數據收集** ✅
   - 台股：`P2_TAIWAN` CSE
   - 美股：`INSTITUTIONAL_DATA` CSE
   - 日股：`P2_JAPAN` CSE

2. **P2.5 籌碼面數據收集** ✅
   - 13F、Insider Trading、Dark Pool：`INSTITUTIONAL_DATA` CSE

3. **P5 Daily OHLCV** ✅
   - Fallback 使用 `P5_OHLCV` CSE

4. **P5 Daily News** ✅
   - 使用 `P5_NEWS` CSE

5. **P5 Weekly 籌碼面數據** ✅
   - 使用 `INSTITUTIONAL_DATA` CSE

---

## 📋 修正行動清單

### 高優先級（核心功能）

1. **P5 Daily Sector ETF** ⚠️
   - [ ] 修改 `collectSectorETFData()`，優先使用 `P5_SECTOR_ETF` CSE
   - [ ] 從 ishares.com, ssga.com, vanguard.com 獲取 ETF 數據
   - [ ] stooq.com 作為 fallback

2. **P5 Daily Derivatives** ❌
   - [ ] 實現 `collectUSDerivatives()`，使用 `P5_DERIVATIVES` CSE
   - [ ] 實現 `collectTaiwanDerivatives()`，使用 `P5_DERIVATIVES` CSE
   - [ ] 實現 `collectJapanDerivatives()`，使用 `P5_DERIVATIVES` CSE

3. **P5 Daily Macro** ⚠️
   - [ ] 修改 `collectMacroData()`，優先使用 `P5_WORLD` CSE
   - [ ] 從 FRED、BEA、BLS、Treasury 獲取宏觀數據
   - [ ] stooq.com 作為 fallback

### 中優先級（功能補強）

4. **P5 Daily Market Breadth** ⚠️
   - [ ] 實現從官方數據源獲取市場寬度數據
   - [ ] 美股：使用 `P5_WORLD` CSE 或 `P5_OHLCV` CSE
   - [ ] 台股：使用 `P2_TAIWAN` CSE
   - [ ] 日股：使用 `P2_JAPAN` CSE

5. **P0.5 供應鏈數據收集** ❌
   - [ ] 實現供應鏈數據收集函數，使用 `SUPPLY_CHAIN` CSE
   - [ ] 收集報關單數據（importyeti.com, panjiva.com）
   - [ ] 收集海運實物流數據（marinetraffic.com）

6. **P5 Daily Earnings Monitor** ⚠️
   - [ ] 實現財報日曆數據收集函數，使用 `EARNINGS_CALENDAR` CSE
   - [ ] 從 SEC EDGAR、EDINET、台灣公開資訊觀測站收集財報日期

---

## 🎯 總結

### ✅ 優點

1. **P2、P2.5、P5 Weekly 數據收集**：完全符合白名單原則，所有數據都從對應的 CSE 獲取
2. **CSE 配置完整**：所有需要的 CSE 都已配置，包含正確的白名單站點
3. **P5 Daily News**：正確使用 `P5_NEWS` CSE

### ❌ 問題

1. **P5 Daily Sector ETF**：未使用 `P5_SECTOR_ETF` CSE（已配置但未使用）
2. **P5 Daily Derivatives**：未實現，`P5_DERIVATIVES` CSE 已配置但未使用
3. **P5 Daily Macro**：未使用 `P5_WORLD` CSE（已配置但未使用）
4. **P5 Daily Market Breadth**：未從官方數據源獲取
5. **P0.5 供應鏈**：未實現，`SUPPLY_CHAIN` CSE 已配置但未使用
6. **P5 Daily Earnings Monitor**：未實現數據收集，`EARNINGS_CALENDAR` CSE 已配置但未使用

### 📝 建議

1. **優先修正高優先級問題**：P5 Daily Sector ETF、Derivatives、Macro
2. **確保所有數據收集都使用 CSE**：避免重複工作和浪費成本
3. **測試數據線暢通**：修正後測試所有 CSE 是否正常運作

---

**檢查日期**: 2026-01-16  
**檢查者**: AI Assistant  
**版本**: V8.0
