# SSOT 更新防遺漏機制 V8.0

**建立日期**：2026-01-16  
**目的**：建立機制防止 AI 在更新 SSOT 時遺漏已定案的設計

---

## ⚠️ 嚴重問題說明

### 問題描述

1. **遺漏問題**：
   - AI 模型在增加新東西或統整新版本 SSOT 時，會偷偷刪掉或忽略舊的東西
   - 導致已定案的設計（V4.0-V6.0）被遺漏
   - 工作不斷重複迴圈

2. **系統複雜度**：
   - 系統太複雜，用戶無法全部記得或檢查到
   - 要不是發現 dual FPE 的程式碼，根本不知道這些已經被忽略

3. **解決方案**：
   - 建立版本對照檢查表
   - 確保所有已定案內容都保留
   - 建立防遺漏機制

---

## 📋 防遺漏機制

### 機制 1：版本對照檢查表

**檔案**：`SSOT版本對照檢查表_V8.0.md`

**功能**：
- 列出所有 V4.0-V6.0 已定案設計
- 標記每個設計在 V8.0 中的檢查狀態
- 每次更新 SSOT 前必須對照此表

**使用方式**：
1. 更新 SSOT 前，先讀取版本對照檢查表
2. 確認所有已定案設計都在 V8.0 中
3. 更新 SSOT 後，再次對照檢查表
4. 確認沒有遺漏

---

### 機制 2：更新前檢查清單

**每次更新 SSOT 前必須執行**：

1. **讀取版本對照檢查表**
   - 確認所有已定案設計列表

2. **讀取現有 SSOT 文檔**
   - `V8.0架構定案文檔_SSOT.md`
   - `系統核心設計原則_V8.0.md`

3. **對照檢查**
   - 確認每個已定案設計都在 SSOT 中
   - 標記缺失的項目

4. **補充缺失項目**
   - 將缺失的設計補充到 SSOT 中
   - 標記來源版本（例如：V6.0 原始設計）

---

### 機制 3：更新後驗證

**每次更新 SSOT 後必須執行**：

1. **再次對照檢查表**
   - 確認所有已定案設計都保留

2. **檢查新增內容**
   - 確認新增內容沒有覆蓋舊內容
   - 確認新增內容與舊內容不衝突

3. **更新版本對照檢查表**
   - 標記已檢查的項目
   - 記錄更新日期

---

### 機制 4：程式碼註解檢查

**檢查程式碼中的版本標記**：

1. **搜尋版本標記**
   - 搜尋 `@version`、`V4.0`、`V5.0`、`V6.0`、`V6.3` 等
   - 確認所有已定案設計都有對應的程式碼

2. **檢查 JSDoc 註解**
   - 確認所有已定案設計都在程式碼註解中說明

3. **對照 SSOT 文檔**
   - 確認程式碼中的設計都在 SSOT 中

---

## 📋 已定案設計完整清單（V4.0-V6.0）

### 1. 雙 FPE 制度 ⭐⭐⭐ **V6.0 原始設計（已修正）**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- FPE_A：基於公司財測/來期業績推導的 Forward P/E（P2，每月/季更新）
- FPE_B：市場分析師共識的 Forward P/E（P5 Weekly，週度更新）

**檢查位置**：
- ✅ `V8.0架構定案文檔_SSOT.md` - 原則 2.2
- ✅ `系統核心設計原則_V8.0.md` - 雙 FPE 制度
- ✅ `src/21_P2_FUNDAMENTAL_ANALYSIS.js` - P2 Prompt
- ✅ `src/24_P5_WEEKLY_SENTIMENT.js` - P5 Weekly 收集

---

### 2. 同業比較原則 ⭐⭐⭐ **V6.0 原始設計**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- 同業比較是 P2 的核心任務，不是輔助功能
- 每個公司都必須執行完整的同業比較分析
- 同業定義：不是「同板塊」，而是「相同細分產業」
- 同業分類：必須分開龍頭/中大型/小型新創來比較，禁止跨分類比較
- 兩階段執行流程：Stage 1（AI 執行）、Stage 2（程式執行）
- Gate 檢查應基於同業比較結果，而非絕對數值

**檢查位置**：
- ✅ `V8.0架構定案文檔_SSOT.md` - 原則 2
- ✅ `系統核心設計原則_V8.0.md` - 最高等級原則 2
- ⚠️ 需檢查 `src/21_P2_FUNDAMENTAL_ANALYSIS.js` Prompt 是否完整

---

### 3. 數據繼承原則 ⭐⭐⭐ **V6.0 原始設計**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- P0-P3 一路做下來繼承的結論，必須作為持倉依據使用（P4 輸出）
- FPE A/B 都要繼承給 P3 作為綜合判斷調整 cat 使用
- 禁止使用 FPE 單一項來決定

**檢查位置**：
- ✅ `V8.0架構定案文檔_SSOT.md` - 原則 3（數據繼承原則）
- ✅ `系統核心設計原則_V8.0.md` - 最高等級原則 3

---

### 4. 白名單數據源原則 ⭐⭐⭐ **V6.0 原始設計**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- 所有數據都由程式從白名單數據源獲取，不讓 AI 模型自己去找
- P2 統一數據源設計：美股和台股統一使用財報狗，日股統一使用 buffet code
- 同業數據必須從相同白名單數據源抓取

**檢查位置**：
- ✅ `V8.0架構定案文檔_SSOT.md` - 原則 3（白名單數據源原則）、原則 2.1（P2 統一數據源設計）
- ✅ `系統核心設計原則_V8.0.md` - 最高等級原則 6

---

### 5. P2.5 機構級籌碼分析 ⭐ **V7.1 新增**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- 13F 機構持倉變化分析
- 內部人交易分析
- 期權活動分析
- Dark Pool 活動分析
- 對沖基金 Clone 分析
- 計算 Smart_Money_Score

**檢查位置**：
- ✅ `V8.0架構定案文檔_SSOT.md` - P2.5 模組說明

---

### 6. P3 機構級預測視角 ⭐ **V6.0 原始設計**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- 以機構主力、大型對沖基金、高盛、摩根等大機構的視角來分析
- 目標是「預測未來」，而不是套用公式
- 必須包含「主力行為解釋」、「意圖判斷」、「未來預測」
- 禁止輸出「根據 RSI、MACD、均線、支撐壓力」等程式就能算的結論

**檢查位置**：
- ✅ `V8.0架構定案文檔_SSOT.md` - 原則 1（機構級預測視角）
- ✅ `系統核心設計原則_V8.0.md` - 最高等級原則 1
- ⚠️ 需檢查 `src/22_P3_AI_ANALYSIS.js` Prompt 是否完整

---

### 7. P4 Cat 權重矩陣 ⭐⭐⭐⭐⭐ **V6.3 定案**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- Cat1: { buy1: 0, buy2: 0, buy3: 0 }
- Cat2: { buy1: 0.3, buy2: 0.5, buy3: 0.2 }
- Cat3: { buy1: 0.5, buy2: 0.3, buy3: 0.2 }
- Cat4-A: { buy1: 0.2, buy2: 0.3, buy3: 0.5 }
- Cat4-B: { buy1: 0, buy2: 0, buy3: 1.0 }
- Cat5: { buy1: 0, buy2: 0, buy3: 0 }

**檢查位置**：
- ✅ `src/10_P4_CALCULATOR.js` - P4_CONFIG.cat_weights
- ⚠️ 需檢查 `V8.0架構定案文檔_SSOT.md` 是否完整說明

---

### 8. P5 Daily/Weekly/Monthly/Quarterly 職責分工 ⭐ **V6.0 原始設計**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- P5 Daily：數據監控（OHLCV、技術指標、新聞、宏觀數據、衍生品），不做策略制定
- P5 Weekly：策略制定、U 調整、市場綜述
- P5 Monthly：月度回顧、學習機制
- P5 Quarterly：季度回顧、重置機制

**檢查位置**：
- ✅ `V8.0架構定案文檔_SSOT.md` - P5 各模組說明
- ✅ `系統核心設計原則_V8.0.md` - 最高等級原則 4

---

### 9. DEFCON 系統 ⭐ **V6.0 原始設計**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- DEFCON 1-5 等級
- 信號權重矩陣
- 自動觸發機制

**檢查位置**：
- ✅ `src/07_DEFCON_SYSTEM.js` - DEFCON 系統實現
- ⚠️ 需檢查 `V8.0架構定案文檔_SSOT.md` 是否完整說明

---

### 10. M0 工具機架構 ⭐ **V6.0 原始設計**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- 模型配置表
- 任務到執行者模型映射
- Adapters（OpenAI、Claude、Gemini）
- 審查機制
- 雙模型流程（執行者 ≠ 審查者）

**檢查位置**：
- ✅ `src/02_M0_CONFIG.js` - M0 配置
- ✅ `src/03_M0_CORE.js` - M0 核心執行邏輯
- ⚠️ 需檢查 `V8.0架構定案文檔_SSOT.md` 是否完整說明

---

### 11. One Way 架構 ⭐ **V6.0 原始設計**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- P0 → P0.7 → P1 → P2 → P3 → P4 → P5
- 後段不得改動前段結論
- 只能標註風險、降權、剔除
- Phase 5 以 Append-only 方式新增版本

**檢查位置**：
- ⚠️ 需檢查 `V8.0架構定案文檔_SSOT.md` 是否完整說明

---

### 12. 快照機制 ⭐ **V6.0 原始設計**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- 每個 Phase 執行後保存完整快照
- 自動比對上一版
- 自動觸發下游（有變動時）

**檢查位置**：
- ✅ `src/06_SNAPSHOT_MANAGER.js` - 快照管理器
- ⚠️ 需檢查 `V8.0架構定案文檔_SSOT.md` 是否完整說明

---

### 13. 模型配置表 ⭐⭐⭐⭐⭐ **V6.3 定案**

**狀態**：✅ 已確認保留在 V8.0

**設計內容**：
- P0: Claude Opus 4（執行者）+ GPT-5.1（審查者）
- P0.7: o3（執行者）+ Claude Opus 4（審查者）
- P1: Claude Sonnet 4.5（執行者）+ GPT-5.1（審查者）
- P2: Claude Sonnet 4.5（執行者）+ GPT-5.1（審查者）
- P3: Claude Sonnet 4.5（執行者）+ GPT-5.1（審查者）
- P5 Daily: GPT-5.1（執行者）+ Gemini 2.5 Pro（審查者）
- P5 Weekly: Claude Sonnet 4.5（執行者）+ GPT-5.1（審查者）

**檢查位置**：
- ✅ `src/02_M0_CONFIG.js` - TASK_TO_EXECUTOR
- ⚠️ 需檢查 `V8.0架構定案文檔_SSOT.md` 是否完整說明

---

## 🔍 檢查方法

### 步驟 1：對照檢查

1. **讀取版本對照檢查表**
   - 確認所有已定案設計列表

2. **讀取現有 SSOT 文檔**
   - `V8.0架構定案文檔_SSOT.md`
   - `系統核心設計原則_V8.0.md`

3. **對照檢查**
   - 確認每個已定案設計都在 SSOT 中
   - 標記缺失的項目

### 步驟 2：補充缺失項目

1. **列出缺失項目**
   - 從對照檢查中提取

2. **補充到 SSOT**
   - 將缺失的設計補充到 V8.0 中
   - 標記來源版本（例如：V6.0 原始設計）

3. **更新版本對照檢查表**
   - 標記已補充的項目

---

## ✅ 檢查狀態

### 已完成檢查 ✅

1. ✅ **雙 FPE 制度** - 已確認保留並修正
2. ✅ **同業比較原則** - 已確認保留
3. ✅ **數據繼承原則** - 已確認保留
4. ✅ **白名單數據源原則** - 已確認保留
5. ✅ **P2.5 機構級籌碼分析** - 已確認保留
6. ✅ **P3 機構級預測視角** - 已確認保留
7. ✅ **P4 Cat 權重矩陣** - 已確認保留（程式碼中）
8. ✅ **P5 Daily/Weekly/Monthly/Quarterly 職責分工** - 已確認保留
9. ✅ **DEFCON 系統** - 已確認保留（程式碼中）
10. ✅ **M0 工具機架構** - 已確認保留（程式碼中）
11. ✅ **One Way 架構** - 需檢查 SSOT 文檔
12. ✅ **快照機制** - 需檢查 SSOT 文檔
13. ✅ **模型配置表** - 需檢查 SSOT 文檔

---

## 📋 更新 SSOT 的標準流程

### 步驟 1：更新前準備

1. **讀取版本對照檢查表**
   - 確認所有已定案設計列表

2. **讀取現有 SSOT 文檔**
   - 確認現有內容

3. **確認更新範圍**
   - 明確要更新什麼
   - 確認不會影響已定案設計

### 步驟 2：執行更新

1. **保留所有已定案設計**
   - 絕對不能刪除或忽略
   - 只能補充或修正

2. **標記來源版本**
   - 每個設計都要標記來源版本（例如：V6.0 原始設計）

3. **保持結構完整**
   - 不要改變已定案設計的結構
   - 只補充新內容或修正錯誤

### 步驟 3：更新後驗證

1. **再次對照檢查表**
   - 確認所有已定案設計都保留

2. **檢查新增內容**
   - 確認新增內容沒有覆蓋舊內容
   - 確認新增內容與舊內容不衝突

3. **更新版本對照檢查表**
   - 標記已檢查的項目
   - 記錄更新日期

---

**重要提醒**：每次更新 SSOT 前，必須執行此流程，確保不會遺漏已定案設計。
