# Cursor Rules for Nuclear Project

## ⚠️ 重要工作流程規則（永久記憶）

### 標準化工作流程（必須嚴格遵守）

#### 1. 程式變動自動更新到 SSOT（永久記憶）
**所有程式新增或變動都必須自動更新到 SSOT**

每次完成以下操作後，必須：
1. 列出所有新增的檔案
2. 列出所有修改的檔案
3. **立即更新 SSOT 文檔**（`V8.0架構定案文檔_SSOT.md`）
   - 記錄新增功能的位置、實現方式、關鍵函數
   - 記錄修改功能的變更內容、影響範圍
   - 標記實現狀態（✅ 已完成 / ⚠️ 待完成）
   - 添加版本標記（例如：⭐ V8.26 新增）

**SSOT 更新要求**：
- 必須在完成程式變動後立即更新，不得延遲
- 必須詳細記錄變更內容，不得遺漏
- 必須標記實現狀態和版本號
- 必須記錄實現位置（檔案路徑、函數名稱）

#### 2. SSOT 更新後自動上傳到 GAS（永久記憶）
**更新到 SSOT 就自動上傳到 GAS**

每次完成 SSOT 更新後，必須：
1. 檢查是否有程式檔案變動（新增或修改）
2. 如果有程式檔案變動，**自動使用 clasp 上傳到 GAS**
3. 如果 clasp 不可用，則提醒用戶手動上傳
4. 創建上傳清單文檔（如：`V8.XX_GAS上傳清單_XXX.md`）

**自動上傳流程**：
- 檢查 clasp 是否可用（`.clasp.json`存在且`clasp`命令可用）
- 如果可用，執行 `clasp push --force` 自動上傳所有變更
- 如果上傳失敗（語法錯誤等），先修復錯誤，再重新上傳
- 如果 clasp 不可用，提供手動上傳步驟

**注意事項**：
- clasp push 不會自動刪除 GAS 中的檔案，需要手動刪除廢棄檔案
- 上傳前必須修復所有語法錯誤
- SSOT 更新和 GAS 上傳是連續動作，不得中斷

**檢查清單**：
- [ ] 所有程式變動已更新到 SSOT
- [ ] SSOT 更新已完成
- [ ] 所有新增檔案已上傳到 GAS（自動或手動）
- [ ] 所有修改檔案已在 GAS 中更新（自動或手動）
- [ ] 語法錯誤已修復（如果有）
- [ ] 廢棄檔案已手動刪除（如果 GAS 中存在）
- [ ] 功能測試通過（可選）

---

#### 3. 接口對齊檢查（永久記憶）
**新增或修改任何模組前，必須先掃描主程式對齊所有接口**

每次新增或修改模組前，必須：

1. **掃描主程式所有接口**：
   - 掃描所有 `getSheetByName()` 調用，確認 Sheet 名稱
   - 掃描所有 SCHEMA 定義（`01_SHEETS_STRUCTURE.js`），確認 Sheet 名稱和 Header 欄位
   - 掃描所有函數名稱、參數名稱、返回值結構

2. **對齊檢查**：
   - 確保新模組使用的 Sheet 名稱與主程式一致
   - 確保新模組使用的欄位名稱與主程式 Schema 一致
   - 確保新模組調用的函數名稱與主程式一致
   - 確保新模組的參數結構與主程式一致

**禁止事項**：
- ❌ 禁止不掃描主程式就直接新增或修改模組
- ❌ 禁止使用猜測的 Sheet 名稱或欄位名稱
- ❌ 禁止創建錯誤名稱的 Sheet（會導致後續混淆）

**檢查清單**：
- [ ] 已掃描主程式所有相關接口
- [ ] Sheet 名稱已對齊（與 `01_SHEETS_STRUCTURE.js` 一致）
- [ ] Header 欄位名稱已對齊（與 SCHEMA 定義一致）
- [ ] 函數名稱已對齊（與主程式實際函數一致）

---

## 其他規則

- 所有回應必須使用繁體中文
- 每次修改系統後必須更新 SSOT 文檔
- 所有設計變更必須記錄在 SSOT 中，不得遺漏
