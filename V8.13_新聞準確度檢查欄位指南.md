# V8.13 新聞準確度檢查欄位指南

**日期**：2026-01-19  
**目的**：說明如何檢查新聞管線收集的新聞準確度

---

## 📊 檢查位置

### 主要表格：`NEWS_ATOMS_DAILY`

所有收集並處理後的新聞都保存在 `NEWS_ATOMS_DAILY` 表格中。

---

## ✅ 需要檢查的關鍵欄位

### 1. 時效性檢查（Timeliness）

**欄位**：
- `date`：新聞日期（應為當天或前一天，測試模式放寬到前一天）
- `publish_date`：發布日期（由Flash提取）

**檢查標準**：
- ✅ 正常：`date` 為今天或昨天（測試模式）
- ❌ 異常：`date` 為幾天前或更早
- ❌ 異常：`publish_date` 為空或明顯過期

**測試模式**：時效性放寬到前一天（2026-01-18），所以 `date` 應該是 `2026-01-18` 或 `2026-01-19`

---

### 2. 多語去重檢查（Deduplication）

**欄位**：
- `title`：新聞標題
- `summary`：新聞摘要
- `url`：原始連結

**檢查標準**：
- ✅ 正常：不同語言但內容相同的新聞應該被合併為一則
- ❌ 異常：出現完全相同的標題和摘要（同語言重複）
- ❌ 異常：出現不同語言但內容完全相同的多則新聞（應該被去重）

**檢查方法**：
- 檢查是否有重複的 `title` 或 `url`
- 檢查是否有不同語言但 `summary` 內容相同的新聞

---

### 3. 多維度標籤檢查（Multi-dimensional Tags）

#### 3.1 事件屬性 (Event Type)

**欄位**：`event_type_json`（JSON格式）

**檢查標準**：
- ✅ 正常：包含 `primary`（主要事件類型）和 `secondary`（次要事件類型，可選）
- ✅ 正常：事件類型應在允許列表中（如：Central_Bank, Econ_Data, Earnings_Result等）
- ❌ 異常：`event_type_json` 為空或格式錯誤
- ❌ 異常：事件類型不在允許列表中

**允許的事件類型**：
- 宏觀與政策：Central_Bank, Econ_Data, Geopolitics, Fiscal_Reg
- 企業基本面：Earnings_Result, Guidance, M_A_SpinOff, Product_Tech, Management
- 資金與籌碼：Analyst_Ratings, Insider_Activity, Institutional_Flow, Buyback_Offering
- 市場結構：Sector_Rotation, Derivatives, Technical_Signal
- 專項追蹤：AI_Semi, Crypto
- 原物料與匯率：Energy, Precious_Metals, Industrial_Metals, Agriculture, Forex

#### 3.2 影響層級 (Impact Scope)

**欄位**：`impact_scope`

**檢查標準**：
- ✅ 正常：值為 `GLOBAL`、`SECTOR` 或 `STOCK` 之一
- ❌ 異常：值為空或不在允許列表中

**判斷邏輯**：
- `GLOBAL`：影響全市場（如：聯準會升息）
- `SECTOR`：影響單一產業（如：美國限制 AI 晶片出口）
- `STOCK`：僅影響單一公司（如：財報）

#### 3.3 情緒極性 (Sentiment Polarity)

**欄位**：`sentiment_polarity`

**檢查標準**：
- ✅ 正常：值為 `VERY_BULLISH`、`SLIGHTLY_BULLISH`、`NEUTRAL`、`SLIGHTLY_BEARISH`、`VERY_BEARISH` 之一
- ❌ 異常：值為空或不在允許列表中

#### 3.4 關聯股票代碼 (Related Tickers)

**欄位**：`related_tickers_json`（JSON格式，數組）

**檢查標準**：
- ✅ 正常：包含相關股票代碼的數組（如：`["NVDA", "AMD"]`）
- ✅ 正常：如果新聞沒有提到股票，可以為空數組 `[]`
- ❌ 異常：格式錯誤（不是有效的JSON數組）

**檢查方法**：
- 檢查新聞內容是否提到股票代碼，但 `related_tickers_json` 為空
- 檢查 `related_tickers_json` 中的股票代碼是否正確（格式、市場等）

---

### 4. 數據驗證檢查（Data Verification）

#### 4.1 數據時效性 (Data Recency)

**欄位**：`data_recency`

**檢查標準**：
- ✅ 正常：值為 `OK`、`STALE` 或 `UNCLEAR` 之一
- ❌ 異常：值為空

**判斷邏輯**：
- `OK`：數據明顯是最近的
- `STALE`：數據明顯是舊的（如：引用去年的數據）
- `UNCLEAR`：無法確定數據時效性

#### 4.2 數據語意一致性 (Data Coherence)

**欄位**：`data_coherence`

**檢查標準**：
- ✅ 正常：值為 `CONSISTENT`、`QUESTIONABLE` 或 `INCONSISTENT` 之一
- ❌ 異常：值為空

**判斷邏輯**：
- `CONSISTENT`：數據引用一致，無明顯錯誤
- `QUESTIONABLE`：數據引用有疑問（如：數字級錯、比例失真）
- `INCONSISTENT`：數據引用明顯不一致或錯誤

#### 4.3 數據類型 (Data Type)

**欄位**：`data_type`

**檢查標準**：
- ✅ 正常：值為 `HARD`、`SEMI_STRUCTURED` 或 `NARRATIVE` 之一
- ❌ 異常：值為空

**判斷邏輯**：
- `HARD`：硬數據（如：股價、匯率、利率）
- `SEMI_STRUCTURED`：半結構化數據（如：財報數字、經濟數據）
- `NARRATIVE`：敘事性數據（如：分析師觀點、市場評論）

#### 4.4 數據驗證狀態 (Data Verification Status)

**欄位**：`data_verification`

**檢查標準**：
- ✅ 正常：值為 `VERIFIED`、`NOT_VERIFIED`、`NOT_APPLICABLE` 或 `CONFLICTING` 之一
- ⚠️ 注意：初始狀態可能為 `NOT_VERIFIED`，後續由驗證機制更新

**判斷邏輯**：
- `VERIFIED`：數據已通過Daily DB驗證
- `NOT_VERIFIED`：數據尚未驗證
- `NOT_APPLICABLE`：無需驗證（如：純敘事性新聞）
- `CONFLICTING`：數據與Daily DB衝突

---

### 5. 市場確認檢查（Market Confirmation）

**欄位**：
- `market_confirmation`：市場確認狀態
- `narrative_direction`：敘事方向
- `cross_asset_resonance`：跨資產共振

**檢查標準**：
- ✅ 正常：這些欄位可能為 `null`（初始狀態），後續由驗證機制填充
- ✅ 正常：如果已填充，應符合預期格式

**判斷邏輯**（如果已填充）：
- `market_confirmation`：`STRONG`、`MODERATE`、`WEAK` 或 `NONE`
- `narrative_direction`：`CONSISTENT`、`UNCONFIRMED` 或 `CONFLICTING`
- `cross_asset_resonance`：`HIGH`、`MODERATE`、`LOW` 或 `NONE`

---

### 6. 個股索引檢查（Ticker News Index）

**表格**：`STOCK_NEWS_INDEX_DAILY`

**檢查標準**：
- ✅ 正常：如果新聞提到股票代碼，應該在索引中出現
- ✅ 正常：索引應包含 `ticker`、`news_atom_ids`（JSON數組）等欄位
- ❌ 異常：新聞提到股票代碼，但索引中沒有該ticker
- ❌ 異常：索引中的 `news_atom_ids` 為空或格式錯誤

**檢查方法**：
1. 檢查 `NEWS_ATOMS_DAILY` 中 `related_tickers_json` 不為空的新聞
2. 檢查 `STOCK_NEWS_INDEX_DAILY` 中是否有對應的ticker
3. 檢查索引中的 `news_atom_ids` 是否包含該新聞的 `atom_id`

---

## 🔍 檢查步驟建議

### Step 1: 基本完整性檢查

1. **檢查收集數量**：
   - 英文：應收集到約50則（實際可能因CSE限制為10則）
   - 中文：應收集到約25則（實際可能因CSE限制為10則）
   - 日文：應收集到約25則（實際可能因CSE限制為10則）

2. **檢查日期**：
   - 所有新聞的 `date` 應為測試日期（2026-01-18 或 2026-01-19）

### Step 2: 多語去重檢查

1. **檢查重複**：
   - 在 `NEWS_ATOMS_DAILY` 中搜索重複的 `title` 或 `url`
   - 檢查是否有不同語言但內容相同的新聞（應該被合併）

2. **檢查語言分布**：
   - 檢查是否有英文、中文、日文新聞
   - 檢查 `language` 欄位是否正確標記

### Step 3: 多維度標籤檢查

1. **檢查事件屬性**：
   - 隨機選擇幾則新聞，檢查 `event_type_json` 是否正確
   - 檢查 `primary` 事件類型是否在允許列表中
   - 檢查 `secondary` 事件類型（如果存在）是否合理

2. **檢查影響層級**：
   - 檢查 `impact_scope` 是否正確（GLOBAL/SECTOR/STOCK）
   - 例如：聯準會升息 → 應為 `GLOBAL`
   - 例如：單一公司財報 → 應為 `STOCK`

3. **檢查情緒極性**：
   - 檢查 `sentiment_polarity` 是否合理
   - 例如：利好消息 → 應為 `BULLISH` 相關
   - 例如：利空消息 → 應為 `BEARISH` 相關

4. **檢查關聯股票**：
   - 檢查 `related_tickers_json` 是否正確提取股票代碼
   - 例如：新聞提到 "NVDA" → `related_tickers_json` 應包含 `["NVDA"]`

### Step 4: 數據驗證檢查

1. **檢查數據時效性**：
   - 檢查 `data_recency` 是否正確標記
   - 例如：新聞引用"昨天"的數據 → 應為 `OK`
   - 例如：新聞引用"去年"的數據 → 應為 `STALE`

2. **檢查數據一致性**：
   - 檢查 `data_coherence` 是否正確標記
   - 例如：數字明顯錯誤 → 應為 `INCONSISTENT`

3. **檢查數據類型**：
   - 檢查 `data_type` 是否正確標記
   - 例如：提到具體股價數字 → 應為 `HARD` 或 `SEMI_STRUCTURED`
   - 例如：純分析師觀點 → 應為 `NARRATIVE`

### Step 5: 個股索引檢查

1. **檢查索引建立**：
   - 檢查 `STOCK_NEWS_INDEX_DAILY` 表格是否存在
   - 檢查是否有ticker被索引

2. **檢查索引正確性**：
   - 選擇一則有 `related_tickers_json` 的新聞
   - 檢查該ticker是否在索引中
   - 檢查索引中的 `news_atom_ids` 是否包含該新聞的 `atom_id`

---

## ⚠️ 已知問題

### 1. 多語去重錯誤

**錯誤訊息**：`Cannot read properties of undefined (reading '0')`

**影響**：
- 多語去重和分類可能失敗
- 但系統會使用默認值繼續執行，不會中斷

**修復狀態**：需要檢查並修復

---

## 📋 檢查清單

### 基本檢查
- [ ] 收集數量符合預期（英文、中文、日文）
- [ ] 所有新聞的 `date` 正確（測試模式：前一天或今天）
- [ ] 沒有重複的新聞（同語言或跨語言）

### 多維度標籤檢查
- [ ] `event_type_json` 格式正確，包含 `primary` 和 `secondary`
- [ ] `impact_scope` 值正確（GLOBAL/SECTOR/STOCK）
- [ ] `sentiment_polarity` 值正確（BULLISH/NEUTRAL/BEARISH）
- [ ] `related_tickers_json` 格式正確（JSON數組）

### 數據驗證檢查
- [ ] `data_recency` 值正確（OK/STALE/UNCLEAR）
- [ ] `data_coherence` 值正確（CONSISTENT/QUESTIONABLE/INCONSISTENT）
- [ ] `data_type` 值正確（HARD/SEMI_STRUCTURED/NARRATIVE）

### 個股索引檢查
- [ ] `STOCK_NEWS_INDEX_DAILY` 表格存在
- [ ] 有 `related_tickers_json` 的新聞都被正確索引
- [ ] 索引中的 `news_atom_ids` 包含正確的新聞ID

---

**此文檔定義了如何檢查新聞管線收集的新聞準確度。**
