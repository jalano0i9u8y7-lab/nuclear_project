# 輕測試系統使用說明（V8.0）

## 📋 概述

輕測試系統用於測試所有 Phase 的完整流程和 Prompt 有效程度，重點評估 AI 回應是否符合預期水準。

## 🎯 測試重點

### 1. 程式流程完整性
- ✅ 程式能否跑完整個流程
- ✅ 是否有錯誤或異常

### 2. Prompt 有效程度 ⭐⭐⭐ 最重要
- ✅ AI 回應的欄位是否完整
- ✅ 欄位內容是否符合預期格式
- ✅ 邏輯是否合理
- ✅ 是否遵循了 prompt 中的要求

## 🧪 測試流程

### 測試順序（One Way Lock）

1. **P0** → 產出工程瓶頸類 1 個、服務壟斷類 1 個
2. **P0.5** → 使用 P0 結果
3. **P0.7** → 使用 P0 結果
4. **P1** → 使用 P0 和 P0.7 結果，每個主題 5 間公司
5. **P2** → 使用 P1 結果（約 10 間公司）
6. **P2.5** → 使用 P2 結果
7. **P3** → 使用 P2 和 P2.5 結果
8. **P4** → 使用 P2 和 P3 結果
9. **P5 Daily** → 使用 P4 結果（僅抓 P4 的 10 間公司 OHLCV，其他正常抓）
10. **P5 Weekly** → 模擬 2 間公司三天後財報，測試決策是否符合預期

### 重要原則

- ✅ **一個跑順之後，後面就不要再重複前段工作**
- ✅ **直接用前段跑出來的資料測試後段**
- ✅ **P0 跑完了，就按 P0.5 去跑看結論，錯誤就修改跟重跑 P0.5**
- ✅ **不要再從 P0 開始跑**
- ✅ **如果有需要跑到更前面，表示我們的 one way lock 有錯誤**

## 🖥️ UI 測試按鍵

在 UI 側邊欄的「🧪 輕測試系統（V8.0）」區塊中，有每個 Phase 的測試按鍵：

- 🧪 測試 P0（產業工程學）
- 🧪 測試 P0.5（產業鏈地圖）
- 🧪 測試 P0.7（系統動力學）
- 🧪 測試 P1（公司池）
- 🧪 測試 P2（基本面）
- 🧪 測試 P2.5（籌碼面）
- 🧪 測試 P3（技術面）
- 🧪 測試 P4（資金配置）
- 🧪 測試 P5 Daily
- 🧪 測試 P5 Weekly

## 📊 測試結果評估

### 需要回覆的內容

測試完成後，請回覆以下內容：

1. **錯誤資訊和 Log**（如果有）
2. **每個 Phase AI 回應的欄位**（完整列表）
3. **Prompt 有效程度評估**（是否符合預期）

### 測試結果格式

```
Phase: P0
Status: COMPLETED
Duration: 12.34s

AI Output Fields:
  themes[0].theme_id: "THEME_001"
  themes[0].theme_name: "AI 半導體"
  themes[0].problem_oneliner: "..."
  ...

Prompt Evaluation:
  completeness:
    has_eng: true
    has_struct: true
    theme_count: 2
  issues: []
```

## ⚠️ 注意事項

### M0 執行

- 測試會將任務提交到 M0 Job Queue
- 需要手動執行 `M0_Execute()` 或等待自動觸發器執行
- 執行完成後，結果會保存在 `M0__RESULT` 表格中

### 數據缺失處理

- 如果缺數據，系統會根據配置忽略並繼續進行（`IGNORE_CONTINUE`）
- 缺失的數據會記錄到日誌中

### 測試模式

- 測試模式會使用簡化的數據和配置
- 但核心精神和要求必須對齊正式模式

## 📝 測試檢查清單

### P0 測試
- [ ] 是否產出工程瓶頸類 1 個
- [ ] 是否產出服務壟斷類 1 個
- [ ] P0-3 強制輸出（五項缺一不可）是否完整

### P0.7 測試
- [ ] 是否按照固定順序完成分析
- [ ] Loop_Dominance 格式是否正確
- [ ] Time_Position 格式是否正確

### P1 測試
- [ ] 三層對位檢查是否完成
- [ ] 每個主題是否產出約 5 間公司
- [ ] Moat_Type 和 Rerate_State 是否完整

### P2 測試
- [ ] 是否沒有回寫前段封存欄位（One Way Lock）
- [ ] tier 和 gate_result 是否完整

### P2.5 測試
- [ ] 必要欄位是否完整
- [ ] Clone 評分邏輯是否正確

### P3 測試
- [ ] 是否以機構級預測視角分析
- [ ] Cat 分類格式是否正確
- [ ] 主力行為解釋是否完整

### P5 Weekly 測試
- [ ] 是否動態決定因子權重
- [ ] 財報日個股籌碼權重是否正確加強（smart_money: 0.25-0.35, institutional: 0.15-0.20）

---

**最後更新**：2025-01-15
