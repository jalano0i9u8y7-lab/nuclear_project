# V8.0 æ¸¬è©¦æ¨¡å¼å¯¦ç¾è¦åŠƒ

## è¦åŠƒæ—¥æœŸ
2026-01-19

## æœ€é«˜åŽŸå‰‡

1. **æœ€å°ä¿®æ”¹æ–¹å¼**ï¼šä¸æ”¹æž¶æ§‹ã€ä¸æ”¹ prompt
2. **æ˜“æ–¼åˆ‡æ›**ï¼šæ¸¬è©¦å®Œå¾Œèƒ½è¼•æ˜“æ”¹å›žæ­£å¼æ¨¡å¼
3. **ç„¡éºæ¼**ï¼šä¸èƒ½æœ‰ä»»ä½•ç¨‹å¼ç¢¼éºæ¼çš„å•é¡Œ

## æ¸¬è©¦æ¨¡å¼èˆ‡æ­£å¼æ¨¡å¼çš„å·®ç•°

### æ¨¡åž‹å·®ç•°
- **åˆ†æžè€…ï¼ˆExecutorï¼‰**ï¼šä¸€å¾‹ç”¨ `gemini-2.0-flash-lite-preview-02-05`
- **å¯©æŸ¥è€…ï¼ˆAuditorï¼‰**ï¼šä¸€å¾‹ç”¨ `gpt-5-nano`
- **è£æ±ºè€…ï¼ˆå¦‚æžœæœ‰ï¼‰**ï¼šä¸€å¾‹ç”¨ `gemini-2.0-flash-lite-preview-02-05`

### Batch API å·®ç•°
- **æ¸¬è©¦æ¨¡å¼**ï¼šå…¨éƒ¨ä¸ç”¨ Batchï¼ˆ`GLOBAL_USE_BATCH_API = false`ï¼‰
- **æ­£å¼æ¨¡å¼**ï¼šä½¿ç”¨ Batchï¼ˆ`GLOBAL_USE_BATCH_API = true`ï¼‰

### æ¸¬è©¦æŒ‰éˆ•
- æ¯å€‹æµç¨‹ï¼ˆP0, P0.5, P0.7, P1-1, P1-2, P2, P2.5, P3, P4, P5 Daily, P5 Weeklyï¼‰éƒ½è¦åˆ†é–‹å»ºç«‹æ¸¬è©¦æŒ‰éˆ•
- å‰é¢çš„æµç¨‹è‹¥è·‘é€šæœ‰ç•™å­˜è³‡æ–™ï¼Œå¾Œé¢çš„æµç¨‹ç›´æŽ¥åƒå‰é¢ç•™å­˜çš„è³‡æ–™

---

## å¯¦ç¾æ–¹æ¡ˆ

### æ–¹æ¡ˆæ¦‚è¿°

**æ ¸å¿ƒç­–ç•¥**ï¼šåœ¨ API å‘¼å«å±¤ï¼ˆAdapter Layerï¼‰åšæœ€å°ä¿®æ”¹ï¼Œä¸å½±éŸ¿ Prompt å’Œæž¶æ§‹ã€‚

**ç‚ºä»€éº¼å¯è¡Œ**ï¼š
1. **å®¹é‡å¤ å¤§**ï¼šGemini Flash-Lite çª—å£æ˜¯ 1M tokensï¼ŒGPT-5-nano ä¹Ÿæœ‰ 128kï¼Œå®Œå…¨ã€Œåƒå¾—ä¸‹ã€åŽŸæœ¬çš„ Prompt
2. **æŒ‡ä»¤ç›¸å®¹**ï¼šV8.15 çš„ Prompt éƒ½æ˜¯æ¨™æº–è‡ªç„¶èªžè¨€æŒ‡ä»¤ï¼Œå°æ‰€æœ‰æ¨¡åž‹é€šç”¨
3. **JSON Mode å¼·åˆ¶**ï¼šç”¨ API åƒæ•¸å¼·åˆ¶éŽ–å®š JSON è¼¸å‡ºï¼Œä¸ç”¨æ”¹ Prompt æ–‡å­—

---

## å¯¦ç¾æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šåœ¨ Config æª”æ·»åŠ æ¸¬è©¦æ¨¡å¼é–‹é—œå’Œæ¨¡åž‹æ˜ å°„

**æª”æ¡ˆ**ï¼š`src/02_M0_CONFIG.js`

**ä¿®æ”¹ä½ç½®**ï¼šåœ¨æª”æ¡ˆé–‹é ­æ·»åŠ æ¸¬è©¦æ¨¡å¼é…ç½®

```javascript
// ==========================================
// â­ æ¸¬è©¦æ¨¡å¼é–‹é—œï¼ˆV8.0 æ¸¬è©¦æ¨¡å¼ï¼‰
// ==========================================

/**
 * â­ V8.0 æ¸¬è©¦æ¨¡å¼é–‹é—œ
 * 
 * ç”¨é€”ï¼š
 * - æ¸¬è©¦éšŽæ®µï¼šè¨­ç‚º trueï¼Œä½¿ç”¨æœ€ä¾¿å®œçš„æ¨¡åž‹ï¼ˆFlash-Lite + Nanoï¼‰
 * - ç”Ÿç”¢éšŽæ®µï¼šè¨­ç‚º falseï¼Œä½¿ç”¨æ­£å¼æ¨¡åž‹ï¼ˆSonnet/Opus + GPT-5.2ï¼‰
 * 
 * æ¸¬è©¦æ¨¡å¼é…ç½®ï¼š
 * - åˆ†æžè€…ï¼šgemini-2.0-flash-lite-preview-02-05
 * - å¯©æŸ¥è€…ï¼šgpt-5-nano
 * - è£æ±ºè€…ï¼šgemini-2.0-flash-lite-preview-02-05
 * - Batch APIï¼šå…¨éƒ¨ç¦ç”¨ï¼ˆGLOBAL_USE_BATCH_API = falseï¼‰
 */
const SYSTEM_TEST_MODE = false;  // â­ æ¸¬è©¦éšŽæ®µï¼štrueï¼Œç”Ÿç”¢éšŽæ®µï¼šfalse

/**
 * â­ æ¸¬è©¦æ¨¡å¼æ¨¡åž‹æ˜ å°„
 * 
 * ç•¶ SYSTEM_TEST_MODE = true æ™‚ï¼Œä½¿ç”¨ä»¥ä¸‹æ¨¡åž‹æ˜ å°„
 */
const TEST_MODELS = {
  // åˆ†æžè€…ï¼šFlash-Liteï¼ˆåƒåŽŸæœ¬çµ¦ Sonnet/Opus çš„é•· Promptï¼‰
  "EXECUTOR": "gemini-2.0-flash-lite-preview-02-05",
  
  // å¯©æŸ¥è€…ï¼šNanoï¼ˆåƒåŽŸæœ¬çµ¦ GPT-5.2 çš„å¯©æŸ¥ Promptï¼‰
  "AUDITOR": "gpt-5-nano",
  
  // è£æ±ºè€…ï¼šFlash-Liteï¼ˆå¦‚æžœæœ‰ï¼‰
  "ARBITER": "gemini-2.0-flash-lite-preview-02-05"
};

/**
 * â­ æ¸¬è©¦æ¨¡å¼æ¨¡åž‹é…ç½®
 * 
 * ç‚ºæ¸¬è©¦æ¨¡åž‹æ·»åŠ é…ç½®ï¼ˆæˆæœ¬ã€Token é™åˆ¶ç­‰ï¼‰
 */
const TEST_MODEL_CONFIG = {
  "gemini-2.0-flash-lite-preview-02-05": {
    adapter: "M0_Adapter_Gemini",
    costPer1KTokens: 0.00005,  // æ¥µä½Žæˆæœ¬ï¼ˆå‡è¨­å€¼ï¼Œéœ€ç¢ºèªå¯¦éš›åƒ¹æ ¼ï¼‰
    costPer1KOutputTokens: 0.0002,  // æ¥µä½Žæˆæœ¬ï¼ˆå‡è¨­å€¼ï¼Œéœ€ç¢ºèªå¯¦éš›åƒ¹æ ¼ï¼‰
    maxTokens: 1000000,  // 1M context window
    maxOutputTokens: 8000,
    temperature: 0.7,
    supportsBatch: false,  // æ¸¬è©¦æ¨¡å¼ä¸ä½¿ç”¨ Batch
    forceJsonMode: true  // â­ å¼·åˆ¶ JSON æ¨¡å¼
  },
  "gpt-5-nano": {
    adapter: "M0_Adapter_OpenAI",
    costPer1KTokens: 0.0001,  // æ¥µä½Žæˆæœ¬ï¼ˆå‡è¨­å€¼ï¼Œéœ€ç¢ºèªå¯¦éš›åƒ¹æ ¼ï¼‰
    costPer1KOutputTokens: 0.0004,  // æ¥µä½Žæˆæœ¬ï¼ˆå‡è¨­å€¼ï¼Œéœ€ç¢ºèªå¯¦éš›åƒ¹æ ¼ï¼‰
    maxTokens: 128000,  // 128k context window
    maxOutputTokens: 8000,
    temperature: 0.7,
    useMaxCompletionTokens: true,
    supportsBatch: false,  // æ¸¬è©¦æ¨¡å¼ä¸ä½¿ç”¨ Batch
    forceJsonMode: true  // â­ å¼·åˆ¶ JSON æ¨¡å¼
  }
};
```

**ä¿®æ”¹ `getExecutor` å‡½æ•¸**ï¼š

```javascript
/**
 * ç²å–åŸ·è¡Œè€…æ¨¡åž‹ï¼ˆæ ¹æ“š projectIdï¼‰
 * â­ V8.0 æ¸¬è©¦æ¨¡å¼ï¼šå¦‚æžœ SYSTEM_TEST_MODE = trueï¼Œè¿”å›žæ¸¬è©¦æ¨¡åž‹
 * @param {string} projectId - é …ç›® ID
 * @return {string} åŸ·è¡Œè€…æ¨¡åž‹åç¨±
 */
function getExecutor(projectId) {
  // â­ æ¸¬è©¦æ¨¡å¼ï¼šä½¿ç”¨æ¸¬è©¦æ¨¡åž‹
  if (SYSTEM_TEST_MODE) {
    return TEST_MODELS.EXECUTOR;  // gemini-2.0-flash-lite-preview-02-05
  }
  
  // æ­£å¼æ¨¡å¼ï¼šä½¿ç”¨åŽŸæœ‰é‚è¼¯
  return TASK_TO_EXECUTOR[projectId] || "SONNET";
}
```

**ä¿®æ”¹ `getAuditor` å‡½æ•¸**ï¼š

```javascript
/**
 * ç²å–å¯©æŸ¥è€…æ¨¡åž‹ï¼ˆæ ¹æ“š projectIdï¼‰
 * â­ V8.0 æ¸¬è©¦æ¨¡å¼ï¼šå¦‚æžœ SYSTEM_TEST_MODE = trueï¼Œè¿”å›žæ¸¬è©¦æ¨¡åž‹
 * @param {string} projectId - é …ç›® ID
 * @return {string|null} å¯©æŸ¥è€…æ¨¡åž‹åç¨±
 */
function getAuditor(projectId) {
  // â­ V8.16 æ›´æ–°ï¼šP1_STEP1 ç´”æå–è³‡æ–™ï¼Œç„¡åˆ†æžï¼Œä¸éœ€è¦å¯©æŸ¥è€…
  if (projectId === "P1_STEP1") {
    return null;
  }
  
  // â­ æ¸¬è©¦æ¨¡å¼ï¼šä½¿ç”¨æ¸¬è©¦æ¨¡åž‹
  if (SYSTEM_TEST_MODE) {
    return TEST_MODELS.AUDITOR;  // gpt-5-nano
  }
  
  // æ­£å¼æ¨¡å¼ï¼šä½¿ç”¨åŽŸæœ‰é‚è¼¯
  // ... åŽŸæœ‰é‚è¼¯ ...
}
```

**ä¿®æ”¹ `shouldUseBatch` å‡½æ•¸**ï¼š

```javascript
/**
 * åˆ¤æ–·ä»»å‹™æ˜¯å¦é©ç”¨ Batch API
 * â­ V8.0 æ¸¬è©¦æ¨¡å¼ï¼šå¦‚æžœ SYSTEM_TEST_MODE = trueï¼Œå…¨éƒ¨ç¦ç”¨ Batch
 * @param {string} projectId - é …ç›® ID
 * @returns {boolean} æ˜¯å¦é©ç”¨ Batch
 */
function shouldUseBatch(projectId) {
  // â­ æ¸¬è©¦æ¨¡å¼ï¼šå…¨éƒ¨ç¦ç”¨ Batch
  if (SYSTEM_TEST_MODE) {
    return false;
  }
  
  // æ­£å¼æ¨¡å¼ï¼šä½¿ç”¨åŽŸæœ‰é‚è¼¯
  if (!GLOBAL_USE_BATCH_API) {
    return false;
  }
  
  // ... åŽŸæœ‰é‚è¼¯ ...
}
```

---

### æ­¥é©Ÿ 2ï¼šåœ¨ API Adapter å¼·åˆ¶é–‹å•Ÿ JSON Mode

**æª”æ¡ˆ**ï¼š`src/04_M0_ADAPTERS.js`

**ä¿®æ”¹ `callGeminiAPI` å‡½æ•¸**ï¼š

```javascript
/**
 * èª¿ç”¨ Gemini API
 * â­ V8.0 æ¸¬è©¦æ¨¡å¼ï¼šå¼·åˆ¶é–‹å•Ÿ JSON Mode
 * @param {string} model - æ¨¡åž‹åç¨±
 * @param {Object} payload - è¼¸å…¥è² è¼‰
 * @param {Object} config - æ¨¡åž‹é…ç½®
 * @return {Object} API éŸ¿æ‡‰çµæžœ
 */
function callGeminiAPI(model, payload, config) {
  // ... åŽŸæœ‰é‚è¼¯ ...
  
  // â­ æ¸¬è©¦æ¨¡å¼ï¼šå¼·åˆ¶é–‹å•Ÿ JSON Mode
  const forceJsonMode = config.forceJsonMode || 
                        (SYSTEM_TEST_MODE && TEST_MODEL_CONFIG[model]?.forceJsonMode);
  
  if (forceJsonMode) {
    // Gemini çš„åƒæ•¸å« responseMimeType
    requestBody.generationConfig = {
      ...requestBody.generationConfig,
      responseMimeType: "application/json"
    };
  }
  
  // ... ç™¼é€è«‹æ±‚ ...
}
```

**ä¿®æ”¹ `callOpenAI` å‡½æ•¸**ï¼š

```javascript
/**
 * èª¿ç”¨ OpenAI APIï¼ˆGPTã€o3ï¼‰
 * â­ V8.0 æ¸¬è©¦æ¨¡å¼ï¼šå¼·åˆ¶é–‹å•Ÿ JSON Mode
 * @param {string} model - æ¨¡åž‹åç¨±
 * @param {Object} payload - è¼¸å…¥è² è¼‰
 * @param {Object} config - æ¨¡åž‹é…ç½®
 * @return {Object} API éŸ¿æ‡‰çµæžœ
 */
function callOpenAI(model, payload, config) {
  // ... åŽŸæœ‰é‚è¼¯ ...
  
  // â­ æ¸¬è©¦æ¨¡å¼ï¼šå¼·åˆ¶é–‹å•Ÿ JSON Mode
  const forceJsonMode = config.forceJsonMode || 
                        (SYSTEM_TEST_MODE && TEST_MODEL_CONFIG[model]?.forceJsonMode);
  
  if (forceJsonMode) {
    // OpenAI çš„åƒæ•¸å« response_format
    requestBody.response_format = { type: "json_object" };
  }
  
  // ... ç™¼é€è«‹æ±‚ ...
}
```

**ä¿®æ”¹ `callClaude` å‡½æ•¸**ï¼š

```javascript
/**
 * èª¿ç”¨ Claude APIï¼ˆSonnetã€Opusï¼‰
 * â­ V8.0 æ¸¬è©¦æ¨¡å¼ï¼šClaude ä¸æ”¯æ´ JSON Modeï¼Œä½†æ¸¬è©¦æ¨¡å¼ä¸ä½¿ç”¨ Claude
 * @param {string} model - æ¨¡åž‹åç¨±
 * @param {Object} payload - è¼¸å…¥è² è¼‰
 * @param {Object} config - æ¨¡åž‹é…ç½®
 * @return {Object} API éŸ¿æ‡‰çµæžœ
 */
function callClaude(model, payload, config) {
  // â­ æ¸¬è©¦æ¨¡å¼ï¼šClaude ä¸æ”¯æ´ JSON Modeï¼Œä½†æ¸¬è©¦æ¨¡å¼ä¸ä½¿ç”¨ Claude
  // å¦‚æžœ SYSTEM_TEST_MODE = trueï¼Œç†è«–ä¸Šä¸æœƒèª¿ç”¨æ­¤å‡½æ•¸
  // ä½†ç‚ºäº†å®‰å…¨ï¼Œä»ç„¶ä¿ç•™åŽŸæœ‰é‚è¼¯
  
  // ... åŽŸæœ‰é‚è¼¯ ...
}
```

---

### æ­¥é©Ÿ 3ï¼šä¿®æ”¹ M0 Core ä»¥ä½¿ç”¨æ¸¬è©¦æ¨¡åž‹é…ç½®

**æª”æ¡ˆ**ï¼š`src/03_M0_CORE.js`

**ä¿®æ”¹ `executeCapability` å‡½æ•¸**ï¼š

```javascript
/**
 * åŸ·è¡Œå–®å€‹ Capability
 * â­ V8.0 æ¸¬è©¦æ¨¡å¼ï¼šä½¿ç”¨æ¸¬è©¦æ¨¡åž‹é…ç½®
 * @param {string} jobId - ä»»å‹™ ID
 * @param {string} capability - Capability åç¨±
 * @param {Object} payload - è¼¸å…¥è² è¼‰
 * @return {Object} åŸ·è¡Œçµæžœ
 */
function executeCapability(jobId, capability, payload) {
  // ... åŽŸæœ‰é‚è¼¯ ...
  
  // â­ æ¸¬è©¦æ¨¡å¼ï¼šä½¿ç”¨æ¸¬è©¦æ¨¡åž‹é…ç½®
  let modelConfig;
  if (SYSTEM_TEST_MODE && TEST_MODEL_CONFIG[model]) {
    modelConfig = TEST_MODEL_CONFIG[model];
  } else {
    modelConfig = M0_MODEL_CONFIG[capability] || M0_MODEL_CONFIG.SONNET;
  }
  
  // ... ä½¿ç”¨ modelConfig ...
}
```

---

### æ­¥é©Ÿ 4ï¼šå‰µå»ºæ¸¬è©¦æŒ‰éˆ•å‡½æ•¸

**æª”æ¡ˆ**ï¼š`src/99_TEST_MODE_BUTTONS.js`ï¼ˆæ–°å»ºï¼‰

```javascript
/**
 * ðŸ§ª æ¸¬è©¦æ¨¡å¼æŒ‰éˆ•å‡½æ•¸ï¼ˆV8.0 æ¸¬è©¦æ¨¡å¼ï¼‰
 * 
 * æ¯å€‹ Phase éƒ½æœ‰ç¨ç«‹çš„æ¸¬è©¦æŒ‰éˆ•ï¼Œæ–¹ä¾¿é€æ­¥æ¸¬è©¦
 * 
 * @version V8.0 æ¸¬è©¦æ¨¡å¼
 * @date 2026-01-19
 */

// ==========================================
// æ¸¬è©¦æ¨¡å¼æª¢æŸ¥
// ==========================================

/**
 * æª¢æŸ¥æ˜¯å¦ç‚ºæ¸¬è©¦æ¨¡å¼
 * @returns {boolean} æ˜¯å¦ç‚ºæ¸¬è©¦æ¨¡å¼
 */
function isTestMode() {
  // å¾ž 02_M0_CONFIG.js è®€å– SYSTEM_TEST_MODE
  return typeof SYSTEM_TEST_MODE !== 'undefined' && SYSTEM_TEST_MODE === true;
}

/**
 * ç¢ºä¿æ¸¬è©¦æ¨¡å¼å·²å•Ÿç”¨
 */
function ensureTestMode() {
  if (!isTestMode()) {
    throw new Error("âš ï¸ æ¸¬è©¦æ¨¡å¼æœªå•Ÿç”¨ï¼è«‹åœ¨ 02_M0_CONFIG.js ä¸­è¨­ç½® SYSTEM_TEST_MODE = true");
  }
}

// ==========================================
// P0 æ¸¬è©¦æŒ‰éˆ•
// ==========================================

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šP0 åŸ·è¡Œ
 */
function TEST_P0_Execute() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šP0 åŸ·è¡Œ");
  
  try {
    const result = P0_Execute({
      trigger: "TEST_MODE",
      context: { test_mode: true }
    });
    
    Logger.log(`âœ… P0 æ¸¬è©¦å®Œæˆï¼š${result.snapshot_id || 'N/A'}`);
    
    // â­ é¡¯ç¤ºæª¢æŸ¥æç¤º
    const checkPrompt = generateTestCheckPrompt("P0", result);
    Logger.log(checkPrompt);
    SpreadsheetApp.getUi().alert(checkPrompt);
    
    return result;
  } catch (error) {
    Logger.log(`âŒ P0 æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šP0.5 åŸ·è¡Œ
 */
function TEST_P0_5_Execute() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šP0.5 åŸ·è¡Œ");
  
  try {
    // æª¢æŸ¥æ˜¯å¦æœ‰ P0 å¿«ç…§ï¼ˆå¦‚æžœæ²’æœ‰ï¼Œå…ˆåŸ·è¡Œ P0ï¼‰
    const p0Snapshot = getLatestP0Snapshot();
    if (!p0Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P0 å¿«ç…§ï¼Œå…ˆåŸ·è¡Œ P0");
      TEST_P0_Execute();
      // é‡æ–°è®€å–
      const p0Snapshot = getLatestP0Snapshot();
      if (!p0Snapshot) {
        throw new Error("P0 åŸ·è¡Œå¤±æ•—ï¼Œç„¡æ³•ç¹¼çºŒ P0.5");
      }
    }
    
    const result = P0_5_Execute({
      trigger: "TEST_MODE",
      context: { test_mode: true, p0_snapshot_id: p0Snapshot.snapshot_id }
    });
    
    Logger.log(`âœ… P0.5 æ¸¬è©¦å®Œæˆï¼š${result.snapshot_id || 'N/A'}`);
    return result;
  } catch (error) {
    Logger.log(`âŒ P0.5 æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šP0.7 åŸ·è¡Œ
 */
function TEST_P0_7_Execute() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šP0.7 åŸ·è¡Œ");
  
  try {
    // æª¢æŸ¥æ˜¯å¦æœ‰ P0 å¿«ç…§
    const p0Snapshot = getLatestP0Snapshot();
    if (!p0Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P0 å¿«ç…§ï¼Œå…ˆåŸ·è¡Œ P0");
      TEST_P0_Execute();
    }
    
    const result = P0_7_Execute({
      trigger: "TEST_MODE",
      context: { test_mode: true }
    });
    
    Logger.log(`âœ… P0.7 æ¸¬è©¦å®Œæˆï¼š${result.snapshot_id || 'N/A'}`);
    
    // â­ é¡¯ç¤ºæª¢æŸ¥æç¤º
    const checkPrompt = generateTestCheckPrompt("P0.7", result);
    Logger.log(checkPrompt);
    SpreadsheetApp.getUi().alert(checkPrompt);
    
    return result;
  } catch (error) {
    Logger.log(`âŒ P0.7 æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}

// ==========================================
// P1 æ¸¬è©¦æŒ‰éˆ•
// ==========================================

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šP1 Step1 åŸ·è¡Œ
 */
function TEST_P1_Step1_Execute() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šP1 Step1 åŸ·è¡Œ");
  
  try {
    // æª¢æŸ¥æ˜¯å¦æœ‰ P0/P0.5/P0.7 å¿«ç…§
    const p0Snapshot = getLatestP0Snapshot();
    const p0_5Snapshot = getLatestP0_5Snapshot();
    const p0_7Snapshot = getLatestP0_7Snapshot();
    
    if (!p0Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P0 å¿«ç…§ï¼Œå…ˆåŸ·è¡Œ P0");
      TEST_P0_Execute();
    }
    if (!p0_5Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P0.5 å¿«ç…§ï¼Œå…ˆåŸ·è¡Œ P0.5");
      TEST_P0_5_Execute();
    }
    if (!p0_7Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P0.7 å¿«ç…§ï¼Œå…ˆåŸ·è¡Œ P0.7");
      TEST_P0_7_Execute();
    }
    
    const result = P1_Step1_Execute({
      trigger: "TEST_MODE",
      context: { test_mode: true }
    });
    
    Logger.log(`âœ… P1 Step1 æ¸¬è©¦å®Œæˆ`);
    
    // â­ é¡¯ç¤ºæª¢æŸ¥æç¤º
    const checkPrompt = generateTestCheckPrompt("P1 Step1", result);
    Logger.log(checkPrompt);
    SpreadsheetApp.getUi().alert(checkPrompt);
    
    return result;
  } catch (error) {
    Logger.log(`âŒ P1 Step1 æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šP1 Step2 åŸ·è¡Œ
 */
function TEST_P1_Step2_Execute() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šP1 Step2 åŸ·è¡Œ");
  
  try {
    // æª¢æŸ¥æ˜¯å¦æœ‰ P1 Step1 çµæžœ
    const p1Snapshot = getLatestP1Snapshot();
    if (!p1Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P1 Step1 çµæžœï¼Œå…ˆåŸ·è¡Œ P1 Step1");
      TEST_P1_Step1_Execute();
    }
    
    const result = P1_Step2_Execute({
      trigger: "TEST_MODE",
      context: { test_mode: true }
    });
    
    Logger.log(`âœ… P1 Step2 æ¸¬è©¦å®Œæˆï¼š${result.snapshot_id || 'N/A'}`);
    
    // â­ é¡¯ç¤ºæª¢æŸ¥æç¤º
    const checkPrompt = generateTestCheckPrompt("P1 Step2", result);
    Logger.log(checkPrompt);
    SpreadsheetApp.getUi().alert(checkPrompt);
    
    return result;
  } catch (error) {
    Logger.log(`âŒ P1 Step2 æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}

// ==========================================
// P2 æ¸¬è©¦æŒ‰éˆ•
// ==========================================

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šP2 åŸ·è¡Œ
 */
function TEST_P2_Execute() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šP2 åŸ·è¡Œ");
  
  try {
    // æª¢æŸ¥æ˜¯å¦æœ‰ P1 å¿«ç…§
    const p1Snapshot = getLatestP1Snapshot();
    if (!p1Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P1 å¿«ç…§ï¼Œå…ˆåŸ·è¡Œ P1");
      TEST_P1_Step2_Execute();
    }
    
    const result = P2_Monthly_Execute({
      trigger: "TEST_MODE",
      context: { test_mode: true }
    });
    
    Logger.log(`âœ… P2 æ¸¬è©¦å®Œæˆï¼š${result.snapshot_id || 'N/A'}`);
    
    // â­ é¡¯ç¤ºæª¢æŸ¥æç¤º
    const checkPrompt = generateTestCheckPrompt("P2", result);
    Logger.log(checkPrompt);
    SpreadsheetApp.getUi().alert(checkPrompt);
    
    return result;
  } catch (error) {
    Logger.log(`âŒ P2 æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}

// ==========================================
// P2.5 æ¸¬è©¦æŒ‰éˆ•
// ==========================================

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šP2.5 åŸ·è¡Œ
 */
function TEST_P2_5_Execute() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šP2.5 åŸ·è¡Œ");
  
  try {
    // æª¢æŸ¥æ˜¯å¦æœ‰ P2 å¿«ç…§
    const p2Snapshot = getLatestP2Snapshot();
    if (!p2Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P2 å¿«ç…§ï¼Œå…ˆåŸ·è¡Œ P2");
      TEST_P2_Execute();
    }
    
    const result = P2_5_Execute({
      trigger: "TEST_MODE",
      context: { test_mode: true }
    });
    
    Logger.log(`âœ… P2.5 æ¸¬è©¦å®Œæˆï¼š${result.snapshot_id || 'N/A'}`);
    
    // â­ é¡¯ç¤ºæª¢æŸ¥æç¤º
    const checkPrompt = generateTestCheckPrompt("P2.5", result);
    Logger.log(checkPrompt);
    SpreadsheetApp.getUi().alert(checkPrompt);
    
    return result;
  } catch (error) {
    Logger.log(`âŒ P2.5 æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}

// ==========================================
// P3 æ¸¬è©¦æŒ‰éˆ•
// ==========================================

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šP3 åŸ·è¡Œ
 */
function TEST_P3_Execute() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šP3 åŸ·è¡Œ");
  
  try {
    // æª¢æŸ¥æ˜¯å¦æœ‰ P2 å’Œ P2.5 å¿«ç…§
    const p2Snapshot = getLatestP2Snapshot();
    const p2_5Snapshot = getLatestP2_5Snapshot();
    
    if (!p2Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P2 å¿«ç…§ï¼Œå…ˆåŸ·è¡Œ P2");
      TEST_P2_Execute();
    }
    if (!p2_5Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P2.5 å¿«ç…§ï¼Œå…ˆåŸ·è¡Œ P2.5");
      TEST_P2_5_Execute();
    }
    
    const result = P3_Execute({
      trigger: "TEST_MODE",
      context: { test_mode: true }
    });
    
    Logger.log(`âœ… P3 æ¸¬è©¦å®Œæˆï¼š${result.snapshot_id || 'N/A'}`);
    
    // â­ é¡¯ç¤ºæª¢æŸ¥æç¤º
    const checkPrompt = generateTestCheckPrompt("P3", result);
    Logger.log(checkPrompt);
    SpreadsheetApp.getUi().alert(checkPrompt);
    
    return result;
  } catch (error) {
    Logger.log(`âŒ P3 æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}

// ==========================================
// P4 æ¸¬è©¦æŒ‰éˆ•
// ==========================================

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šP4 åŸ·è¡Œ
 */
function TEST_P4_Execute() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šP4 åŸ·è¡Œ");
  
  try {
    // æª¢æŸ¥æ˜¯å¦æœ‰ P2 å’Œ P3 å¿«ç…§
    const p2Snapshot = getLatestP2Snapshot();
    const p3Snapshot = getLatestP3Snapshot();
    
    if (!p2Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P2 å¿«ç…§ï¼Œå…ˆåŸ·è¡Œ P2");
      TEST_P2_Execute();
    }
    if (!p3Snapshot) {
      Logger.log("âš ï¸ æ²’æœ‰ P3 å¿«ç…§ï¼Œå…ˆåŸ·è¡Œ P3");
      TEST_P3_Execute();
    }
    
    const result = P4_Calculate({
      trigger: "TEST_MODE",
      reason: "æ¸¬è©¦æ¨¡å¼åŸ·è¡Œ",
      context: { test_mode: true }
    });
    
    Logger.log(`âœ… P4 æ¸¬è©¦å®Œæˆï¼š${result.snapshot_id || 'N/A'}`);
    
    // â­ é¡¯ç¤ºæª¢æŸ¥æç¤º
    const checkPrompt = generateTestCheckPrompt("P4", result);
    Logger.log(checkPrompt);
    SpreadsheetApp.getUi().alert(checkPrompt);
    
    return result;
  } catch (error) {
    Logger.log(`âŒ P4 æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}

// ==========================================
// P5 Daily æ¸¬è©¦æŒ‰éˆ•
// ==========================================

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šP5 Daily åŸ·è¡Œ
 */
function TEST_P5_Daily_Execute() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šP5 Daily åŸ·è¡Œ");
  
  try {
    const result = P5_Daily_Execute({
      trigger: "TEST_MODE",
      context: { test_mode: true }
    });
    
    Logger.log(`âœ… P5 Daily æ¸¬è©¦å®Œæˆ`);
    
    // â­ é¡¯ç¤ºæª¢æŸ¥æç¤º
    const checkPrompt = generateTestCheckPrompt("P5 Daily", result);
    Logger.log(checkPrompt);
    SpreadsheetApp.getUi().alert(checkPrompt);
    
    return result;
  } catch (error) {
    Logger.log(`âŒ P5 Daily æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}

// ==========================================
// P5 Weekly æ¸¬è©¦æŒ‰éˆ•
// ==========================================

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šP5 Weekly åŸ·è¡Œ
 */
function TEST_P5_Weekly_Execute() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šP5 Weekly åŸ·è¡Œ");
  
  try {
    // æª¢æŸ¥æ˜¯å¦æœ‰ P0-P4 å¿«ç…§ï¼ˆå¯é¸ï¼ŒP5 Weekly æœƒè‡ªå‹•æª¢æŸ¥ï¼‰
    const result = P5_Weekly_Execute({
      trigger: "TEST_MODE",
      context: { test_mode: true }
    });
    
    Logger.log(`âœ… P5 Weekly æ¸¬è©¦å®Œæˆ`);
    
    // â­ é¡¯ç¤ºæª¢æŸ¥æç¤º
    const checkPrompt = generateTestCheckPrompt("P5 Weekly", result);
    Logger.log(checkPrompt);
    
    // â­ é¡¯ç¤º Token ä½¿ç”¨é‡å ±å‘Š
    const tokenReport = formatTestTokenReport();
    Logger.log(tokenReport);
    
    SpreadsheetApp.getUi().alert(checkPrompt + "\n\n" + tokenReport);
    
    return result;
  } catch (error) {
    Logger.log(`âŒ P5 Weekly æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}

// ==========================================
// å®Œæ•´æµç¨‹æ¸¬è©¦æŒ‰éˆ•
// ==========================================

/**
 * ðŸ§ª æ¸¬è©¦æŒ‰éˆ•ï¼šå®Œæ•´æµç¨‹ï¼ˆP0 -> P4ï¼‰
 */
function TEST_Full_Pipeline_P0_to_P4() {
  ensureTestMode();
  Logger.log("ðŸ§ª æ¸¬è©¦æ¨¡å¼ï¼šå®Œæ•´æµç¨‹ï¼ˆP0 -> P4ï¼‰");
  
  try {
    // æŒ‰é †åºåŸ·è¡Œ
    TEST_P0_Execute();
    TEST_P0_5_Execute();
    TEST_P0_7_Execute();
    TEST_P1_Step1_Execute();
    TEST_P1_Step2_Execute();
    TEST_P2_Execute();
    TEST_P2_5_Execute();
    TEST_P3_Execute();
    TEST_P4_Execute();
    
    Logger.log("âœ… å®Œæ•´æµç¨‹ï¼ˆP0 -> P4ï¼‰æ¸¬è©¦å®Œæˆ");
    return { success: true, message: "å®Œæ•´æµç¨‹æ¸¬è©¦å®Œæˆ" };
  } catch (error) {
    Logger.log(`âŒ å®Œæ•´æµç¨‹æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
    throw error;
  }
}
```

---

### æ­¥é©Ÿ 5ï¼šToken è¨ˆæ•¸æ©Ÿåˆ¶

**æª”æ¡ˆ**ï¼š`src/05_MONITORING.js`ï¼ˆå·²å­˜åœ¨ï¼Œéœ€è¦å¢žå¼·ï¼‰

**æ–°å¢žæ¸¬è©¦æ¨¡å¼ Token è¨ˆæ•¸**ï¼š

```javascript
/**
 * â­ V8.0 æ¸¬è©¦æ¨¡å¼ï¼šè¨˜éŒ„æ¸¬è©¦ Token ä½¿ç”¨é‡
 * 
 * æ¸¬è©¦æ¨¡å¼å°ˆç”¨çš„ Token è¨ˆæ•¸ï¼Œèˆ‡æ­£å¼æ¨¡å¼åˆ†é–‹è¨˜éŒ„
 */
const TEST_TOKEN_USAGE = {
  total_input_tokens: 0,
  total_output_tokens: 0,
  total_cost: 0,
  phase_breakdown: {}  // æŒ‰ Phase åˆ†é¡ž
};

/**
 * è¨˜éŒ„æ¸¬è©¦æ¨¡å¼ Token ä½¿ç”¨é‡
 * @param {string} phase - Phase åç¨±ï¼ˆä¾‹å¦‚ï¼šP0, P1, P2ï¼‰
 * @param {number} inputTokens - è¼¸å…¥ tokens
 * @param {number} outputTokens - è¼¸å‡º tokens
 * @param {number} cost - æˆæœ¬ï¼ˆUSDï¼‰
 */
function recordTestTokenUsage(phase, inputTokens, outputTokens, cost) {
  if (!SYSTEM_TEST_MODE) {
    return;  // éžæ¸¬è©¦æ¨¡å¼ä¸è¨˜éŒ„
  }
  
  TEST_TOKEN_USAGE.total_input_tokens += inputTokens;
  TEST_TOKEN_USAGE.total_output_tokens += outputTokens;
  TEST_TOKEN_USAGE.total_cost += cost;
  
  if (!TEST_TOKEN_USAGE.phase_breakdown[phase]) {
    TEST_TOKEN_USAGE.phase_breakdown[phase] = {
      input_tokens: 0,
      output_tokens: 0,
      cost: 0
    };
  }
  
  TEST_TOKEN_USAGE.phase_breakdown[phase].input_tokens += inputTokens;
  TEST_TOKEN_USAGE.phase_breakdown[phase].output_tokens += outputTokens;
  TEST_TOKEN_USAGE.phase_breakdown[phase].cost += cost;
}

/**
 * ç²å–æ¸¬è©¦æ¨¡å¼ Token ä½¿ç”¨é‡å ±å‘Š
 * @returns {Object} Token ä½¿ç”¨é‡å ±å‘Š
 */
function getTestTokenUsageReport() {
  return {
    total_input_tokens: TEST_TOKEN_USAGE.total_input_tokens,
    total_output_tokens: TEST_TOKEN_USAGE.total_output_tokens,
    total_tokens: TEST_TOKEN_USAGE.total_input_tokens + TEST_TOKEN_USAGE.total_output_tokens,
    total_cost: TEST_TOKEN_USAGE.total_cost,
    phase_breakdown: TEST_TOKEN_USAGE.phase_breakdown
  };
}

/**
 * é‡ç½®æ¸¬è©¦æ¨¡å¼ Token ä½¿ç”¨é‡
 */
function resetTestTokenUsage() {
  TEST_TOKEN_USAGE.total_input_tokens = 0;
  TEST_TOKEN_USAGE.total_output_tokens = 0;
  TEST_TOKEN_USAGE.total_cost = 0;
  TEST_TOKEN_USAGE.phase_breakdown = {};
}
```

**åœ¨ `executeCapability` ä¸­è¨˜éŒ„ Token**ï¼š

```javascript
// åœ¨ executeCapability å‡½æ•¸ä¸­ï¼ŒAPI èª¿ç”¨å®Œæˆå¾Œ
if (SYSTEM_TEST_MODE) {
  const cost = (result.inputTokens * modelConfig.costPer1KTokens / 1000) +
               (result.outputTokens * modelConfig.costPer1KOutputTokens / 1000);
  recordTestTokenUsage(capability, result.inputTokens, result.outputTokens, cost);
}
```

---

### æ­¥é©Ÿ 6ï¼šæª¢æŸ¥è¡Œäº‹æ›†å’Œè²¡å ±æ•¸æ“š

**æª¢æŸ¥é …ç›®**ï¼š
1. **2026 å¹´é‡å¤§è²¡ç¶“è¡Œäº‹æ›†**ï¼šæª¢æŸ¥ `P5__CALENDAR` è¡¨æ ¼æ˜¯å¦æœ‰ 2026 å¹´æ•¸æ“š
2. **æ¿å¡Šé¾é ­è²¡å ±**ï¼šæª¢æŸ¥ `EARNINGS_STRATEGIES` æˆ–ç›¸é—œè¡¨æ ¼æ˜¯å¦æœ‰ 2026 å¹´è²¡å ±æ—¥æœŸ

**æª¢æŸ¥å‡½æ•¸**ï¼š

```javascript
/**
 * æª¢æŸ¥ 2026 å¹´è¡Œäº‹æ›†å’Œè²¡å ±æ•¸æ“š
 * @returns {Object} æª¢æŸ¥çµæžœ
 */
function check2026CalendarAndEarnings() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const calendarSheet = ss.getSheetByName("P5__CALENDAR");
  const earningsSheet = ss.getSheetByName("EARNINGS_STRATEGIES");  // æˆ–å…¶ä»–è²¡å ±è¡¨æ ¼
  
  const result = {
    calendar_2026: {
      exists: false,
      count: 0,
      dates: []
    },
    earnings_2026: {
      exists: false,
      count: 0,
      dates: []
    }
  };
  
  // æª¢æŸ¥è¡Œäº‹æ›†
  if (calendarSheet && calendarSheet.getLastRow() > 1) {
    const dataRange = calendarSheet.getDataRange();
    const rows = dataRange.getValues();
    const headers = rows[0];
    const dateCol = headers.indexOf("date");
    
    if (dateCol !== -1) {
      for (let i = 1; i < rows.length; i++) {
        const date = rows[i][dateCol];
        if (date && date instanceof Date) {
          const year = date.getFullYear();
          if (year === 2026) {
            result.calendar_2026.exists = true;
            result.calendar_2026.count++;
            result.calendar_2026.dates.push(date);
          }
        }
      }
    }
  }
  
  // æª¢æŸ¥è²¡å ±
  if (earningsSheet && earningsSheet.getLastRow() > 1) {
    const dataRange = earningsSheet.getDataRange();
    const rows = dataRange.getValues();
    const headers = rows[0];
    const dateCol = headers.indexOf("earnings_date") || headers.indexOf("date");
    
    if (dateCol !== -1) {
      for (let i = 1; i < rows.length; i++) {
        const date = rows[i][dateCol];
        if (date && date instanceof Date) {
          const year = date.getFullYear();
          if (year === 2026) {
            result.earnings_2026.exists = true;
            result.earnings_2026.count++;
            result.earnings_2026.dates.push(date);
          }
        }
      }
    }
  }
  
  return result;
}
```

---

## æ¸¬è©¦æµç¨‹è¨ˆåŠƒ

### éšŽæ®µ 1ï¼šæ‰‹å‹•æ¸¬è©¦ P0 -> P4

**ç›®æ¨™**ï¼šç¢ºä¿æ¯å€‹ Phase éƒ½èƒ½æ­£å¸¸åŸ·è¡Œä¸¦ä¿å­˜æ•¸æ“š

**æ­¥é©Ÿ**ï¼š
1. å•Ÿç”¨æ¸¬è©¦æ¨¡å¼ï¼ˆ`SYSTEM_TEST_MODE = true`ï¼‰
2. åŸ·è¡Œ `TEST_P0_Execute()`
3. åŸ·è¡Œ `TEST_P0_5_Execute()`ï¼ˆè‡ªå‹•æª¢æŸ¥ P0 å¿«ç…§ï¼‰
4. åŸ·è¡Œ `TEST_P0_7_Execute()`ï¼ˆè‡ªå‹•æª¢æŸ¥ P0 å¿«ç…§ï¼‰
5. åŸ·è¡Œ `TEST_P1_Step1_Execute()`ï¼ˆè‡ªå‹•æª¢æŸ¥ P0/P0.5/P0.7 å¿«ç…§ï¼‰
6. åŸ·è¡Œ `TEST_P1_Step2_Execute()`ï¼ˆè‡ªå‹•æª¢æŸ¥ P1 Step1 çµæžœï¼‰
7. åŸ·è¡Œ `TEST_P2_Execute()`ï¼ˆè‡ªå‹•æª¢æŸ¥ P1 å¿«ç…§ï¼‰
8. åŸ·è¡Œ `TEST_P2_5_Execute()`ï¼ˆè‡ªå‹•æª¢æŸ¥ P2 å¿«ç…§ï¼‰
9. åŸ·è¡Œ `TEST_P3_Execute()`ï¼ˆè‡ªå‹•æª¢æŸ¥ P2/P2.5 å¿«ç…§ï¼‰
10. åŸ·è¡Œ `TEST_P4_Execute()`ï¼ˆè‡ªå‹•æª¢æŸ¥ P2/P3 å¿«ç…§ï¼‰

**æª¢æŸ¥é …ç›®**ï¼š
- [ ] æ¯å€‹ Phase éƒ½èƒ½æ­£å¸¸åŸ·è¡Œ
- [ ] å¿«ç…§éƒ½æ­£ç¢ºä¿å­˜
- [ ] æ•¸æ“šæµå®Œæ•´æ€§ï¼ˆP1 -> P2 -> P4ï¼‰
- [ ] æ‰€æœ‰æ¬„ä½éƒ½æœ‰è¢«å¡«å¯«

---

### éšŽæ®µ 2ï¼šæ¸¬è©¦æ¨¡å¼é‹è¡Œä¸€é€±

**ç›®æ¨™**ï¼šæ¸¬è©¦ P5 Daily/Weekly æ˜¯å¦æ­£å¸¸å·¥ä½œ

**æ­¥é©Ÿ**ï¼š
1. ç¢ºä¿ P0 -> P4 éƒ½å·²åŸ·è¡Œå®Œæˆ
2. æ¯å¤©åŸ·è¡Œ `TEST_P5_Daily_Execute()`
3. æ¯é€±åŸ·è¡Œ `TEST_P5_Weekly_Execute()`
4. é‹è¡Œä¸€é€±ï¼ˆ7 å¤©ï¼‰

**æª¢æŸ¥é …ç›®**ï¼š
- [ ] P5 Daily æ¯å¤©æ­£å¸¸åŸ·è¡Œ
- [ ] P5 Weekly æ¯é€±æ­£å¸¸åŸ·è¡Œ
- [ ] æ˜¯å¦æœ‰ç”¢ç”Ÿæ‰¹æ¬¡æŽ›å–®ç­–ç•¥ï¼ˆ`weekly_trade_actions`ï¼‰
- [ ] æ‰€æœ‰æ‡‰è©²å¡«å¯«çš„æ¬„ä½æ˜¯å¦éƒ½æœ‰è¢«å¡«å¯«
- [ ] æ­·å²å‹•æ…‹ç¶“é©—å­¸ç¿’èˆ‡è¨˜æ†¶æ˜¯å¦æ­£å¸¸é‹ä½œ

---

### éšŽæ®µ 3ï¼šToken ä½¿ç”¨é‡çµ±è¨ˆ

**ç›®æ¨™**ï¼šè¨ˆç®—å¯¦éš›ä¸€é€±æ‰€ç”¨çš„ input/output tokens æ•¸ç›®

**æ­¥é©Ÿ**ï¼š
1. åœ¨æ¸¬è©¦é–‹å§‹å‰åŸ·è¡Œ `resetTestTokenUsage()`
2. é‹è¡Œä¸€é€±æ¸¬è©¦
3. åŸ·è¡Œ `getTestTokenUsageReport()` ç²å–å ±å‘Š

**å ±å‘Šå…§å®¹**ï¼š
- ç¸½è¼¸å…¥ tokens
- ç¸½è¼¸å‡º tokens
- ç¸½æˆæœ¬
- æŒ‰ Phase åˆ†é¡žçš„è©³ç´°çµ±è¨ˆ

---

## åˆ‡æ›å›žæ­£å¼æ¨¡å¼

### åˆ‡æ›æ­¥é©Ÿ

1. **é—œé–‰æ¸¬è©¦æ¨¡å¼**ï¼š
   ```javascript
   // 02_M0_CONFIG.js
   const SYSTEM_TEST_MODE = false;  // æ”¹å›ž false
   ```

2. **æ¢å¾© Batch API**ï¼š
   ```javascript
   // 02_M0_CONFIG.js
   const GLOBAL_USE_BATCH_API = true;  // æ”¹å›ž true
   ```

3. **é©—è­‰**ï¼š
   - ç¢ºèªæ‰€æœ‰æ¸¬è©¦æ¨¡å¼ç›¸é—œçš„ä¿®æ”¹éƒ½å·²æ¨™è¨˜æ¸…æ¥š
   - ç¢ºèªæ­£å¼æ¨¡å¼é‚è¼¯æœªè¢«å½±éŸ¿

---

## æª¢æŸ¥æ¸…å–®

### å¯¦ç¾å‰æª¢æŸ¥

- [ ] ç¢ºèª 2026 å¹´è¡Œäº‹æ›†æ•¸æ“šå·²å…§å»º
- [ ] ç¢ºèª 2026 å¹´è²¡å ±æ•¸æ“šå·²å…§å»º
- [ ] ç¢ºèªæ¸¬è©¦æ¨¡åž‹åç¨±æ­£ç¢ºï¼ˆgemini-2.0-flash-lite-preview-02-05, gpt-5-nanoï¼‰
- [ ] ç¢ºèªæ¸¬è©¦æ¨¡åž‹åƒ¹æ ¼ï¼ˆç”¨æ–¼æˆæœ¬è¨ˆç®—ï¼‰

### å¯¦ç¾å¾Œæª¢æŸ¥

- [ ] æ¸¬è©¦æ¨¡å¼é–‹é—œæ­£å¸¸å·¥ä½œ
- [ ] æ¨¡åž‹æ˜ å°„æ­£å¸¸å·¥ä½œ
- [ ] JSON Mode å¼·åˆ¶é–‹å•Ÿæ­£å¸¸å·¥ä½œ
- [ ] Batch API åœ¨æ¸¬è©¦æ¨¡å¼ä¸‹è¢«ç¦ç”¨
- [ ] æ¸¬è©¦æŒ‰éˆ•å‡½æ•¸éƒ½èƒ½æ­£å¸¸åŸ·è¡Œ
- [ ] Token è¨ˆæ•¸æ­£å¸¸å·¥ä½œ

### æ¸¬è©¦å®Œæˆå¾Œæª¢æŸ¥

- [ ] æ‰€æœ‰æ¸¬è©¦æ¨¡å¼ä¿®æ”¹éƒ½å·²æ¨™è¨˜æ¸…æ¥š
- [ ] åˆ‡æ›å›žæ­£å¼æ¨¡å¼å¾Œç³»çµ±æ­£å¸¸é‹ä½œ
- [ ] æ²’æœ‰éºæ¼ä»»ä½•ä¿®æ”¹

---

## è¡Œäº‹æ›†å’Œè²¡å ±æ•¸æ“šæª¢æŸ¥

### æª¢æŸ¥çµæžœ

**2026 å¹´é‡å¤§è²¡ç¶“è¡Œäº‹æ›†**ï¼š
- âœ… **å·²å…§å»º**ï¼š`src/IMPORT_P5_CALENDAR_2026.js` æä¾›å°Žå…¥åŠŸèƒ½
- âœ… **è¡¨æ ¼**ï¼š`P5__CALENDAR` è¡¨æ ¼ç”¨æ–¼å­˜å„²è¡Œäº‹æ›†æ•¸æ“š
- âš ï¸ **éœ€è¦ç¢ºèª**ï¼šæ˜¯å¦å·²åŸ·è¡Œå°Žå…¥ï¼Œæ•¸æ“šæ˜¯å¦å®Œæ•´

**æ¿å¡Šé¾é ­è²¡å ±**ï¼š
- âœ… **å·²å…§å»º**ï¼š`src/27_EARNINGS_REVENUE_MANAGER.js` æä¾›è²¡å ±ç®¡ç†åŠŸèƒ½
- âœ… **è¡¨æ ¼**ï¼š`EARNINGS_CALENDAR` è¡¨æ ¼ç”¨æ–¼å­˜å„²è²¡å ±æ—¥æœŸ
- âš ï¸ **éœ€è¦ç¢ºèª**ï¼šæ˜¯å¦å·²åŸ·è¡Œå°Žå…¥ï¼Œ2026 å¹´è²¡å ±æ•¸æ“šæ˜¯å¦å®Œæ•´

### æª¢æŸ¥å‡½æ•¸

```javascript
/**
 * æª¢æŸ¥ 2026 å¹´è¡Œäº‹æ›†å’Œè²¡å ±æ•¸æ“š
 * @returns {Object} æª¢æŸ¥çµæžœ
 */
function check2026CalendarAndEarnings() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const calendarSheet = ss.getSheetByName("P5__CALENDAR");
  const earningsSheet = ss.getSheetByName("EARNINGS_CALENDAR");
  
  const result = {
    calendar_2026: {
      exists: false,
      count: 0,
      sample_dates: []
    },
    earnings_2026: {
      exists: false,
      count: 0,
      sample_dates: []
    }
  };
  
  // æª¢æŸ¥è¡Œäº‹æ›†
  if (calendarSheet && calendarSheet.getLastRow() > 1) {
    const dataRange = calendarSheet.getDataRange();
    const rows = dataRange.getValues();
    const headers = rows[0];
    const dateCol = headers.indexOf("date_start") || headers.indexOf("date");
    
    if (dateCol !== -1) {
      for (let i = 1; i < rows.length; i++) {
        const date = rows[i][dateCol];
        if (date && date instanceof Date) {
          const year = date.getFullYear();
          if (year === 2026) {
            result.calendar_2026.exists = true;
            result.calendar_2026.count++;
            if (result.calendar_2026.sample_dates.length < 5) {
              result.calendar_2026.sample_dates.push(date);
            }
          }
        }
      }
    }
  }
  
  // æª¢æŸ¥è²¡å ±
  if (earningsSheet && earningsSheet.getLastRow() > 1) {
    const dataRange = earningsSheet.getDataRange();
    const rows = dataRange.getValues();
    const headers = rows[0];
    const dateCol = headers.indexOf("earnings_date") || headers.indexOf("date");
    
    if (dateCol !== -1) {
      for (let i = 1; i < rows.length; i++) {
        const date = rows[i][dateCol];
        if (date && date instanceof Date) {
          const year = date.getFullYear();
          if (year === 2026) {
            result.earnings_2026.exists = true;
            result.earnings_2026.count++;
            if (result.earnings_2026.sample_dates.length < 5) {
              result.earnings_2026.sample_dates.push(date);
            }
          }
        }
      }
    }
  }
  
  return result;
}
```

### æ¸¬è©¦å‰æª¢æŸ¥æ¸…å–®

- [ ] åŸ·è¡Œ `check2026CalendarAndEarnings()` æª¢æŸ¥æ•¸æ“šå®Œæ•´æ€§
- [ ] å¦‚æžœæ•¸æ“šä¸å®Œæ•´ï¼ŒåŸ·è¡Œ `importP5Calendar2026()` å°Žå…¥æ•¸æ“š
- [ ] ç¢ºèª FOMCã€CPIã€éžè¾²ç­‰é‡è¦äº‹ä»¶éƒ½æœ‰æ•¸æ“š
- [ ] ç¢ºèªæ¿å¡Šé¾é ­ï¼ˆMag 7ã€å°ç©é›»ã€ASML ç­‰ï¼‰è²¡å ±æ—¥æœŸéƒ½æœ‰æ•¸æ“š

---

## æ³¨æ„äº‹é …

1. **æ¨¡åž‹åç¨±ç¢ºèª**ï¼š
   - âš ï¸ **éœ€è¦ç¢ºèª**ï¼š`gemini-2.0-flash-lite-preview-02-05` å’Œ `gpt-5-nano` çš„å¯¦éš›æ¨¡åž‹åç¨±
   - âš ï¸ **éœ€è¦ç¢ºèª**ï¼šé€™äº›æ¨¡åž‹çš„å¯¦éš›åƒ¹æ ¼ï¼ˆç”¨æ–¼æˆæœ¬è¨ˆç®—ï¼‰
   - âš ï¸ **å‚™ç”¨æ–¹æ¡ˆ**ï¼šå¦‚æžœæ¨¡åž‹åç¨±ä¸æ­£ç¢ºï¼Œå¯ä»¥ä½¿ç”¨ï¼š
     - Gemini Flash-Liteï¼š`gemini-2.0-flash-exp` æˆ– `gemini-1.5-flash`
     - GPT-5-nanoï¼š`gpt-4o-mini` æˆ– `gpt-3.5-turbo`ï¼ˆå¦‚æžœ gpt-5-nano ä¸å­˜åœ¨ï¼‰

2. **JSON Mode æ”¯æ´**ï¼š
   - âœ… Gemini Flash-Lite æ”¯æ´ `responseMimeType: "application/json"`ï¼ˆåœ¨ `generationConfig` ä¸­ï¼‰
   - âœ… GPT-5-nano æ”¯æ´ `response_format: { type: "json_object" }`ï¼ˆåœ¨è«‹æ±‚é«”ä¸­ï¼‰
   - âš ï¸ **éœ€è¦æ¸¬è©¦**ï¼šç¢ºèªå¯¦éš› API åƒæ•¸åç¨±å’Œæ ¼å¼

3. **æ¸¬è©¦æ¨¡å¼æ¨™è¨˜**ï¼š
   - æ‰€æœ‰æ¸¬è©¦æ¨¡å¼ç›¸é—œçš„ä¿®æ”¹éƒ½æ‡‰è©²ç”¨ `â­ V8.0 æ¸¬è©¦æ¨¡å¼` æ¨™è¨˜
   - æ–¹ä¾¿æ¸¬è©¦å®Œæˆå¾Œå¿«é€Ÿæ‰¾åˆ°ä¸¦ç§»é™¤
   - å»ºè­°ä½¿ç”¨è¨»é‡‹æ¨™è¨˜ï¼š`// â­ V8.0 æ¸¬è©¦æ¨¡å¼ï¼š...`

4. **æ•¸æ“šéš”é›¢**ï¼š
   - æ¸¬è©¦æ¨¡å¼çš„æ•¸æ“šæ‡‰è©²èˆ‡æ­£å¼æ¨¡å¼åˆ†é–‹
   - ä½¿ç”¨ `trigger: "TEST_MODE"` æ¨™è¨˜æ¸¬è©¦æ•¸æ“š
   - æˆ–è€…ä½¿ç”¨ç¨ç«‹çš„æ¸¬è©¦è¡¨æ ¼ï¼ˆå»ºè­°ï¼Œä½†éœ€è¦æ›´å¤šä¿®æ”¹ï¼‰

5. **æ¸¬è©¦æ¨¡å¼é–‹é—œä½ç½®**ï¼š
   - çµ±ä¸€åœ¨ `02_M0_CONFIG.js` ä¸­è¨­ç½® `SYSTEM_TEST_MODE`
   - æ‰€æœ‰å…¶ä»–æª”æ¡ˆéƒ½å¾žé€™å€‹é–‹é—œè®€å–ç‹€æ…‹
   - é¿å…åœ¨å¤šå€‹åœ°æ–¹è¨­ç½®é–‹é—œï¼Œé€ æˆæ··äº‚

---

## å¯¦ç¾æª¢æŸ¥æ¸…å–®

### å¯¦ç¾å‰æª¢æŸ¥

- [ ] ç¢ºèª 2026 å¹´è¡Œäº‹æ›†æ•¸æ“šå·²å…§å»ºï¼ˆåŸ·è¡Œ `check2026CalendarAndEarnings()`ï¼‰
- [ ] ç¢ºèª 2026 å¹´è²¡å ±æ•¸æ“šå·²å…§å»º
- [ ] ç¢ºèªæ¸¬è©¦æ¨¡åž‹åç¨±æ­£ç¢ºï¼ˆgemini-2.0-flash-lite-preview-02-05, gpt-5-nanoï¼‰
- [ ] ç¢ºèªæ¸¬è©¦æ¨¡åž‹åƒ¹æ ¼ï¼ˆç”¨æ–¼æˆæœ¬è¨ˆç®—ï¼‰
- [ ] ç¢ºèª JSON Mode API åƒæ•¸æ ¼å¼

### å¯¦ç¾æ­¥é©Ÿæª¢æŸ¥

- [ ] æ­¥é©Ÿ 1ï¼šåœ¨ `02_M0_CONFIG.js` æ·»åŠ æ¸¬è©¦æ¨¡å¼é…ç½®
- [ ] æ­¥é©Ÿ 2ï¼šåœ¨ `04_M0_ADAPTERS.js` æ·»åŠ  JSON Mode å¼·åˆ¶é–‹å•Ÿ
- [ ] æ­¥é©Ÿ 3ï¼šåœ¨ `03_M0_CORE.js` ä½¿ç”¨æ¸¬è©¦æ¨¡åž‹é…ç½®
- [ ] æ­¥é©Ÿ 4ï¼šå‰µå»º `99_TEST_MODE_BUTTONS.js` æ¸¬è©¦æŒ‰éˆ•å‡½æ•¸
- [ ] æ­¥é©Ÿ 5ï¼šåœ¨ `05_MONITORING.js` æ·»åŠ  Token è¨ˆæ•¸æ©Ÿåˆ¶
- [ ] æ­¥é©Ÿ 6ï¼šæª¢æŸ¥è¡Œäº‹æ›†å’Œè²¡å ±æ•¸æ“š

### å¯¦ç¾å¾Œæª¢æŸ¥

- [ ] æ¸¬è©¦æ¨¡å¼é–‹é—œæ­£å¸¸å·¥ä½œï¼ˆ`SYSTEM_TEST_MODE = true`ï¼‰
- [ ] æ¨¡åž‹æ˜ å°„æ­£å¸¸å·¥ä½œï¼ˆæ‰€æœ‰ Executor éƒ½ä½¿ç”¨ Flash-Liteï¼‰
- [ ] å¯©æŸ¥è€…æ˜ å°„æ­£å¸¸å·¥ä½œï¼ˆæ‰€æœ‰ Auditor éƒ½ä½¿ç”¨ GPT-5-nanoï¼‰
- [ ] JSON Mode å¼·åˆ¶é–‹å•Ÿæ­£å¸¸å·¥ä½œï¼ˆè¼¸å‡ºæ ¼å¼æ­£ç¢ºï¼‰
- [ ] Batch API åœ¨æ¸¬è©¦æ¨¡å¼ä¸‹è¢«ç¦ç”¨ï¼ˆ`shouldUseBatch` è¿”å›ž falseï¼‰
- [ ] æ¸¬è©¦æŒ‰éˆ•å‡½æ•¸éƒ½èƒ½æ­£å¸¸åŸ·è¡Œ
- [ ] Token è¨ˆæ•¸æ­£å¸¸å·¥ä½œ

### æ¸¬è©¦å®Œæˆå¾Œæª¢æŸ¥

- [ ] æ‰€æœ‰æ¸¬è©¦æ¨¡å¼ä¿®æ”¹éƒ½å·²æ¨™è¨˜æ¸…æ¥šï¼ˆ`â­ V8.0 æ¸¬è©¦æ¨¡å¼`ï¼‰
- [ ] åˆ‡æ›å›žæ­£å¼æ¨¡å¼ï¼ˆ`SYSTEM_TEST_MODE = false`ï¼‰å¾Œç³»çµ±æ­£å¸¸é‹ä½œ
- [ ] æ²’æœ‰éºæ¼ä»»ä½•ä¿®æ”¹
- [ ] æ¸¬è©¦æ•¸æ“šå·²æ¸…ç†æˆ–æ¨™è¨˜æ¸…æ¥š

---

## åˆ‡æ›å›žæ­£å¼æ¨¡å¼æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šé—œé–‰æ¸¬è©¦æ¨¡å¼

```javascript
// 02_M0_CONFIG.js
const SYSTEM_TEST_MODE = false;  // æ”¹å›ž false
```

### æ­¥é©Ÿ 2ï¼šæ¢å¾© Batch API

```javascript
// 02_M0_CONFIG.js
const GLOBAL_USE_BATCH_API = true;  // æ”¹å›ž true
```

### æ­¥é©Ÿ 3ï¼šé©—è­‰

- [ ] ç¢ºèªæ‰€æœ‰æ¸¬è©¦æ¨¡å¼ç›¸é—œçš„ä¿®æ”¹éƒ½å·²æ¨™è¨˜æ¸…æ¥š
- [ ] ç¢ºèªæ­£å¼æ¨¡å¼é‚è¼¯æœªè¢«å½±éŸ¿
- [ ] åŸ·è¡Œä¸€æ¬¡æ­£å¼æ¨¡å¼æ¸¬è©¦ï¼ˆä½¿ç”¨å°‘é‡è‚¡ç¥¨ï¼‰

---

## ç¸½çµ

é€™å€‹å¯¦ç¾æ–¹æ¡ˆï¼š
- âœ… **æœ€å°ä¿®æ”¹**ï¼šåªåœ¨ Config å’Œ Adapter å±¤åšä¿®æ”¹
- âœ… **ä¸æ”¹æž¶æ§‹**ï¼šä¸å½±éŸ¿ç¾æœ‰æž¶æ§‹å’Œ Prompt
- âœ… **æ˜“æ–¼åˆ‡æ›**ï¼šåªéœ€ä¿®æ”¹ä¸€å€‹é–‹é—œï¼ˆ`SYSTEM_TEST_MODE`ï¼‰
- âœ… **ç„¡éºæ¼**ï¼šæ‰€æœ‰ä¿®æ”¹éƒ½é›†ä¸­åœ¨å°‘æ•¸å¹¾å€‹æª”æ¡ˆä¸­ï¼Œå®¹æ˜“æª¢æŸ¥
- âœ… **æ¸¬è©¦æŒ‰éˆ•**ï¼šæ¯å€‹ Phase éƒ½æœ‰ç¨ç«‹çš„æ¸¬è©¦æŒ‰éˆ•
- âœ… **æ•¸æ“šé‡ç”¨**ï¼šå‰é¢çš„æµç¨‹è‹¥è·‘é€šæœ‰ç•™å­˜è³‡æ–™ï¼Œå¾Œé¢çš„æµç¨‹ç›´æŽ¥åƒå‰é¢ç•™å­˜çš„è³‡æ–™

**ä¸‹ä¸€æ­¥**ï¼š
1. ç¢ºèªæ¨¡åž‹åç¨±å’Œåƒ¹æ ¼
2. ç¢ºèª JSON Mode API åƒæ•¸æ ¼å¼
3. æª¢æŸ¥ 2026 å¹´è¡Œäº‹æ›†å’Œè²¡å ±æ•¸æ“š
4. é–‹å§‹å¯¦ç¾æ¸¬è©¦æ¨¡å¼
