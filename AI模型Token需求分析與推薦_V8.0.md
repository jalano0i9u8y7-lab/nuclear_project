# AI 模型 Token 需求分析與推薦 V8.0

**分析日期**：2026-01-17  
**目的**：分析所有階段 AI 分析者和審查者的 Token 需求，並推薦最適合的模型

---

## 📊 各階段 Token 需求估算

### 估算基礎
- **批次處理規模**：5-8 間公司（一次處理）
- **Prompt 長度**：極長（包含大量原則、範例、數據結構說明）
- **數據規模**：多資料源整合（財務數據、技術指標、籌碼數據、新聞、宏觀數據等）
- **歷史數據**：需要整合歷史快照、前幾期分析結果
- **輸出要求**：深度、全面、邏輯嚴謹的分析結論

---

## 🔍 各階段詳細分析

### 1. P0: 產業工程學分析

**執行者**：Claude Opus 4.5  
**審查者**：GPT-5.2

**輸入 Token 估算**：
- **Prompt 長度**：~8,000 tokens（包含產業工程學原則、範例、輸出格式）
- **用戶輸入**：~2,000 tokens（產業描述、主題方向）
- **歷史快照**：~3,000 tokens（前一期 P0 快照，用於比對）
- **產業鏈數據**：~5,000 tokens（上下游關係、供應鏈結構）
- **總輸入**：**~18,000 tokens**

**輸出 Token 估算**：
- **主題分析**：~6,000 tokens（每個主題 ~1,500 tokens，假設 4 個主題）
- **工程分析**：~4,000 tokens（物理/工程層面分析）
- **結構分析**：~4,000 tokens（制度/通道/流程層面分析）
- **總輸出**：**~14,000 tokens**

**批次處理影響**：P0 是針對整個產業面，不是每檔股票，所以不需要批次處理

**總 Token 需求**：**~32,000 tokens**

---

### 2. P0.7: 系統動力學分析

**執行者**：o3  
**審查者**：Claude Opus 4.5

**輸入 Token 估算**：
- **Prompt 長度**：~10,000 tokens（系統動力學原則、CLD 分析、時間序判斷）
- **P0 輸出**：~14,000 tokens（完整的 P0 分析結果）
- **歷史快照**：~3,000 tokens（前一期 P0.7 快照）
- **總輸入**：**~27,000 tokens**

**輸出 Token 估算**：
- **動態性問題定義**：~2,000 tokens
- **關鍵存量與流量**：~3,000 tokens
- **CLD 因果迴路**：~4,000 tokens（R 迴路和 B 迴路分析）
- **時間序位置判斷**：~2,000 tokens
- **槓桿點角色識別**：~2,000 tokens
- **總輸出**：**~13,000 tokens**

**批次處理影響**：P0.7 是針對整個產業面，不是每檔股票

**總 Token 需求**：**~40,000 tokens**

---

### 3. P1: 公司池篩選

**執行者**：Claude Sonnet 4.5  
**審查者**：GPT-5.2

**輸入 Token 估算**：
- **Prompt 長度**：~6,000 tokens（三層對位檢查原則、輸出格式）
- **P0 輸出**：~14,000 tokens
- **P0.7 輸出**：~13,000 tokens
- **候選公司列表**：~5,000 tokens（假設 20-30 家公司，每家公司 ~200 tokens）
- **總輸入**：**~38,000 tokens**

**輸出 Token 估算**：
- **Master Candidates**：~8,000 tokens（假設 5-8 家公司，每家公司 ~1,000 tokens）
- **Tracking Pool**：~4,000 tokens（假設 3-5 家公司）
- **Rejection Pool**：~3,000 tokens（假設 5-10 家公司，簡短說明）
- **總輸出**：**~15,000 tokens**

**批次處理影響**：P1 是針對整個產業面，但需要分析多間公司

**總 Token 需求**：**~53,000 tokens**

---

### 4. P2: 基本面財務分析（季度/月度）

**執行者**：Claude Sonnet 4.5  
**審查者**：GPT-5.2

**輸入 Token 估算（單間公司）**：
- **Prompt 長度**：~12,000 tokens（財務安全性 Gate、分層決策、同業比較原則、輸出格式）
- **財務數據**：~3,000 tokens（目標公司：15+ 財務指標 × 4 季度 = ~2,000 tokens，同業 3-5 家 × ~200 tokens = ~1,000 tokens）
- **P2 快照**：~4,000 tokens（前一期 P2 快照，包含所有公司的分層結果）
- **P1 輸出**：~15,000 tokens（Master Candidates 完整分析）
- **總輸入（單間）**：**~34,000 tokens**

**批次處理（5-8 間公司）**：
- **基礎 Prompt**：~12,000 tokens（共享）
- **財務數據**：~3,000 tokens × 8 = **~24,000 tokens**
- **P2 快照**：~4,000 tokens（共享）
- **P1 輸出**：~15,000 tokens（共享）
- **總輸入（批次）**：**~55,000 tokens**

**輸出 Token 估算（單間公司）**：
- **財務指標提取**：~1,500 tokens
- **Gate 檢查結果**：~500 tokens
- **分層決策**：~1,000 tokens（Tier、Tier_Reason）
- **同業比較**：~2,000 tokens（同業識別、相對位置分析）
- **總輸出（單間）**：**~5,000 tokens**

**批次處理（5-8 間公司）**：
- **總輸出（批次）**：~5,000 tokens × 8 = **~40,000 tokens**

**總 Token 需求（批次）**：**~95,000 tokens**

**關鍵挑戰**：
- ⚠️ **上下文隔離**：必須清楚分段每間公司的分析，不能交叉污染
- ⚠️ **長距離結構穩定性**：需要同時處理 5-8 間公司的財務數據和同業比較
- ⚠️ **同業數據整合**：每間公司需要 3-5 間同業的財務數據

---

### 5. P2.5: 機構級籌碼面分析

**執行者**：Claude Sonnet 4.5  
**審查者**：GPT-5.2

**輸入 Token 估算（單間公司）**：
- **Prompt 長度**：~8,000 tokens（機構持倉、內部人交易、期權活動、Dark Pool、對沖基金 Clone 分析原則）
- **籌碼數據**：~4,000 tokens（13F、內部人交易、期權數據、Dark Pool 數據）
- **對沖基金清單**：~2,000 tokens（Top 10 對沖基金清單和 Clone 評分邏輯）
- **總輸入（單間）**：**~14,000 tokens**

**批次處理（5-8 間公司）**：
- **基礎 Prompt**：~8,000 tokens（共享）
- **籌碼數據**：~4,000 tokens × 8 = **~32,000 tokens**
- **對沖基金清單**：~2,000 tokens（共享）
- **總輸入（批次）**：**~42,000 tokens**

**輸出 Token 估算（單間公司）**：
- **機構持倉分析**：~1,500 tokens
- **內部人交易分析**：~1,000 tokens
- **期權活動分析**：~1,500 tokens
- **Dark Pool 分析**：~1,000 tokens
- **對沖基金 Clone**：~1,000 tokens
- **Smart Money Score**：~500 tokens
- **總輸出（單間）**：**~6,500 tokens**

**批次處理（5-8 間公司）**：
- **總輸出（批次）**：~6,500 tokens × 8 = **~52,000 tokens**

**總 Token 需求（批次）**：**~94,000 tokens**

---

### 6. P3: 技術分析（機構級預測）

**執行者**：Claude Sonnet 4.5  
**審查者**：GPT-5.2

**輸入 Token 估算（單間公司）**：
- **Prompt 長度**：~15,000 tokens（機構級預測視角原則、Cat 分類、Buy/Stop 價格判斷、輸出格式）
- **P2 輸出**：~5,000 tokens（目標公司的財務指標、分層結果）
- **P2.5 輸出**：~6,500 tokens（目標公司的籌碼數據）
- **技術指標數據**：~3,000 tokens（OHLCV、RSI、MACD、ATR、MA 等，包含歷史數據）
- **歷史快照**：~4,000 tokens（前幾期 P3 快照，用於趨勢分析）
- **總輸入（單間）**：**~33,500 tokens**

**批次處理（5-8 間公司）**：
- **基礎 Prompt**：~15,000 tokens（共享）
- **P2 輸出**：~5,000 tokens × 8 = **~40,000 tokens**
- **P2.5 輸出**：~6,500 tokens × 8 = **~52,000 tokens**
- **技術指標數據**：~3,000 tokens × 8 = **~24,000 tokens**
- **歷史快照**：~4,000 tokens（共享）
- **總輸入（批次）**：**~135,000 tokens**

**輸出 Token 估算（單間公司）**：
- **Cat 分類與原因**：~1,500 tokens
- **機構級視角分析**：~2,000 tokens（主力行為解釋、意圖判斷）
- **未來預測**：~2,000 tokens
- **Buy/Stop 價格**：~1,000 tokens
- **總輸出（單間）**：**~6,500 tokens**

**批次處理（5-8 間公司）**：
- **總輸出（批次）**：~6,500 tokens × 8 = **~52,000 tokens**

**總 Token 需求（批次）**：**~187,000 tokens**

**關鍵挑戰**：
- ⚠️ **極高 Token 需求**：批次處理時超過 180K tokens
- ⚠️ **多資料源整合**：需要同時整合 P2、P2.5、技術指標、歷史快照
- ⚠️ **上下文隔離**：必須清楚分段每間公司的分析

---

### 7. P5 Weekly: 宏觀世界觀分析

**執行者**：Claude Sonnet 4.5  
**審查者**：GPT-5.2

**輸入 Token 估算**：
- **Prompt 長度**：~10,000 tokens（世界觀分析原則、Regime 分析、輸出格式）
- **本週新聞快照**：~15,000 tokens（所有新聞原子化數據）
- **市場數據**：~8,000 tokens（宏觀數據、Sector ETF、衍生品數據）
- **前幾期世界觀**：~6,000 tokens（前一個月 4 期的世界觀，用於對照）
- **總輸入**：**~39,000 tokens**

**輸出 Token 估算**：
- **整體世界觀**：~4,000 tokens
- **Regime 分析**：~2,000 tokens
- **關鍵主題**：~3,000 tokens
- **風險評估**：~2,000 tokens
- **U 調整建議**：~1,000 tokens
- **總輸出**：**~12,000 tokens**

**批次處理影響**：P5 Weekly 是全系統分析，不是針對單間公司

**總 Token 需求**：**~51,000 tokens**

---

### 8. P5 Weekly: 個股策略生成（批次處理）

**執行者**：Claude Sonnet 4.5  
**審查者**：GPT-5.2

**輸入 Token 估算（單間公司）**：
- **Prompt 長度**：~12,000 tokens（AI 動態權重決定、6 因子整合、Hitchhiking 監控、輸出格式）
- **Worldview**：~12,000 tokens（P5 Weekly 世界觀分析結果）
- **Event 數據**：~2,000 tokens（財報日、重大事件）
- **Technical 數據**：~3,000 tokens（P3 技術分析結果）
- **Fundamental 數據**：~5,000 tokens（P2 財務分析結果）
- **Institutional 數據**：~6,500 tokens（P2.5 籌碼數據）
- **Smart Money 數據**：~2,000 tokens（期權、Dark Pool）
- **總輸入（單間）**：**~42,500 tokens**

**批次處理（5-8 間公司）**：
- **基礎 Prompt**：~12,000 tokens（共享）
- **Worldview**：~12,000 tokens（共享）
- **Event 數據**：~2,000 tokens × 8 = **~16,000 tokens**
- **Technical 數據**：~3,000 tokens × 8 = **~24,000 tokens**
- **Fundamental 數據**：~5,000 tokens × 8 = **~40,000 tokens**
- **Institutional 數據**：~6,500 tokens × 8 = **~52,000 tokens**
- **Smart Money 數據**：~2,000 tokens × 8 = **~16,000 tokens**
- **總輸入（批次）**：**~172,000 tokens**

**輸出 Token 估算（單間公司）**：
- **策略建議**：~2,000 tokens
- **動態權重決定**：~1,500 tokens（6 個因子的權重 + 理由）
- **因子分析**：~2,000 tokens（各因子的詳細分析）
- **最終評分與推理**：~1,500 tokens
- **Hitchhiking 監控**：~1,000 tokens
- **總輸出（單間）**：**~8,000 tokens**

**批次處理（5-8 間公司）**：
- **總輸出（批次）**：~8,000 tokens × 8 = **~64,000 tokens**

**總 Token 需求（批次）**：**~236,000 tokens**

**關鍵挑戰**：
- ⚠️ **極高 Token 需求**：批次處理時超過 230K tokens
- ⚠️ **多資料源整合**：需要同時整合 6 個因子的數據
- ⚠️ **上下文隔離**：必須清楚分段每間公司的策略分析

---

### 9. P5 Monthly/Quarterly: 深度分析

**執行者**：Claude Sonnet 4.5  
**審查者**：GPT-5.2

**輸入 Token 估算**：
- **Prompt 長度**：~10,000 tokens（月度/季度分析原則）
- **歷史快照**：~20,000 tokens（前 3 個月/季度的所有快照）
- **市場數據**：~15,000 tokens（月度/季度累積的市場數據）
- **總輸入**：**~45,000 tokens**

**輸出 Token 估算**：
- **深度分析**：~15,000 tokens
- **趨勢判斷**：~5,000 tokens
- **總輸出**：**~20,000 tokens**

**總 Token 需求**：**~65,000 tokens**

---

## 📊 Token 需求總結表

| 階段 | 執行者 | 審查者 | 批次規模 | 輸入 Tokens | 輸出 Tokens | 總需求 Tokens |
|------|--------|--------|----------|-------------|-------------|---------------|
| **P0** | Opus 4.5 | GPT-5.2 | 1 產業面 | ~18,000 | ~14,000 | **~32,000** |
| **P0.7** | o3 | Opus 4.5 | 1 產業面 | ~27,000 | ~13,000 | **~40,000** |
| **P1** | Sonnet 4.5 | GPT-5.2 | 1 產業面 | ~38,000 | ~15,000 | **~53,000** |
| **P2** | Sonnet 4.5 | GPT-5.2 | **5-8 間公司** | ~55,000 | ~40,000 | **~95,000** |
| **P2.5** | Sonnet 4.5 | GPT-5.2 | **5-8 間公司** | ~42,000 | ~52,000 | **~94,000** |
| **P3** | Sonnet 4.5 | GPT-5.2 | **5-8 間公司** | ~135,000 | ~52,000 | **~187,000** |
| **P5 Weekly** | Sonnet 4.5 | GPT-5.2 | 全系統 | ~39,000 | ~12,000 | **~51,000** |
| **P5 Weekly 策略** | Sonnet 4.5 | GPT-5.2 | **5-8 間公司** | ~172,000 | ~64,000 | **~236,000** |
| **P5 Monthly** | Sonnet 4.5 | GPT-5.2 | 全系統 | ~45,000 | ~20,000 | **~65,000** |

---

## 🎯 模型 Context Window 限制（2025 年）

| 模型 | Context Window | 輸出限制 | 備註 |
|------|----------------|----------|------|
| **Claude Opus 4.5** | ~200,000 tokens | ~8,000 tokens | 深度推理能力強 |
| **Claude Sonnet 4.5** | ~200,000 tokens | ~8,000 tokens | 平衡性能與成本 |
| **GPT-5.2** | 未明確公開（推測 128K-200K） | ~8,000 tokens | 推理能力強 |
| **o3** | 未明確公開（推測 128K-200K） | ~8,000 tokens | 極強推理能力 |
| **Gemini 3.0 Pro** | **1,000,000 tokens** | ~64,000 tokens | 超長上下文 |
| **Gemini 2.5 Flash** | ~1,000,000 tokens | ~8,000 tokens | 快速且便宜 |

---

## ⚠️ 關鍵問題識別

### 1. 當前配置不足
- **當前 maxTokens: 8192** ❌ 嚴重不足
- **P3 批次處理**：需要 ~187,000 tokens（超過 200K 限制的 93%）
- **P5 Weekly 策略批次**：需要 ~236,000 tokens（超過 200K 限制）

### 2. 批次處理挑戰
- **上下文隔離**：必須清楚分段每間公司的分析，不能交叉污染
- **長距離結構穩定性**：需要同時處理 5-8 間公司的數據
- **輸出分段**：必須清楚標註每間公司的分析結論

### 3. 審查者需求
- **審查者 Token 需求**：約為執行者的 60-80%（需要閱讀執行者輸出 + 原始數據的一部分）
- **深度推理**：需要極強的邏輯推理能力找出錯誤

---

## 💡 模型推薦方案

### 方案 A：不考慮成本的首選

#### 分析者（執行者）推薦

| 階段 | 當前配置 | 首選推薦 | 理由 |
|------|----------|----------|------|
| **P0** | Opus 4.5 | **Claude Opus 4.5** ✅ | 200K context 足夠，深度推理能力強 |
| **P0.7** | o3 | **o3** ✅ | 200K context 足夠，極強推理能力 |
| **P1** | Sonnet 4.5 | **Claude Opus 4.5** ⭐ | 需要處理 P0+P0.7 輸出（~27K），Opus 更穩 |
| **P2** | Sonnet 4.5 | **Gemini 3.0 Pro** ⭐ | 批次處理需要 ~95K，Gemini 1M context 有餘裕 |
| **P2.5** | Sonnet 4.5 | **Gemini 3.0 Pro** ⭐ | 批次處理需要 ~94K，Gemini 1M context 有餘裕 |
| **P3** | Sonnet 4.5 | **Gemini 3.0 Pro** ⭐⭐ | 批次處理需要 ~187K，接近 200K 限制，Gemini 1M 更安全 |
| **P5 Weekly** | Sonnet 4.5 | **Claude Opus 4.5** ⭐ | 需要深度整合分析，Opus 推理能力更強 |
| **P5 Weekly 策略** | Sonnet 4.5 | **Gemini 3.0 Pro** ⭐⭐ | 批次處理需要 ~236K，超過 200K，必須用 Gemini |
| **P5 Monthly** | Sonnet 4.5 | **Claude Opus 4.5** ⭐ | 需要深度分析，Opus 更適合 |

#### 審查者推薦

| 階段 | 當前配置 | 首選推薦 | 理由 |
|------|----------|----------|------|
| **P0** | GPT-5.2 | **Claude Opus 4.5** ⭐ | 需要深度邏輯審查，Opus 推理能力最強 |
| **P0.7** | Opus 4.5 | **Claude Opus 4.5** ✅ | 當前配置已是最佳 |
| **P1** | GPT-5.2 | **Claude Opus 4.5** ⭐ | 需要深度邏輯審查 |
| **P2** | GPT-5.2 | **Claude Opus 4.5** ⭐ | 需要深度邏輯審查，但 Token 需求較低 |
| **P2.5** | GPT-5.2 | **Claude Opus 4.5** ⭐ | 需要深度邏輯審查 |
| **P3** | GPT-5.2 | **Gemini 3.0 Pro** ⭐ | 批次處理時 Token 需求高，需要 1M context |
| **P5 Weekly** | GPT-5.2 | **Claude Opus 4.5** ⭐ | 需要深度邏輯審查 |
| **P5 Weekly 策略** | GPT-5.2 | **Gemini 3.0 Pro** ⭐⭐ | 批次處理時 Token 需求極高，必須用 Gemini |
| **P5 Monthly** | GPT-5.2 | **Claude Opus 4.5** ⭐ | 需要深度邏輯審查 |

---

### 方案 B：考慮成本後的次選

#### 分析者（執行者）推薦

| 階段 | 當前配置 | 次選推薦 | 理由 |
|------|----------|----------|------|
| **P0** | Opus 4.5 | **Claude Opus 4.5** ✅ | 成本可接受，深度推理必需 |
| **P0.7** | o3 | **o3** ✅ | 當前配置已是最佳 |
| **P1** | Sonnet 4.5 | **Claude Sonnet 4.5** ✅ | 成本較低，200K context 足夠 |
| **P2** | Sonnet 4.5 | **Gemini 3.0 Pro** ⭐ | 批次處理需要 ~95K，Sonnet 200K 勉強夠，但 Gemini 更安全且便宜 |
| **P2.5** | Sonnet 4.5 | **Gemini 3.0 Pro** ⭐ | 批次處理需要 ~94K，Gemini 更安全且便宜 |
| **P3** | Sonnet 4.5 | **Gemini 3.0 Pro** ⭐⭐ | 批次處理需要 ~187K，Sonnet 200K 接近極限，Gemini 必需 |
| **P5 Weekly** | Sonnet 4.5 | **Claude Sonnet 4.5** ✅ | 成本較低，200K context 足夠 |
| **P5 Weekly 策略** | Sonnet 4.5 | **Gemini 3.0 Pro** ⭐⭐ | 批次處理需要 ~236K，超過 200K，必須用 Gemini |
| **P5 Monthly** | Sonnet 4.5 | **Claude Sonnet 4.5** ✅ | 成本較低，200K context 足夠 |

#### 審查者推薦

| 階段 | 當前配置 | 次選推薦 | 理由 |
|------|----------|----------|------|
| **P0** | GPT-5.2 | **GPT-5.2** ✅ | 成本較低，推理能力足夠 |
| **P0.7** | Opus 4.5 | **Claude Opus 4.5** ✅ | 當前配置已是最佳 |
| **P1** | GPT-5.2 | **GPT-5.2** ✅ | 成本較低，推理能力足夠 |
| **P2** | GPT-5.2 | **GPT-5.2** ✅ | 成本較低，推理能力足夠 |
| **P2.5** | GPT-5.2 | **GPT-5.2** ✅ | 成本較低，推理能力足夠 |
| **P3** | GPT-5.2 | **Gemini 3.0 Pro** ⭐ | 批次處理時 Token 需求高，Gemini 更便宜 |
| **P5 Weekly** | GPT-5.2 | **GPT-5.2** ✅ | 成本較低，推理能力足夠 |
| **P5 Weekly 策略** | GPT-5.2 | **Gemini 3.0 Pro** ⭐⭐ | 批次處理時 Token 需求極高，Gemini 必需且便宜 |
| **P5 Monthly** | GPT-5.2 | **GPT-5.2** ✅ | 成本較低，推理能力足夠 |

---

## 🎯 關鍵發現與建議

### 1. 必須升級 Context Window 配置

**當前問題**：
- 所有模型配置為 `maxTokens: 8192` ❌
- 批次處理時實際需要 95K-236K tokens

**建議修正**：
```javascript
const M0_MODEL_CONFIG = {
  OPUS: {
    model: "claude-opus-4-5-20251101",
    maxTokens: 200000,  // ⭐ 升級到 200K
    maxOutputTokens: 8000  // 輸出限制
  },
  SONNET: {
    model: "claude-sonnet-4-5-20250929",
    maxTokens: 200000,  // ⭐ 升級到 200K
    maxOutputTokens: 8000
  },
  GPT: {
    model: "gpt-5.2",
    maxTokens: 200000,  // ⭐ 升級到 200K（如果支援）
    maxOutputTokens: 8000
  },
  GEMINI_PRO: {
    model: "gemini-3-pro-preview",
    maxTokens: 1000000,  // ⭐ 升級到 1M
    maxOutputTokens: 64000
  }
};
```

### 2. 批次處理必須使用 Gemini 3.0 Pro

**關鍵階段**：
- **P3 批次處理**：~187,000 tokens（接近 200K 限制）
- **P5 Weekly 策略批次**：~236,000 tokens（超過 200K 限制）

**建議**：
- P3 和 P5 Weekly 策略的批次處理**必須使用 Gemini 3.0 Pro**
- 其他階段可以使用 Claude Sonnet 4.5 或 Opus 4.5

### 3. 上下文隔離策略

**建議實現**：
1. **明確分段標記**：在 Prompt 中使用明確的標記分隔每間公司
   ```
   === COMPANY 1: AAPL ===
   [數據和分析]
   
   === COMPANY 2: MSFT ===
   [數據和分析]
   ```

2. **輸出格式要求**：要求 AI 在輸出中明確標註每間公司的分析結論
   ```json
   {
     "company_1": { ... },
     "company_2": { ... }
   }
   ```

3. **後處理驗證**：程式驗證輸出中每間公司的分析是否完整且獨立

---

## 📊 最終推薦配置

### 方案 A：不考慮成本（最佳性能）

| 階段 | 執行者 | 審查者 | Context Window 需求 |
|------|--------|--------|---------------------|
| **P0** | Opus 4.5 | Opus 4.5 | 32K ✅ |
| **P0.7** | o3 | Opus 4.5 | 40K ✅ |
| **P1** | Opus 4.5 | Opus 4.5 | 53K ✅ |
| **P2** | Gemini 3.0 Pro | Opus 4.5 | 95K ⭐ |
| **P2.5** | Gemini 3.0 Pro | Opus 4.5 | 94K ⭐ |
| **P3** | Gemini 3.0 Pro | Gemini 3.0 Pro | 187K ⭐⭐ |
| **P5 Weekly** | Opus 4.5 | Opus 4.5 | 51K ✅ |
| **P5 Weekly 策略** | Gemini 3.0 Pro | Gemini 3.0 Pro | 236K ⭐⭐ |
| **P5 Monthly** | Opus 4.5 | Opus 4.5 | 65K ✅ |

### 方案 B：考慮成本（平衡方案）

| 階段 | 執行者 | 審查者 | Context Window 需求 |
|------|--------|--------|---------------------|
| **P0** | Opus 4.5 | GPT-5.2 | 32K ✅ |
| **P0.7** | o3 | Opus 4.5 | 40K ✅ |
| **P1** | Sonnet 4.5 | GPT-5.2 | 53K ✅ |
| **P2** | Gemini 3.0 Pro | GPT-5.2 | 95K ⭐ |
| **P2.5** | Gemini 3.0 Pro | GPT-5.2 | 94K ⭐ |
| **P3** | Gemini 3.0 Pro | Gemini 3.0 Pro | 187K ⭐⭐ |
| **P5 Weekly** | Sonnet 4.5 | GPT-5.2 | 51K ✅ |
| **P5 Weekly 策略** | Gemini 3.0 Pro | Gemini 3.0 Pro | 236K ⭐⭐ |
| **P5 Monthly** | Sonnet 4.5 | GPT-5.2 | 65K ✅ |

---

## ⚠️ 重要注意事項

### 1. Gemini 3.0 Pro 的實際 Context Window

根據搜尋結果，Gemini 3.0 Pro 的實際可用 context 可能因平台而異：
- **API 模式**：可達 1,000,000 tokens
- **實際使用**：建議預留 20% 餘裕，實際可用約 800,000 tokens

### 2. 批次處理的風險

即使使用 Gemini 3.0 Pro，批次處理 5-8 間公司時：
- **Token 需求**：236K tokens（約佔 1M 的 24%）
- **上下文隔離**：必須在 Prompt 中明確要求分段輸出
- **建議**：如果發現上下文污染，考慮減少批次規模（5 間而非 8 間）

### 3. 輸出 Token 限制

- **Claude 系列**：輸出限制約 8,000 tokens
- **Gemini 3.0 Pro**：輸出限制約 64,000 tokens
- **批次處理時**：需要確保輸出限制足夠（P5 Weekly 策略批次需要 ~64K 輸出）

---

## 📝 實施建議

### 立即行動

1. **升級 maxTokens 配置**：
   - Opus/Sonnet：200,000 tokens
   - Gemini 3.0 Pro：1,000,000 tokens
   - GPT-5.2：200,000 tokens（如果支援）

2. **調整批次處理模型**：
   - P3 批次處理：改用 Gemini 3.0 Pro
   - P5 Weekly 策略批次：改用 Gemini 3.0 Pro

3. **增強 Prompt 分段要求**：
   - 在 Prompt 中明確要求分段輸出
   - 要求每間公司的分析獨立且完整

### 後續優化

1. **監控實際 Token 使用量**：
   - 記錄每次調用的實際 Token 使用量
   - 根據實際使用量調整配置

2. **動態批次規模調整**：
   - 根據 Token 使用量動態調整批次規模
   - 如果接近限制，減少批次規模

3. **輸出驗證機制**：
   - 驗證每間公司的分析是否完整
   - 檢測是否有上下文污染

---

**文檔版本**：V1.0  
**最後更新**：2026-01-17  
**狀態**：✅ 分析完成，待實施
