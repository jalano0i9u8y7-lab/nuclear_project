# 成本估算 V8.0（最終版 - 完整任務清單與多規模模擬）

**更新日期**：2026-01-17  
**批次規模調整**：⚠️ **V8.0 修正** - P3/P5 Weekly 批次大小改為 **3 家/批**（避免 Context Window Overflow）  
**模型配置**：方案 B（考慮成本，平衡方案）  
**批次處理狀態**：✅ P2、P2.5、P3 批次處理已全部實現  
**Token 追蹤功能**：✅ M0 層面 Token 追蹤已實現  
**Prompt 優化**：✅ 已添加「不要廢話」指令（節省 Token 成本）

---

## 📊 執行摘要

本文檔基於新的批次規模（5-6 家/批）和方案 B 模型配置，重新估算系統正式上線後的月度運營成本。

**假設規模**：
- **產業面數量**：10 個
- **每產業面股票數量**：平均 8 檔（80 檔總股票池）
- **執行頻率**：按照系統設計的 Phase 執行頻率

---

## 💰 AI 模型價格表

**⚠️ 重要說明**：
- **實際定價**：AI 模型廠商的官方定價為「每 1M tokens」（每百萬 tokens）
- **程式碼單位**：為方便計算，程式碼中使用「每 1K tokens」的價格（實際定價 ÷ 1000）
- **轉換公式**：程式碼價格 = 實際定價 / 1000

| 模型 | 實際定價（$/1M） | 程式碼使用（$/1K） | Context Window | 備註 |
|------|----------------|----------------|----------------|------|
| | **Input** | **Output** | **Input** | **Output** | |
| **Claude Opus 4.5** | 5.0 | 25.0 | 0.005 | 0.025 | 200K | 核彈級 Analyzer |
| **Claude Sonnet 4.5** | 3.0 | 15.0 | 0.003 | 0.015 | 200K | 高品質中階 |
| **GPT-5.2** | 1.75 | 14.0 | 0.00175 | 0.014 | 400K | 長文理性派 |
| **o3** | 2.0 | 8.0 | 0.002 | 0.008 | 200K | 推理 CP 值王 |
| **Gemini 3.0 Pro** | 2.0 (≤200K) / 4.0 (>200K) | 12.0 (≤200K) / 18.0 (>200K) | 0.002 / 0.004 | 0.012 / 0.018 | 1M | 原始文件去雜訊 |
| **Gemini 2.5 Flash** | 0.1 | 0.4 | 0.0001 | 0.0004 | 128K | 大量前處理 |

---

## 📋 各階段工作任務詳細清單

### 1. 產業面級別任務（非批次處理）

#### P0：產業工程分析
- **工作任務**：識別產業主題、子主題、技術節點、公司池
- **執行頻率**：季度（每 3 個月一次）
- **執行者模型**：Claude Opus 4.5
- **審查者模型**：GPT-5.2
- **單次輸入 Tokens**：18K
- **單次輸出 Tokens**：14K
- **單次成本**：
  - 執行者：18K × $0.005 + 14K × $0.025 = $0.44
  - 審查者：18K × $0.00175 + 14K × $0.014 = $0.228
  - **總計：$0.668/次**

#### P0.7：系統動力學分析
- **工作任務**：分析時間位置、槓桿角色、循環主導性
- **執行頻率**：季度（P0 變更時觸發，假設 50% 觸發率）
- **執行者模型**：o3
- **審查者模型**：Claude Opus 4.5
- **單次輸入 Tokens**：27K
- **單次輸出 Tokens**：13K
- **單次成本**：
  - 執行者：27K × $0.002 + 13K × $0.008 = $0.158
  - 審查者：27K × $0.005 + 13K × $0.025 = $0.37
  - **總計：$0.528/次**

#### P1：公司池篩選
- **工作任務**：護城河分析、重估狀態判斷、三池歸屬（Master/Tracking/Rejection）
- **執行頻率**：季度（每 3 個月一次）
- **執行者模型**：Claude Sonnet 4.5
- **審查者模型**：GPT-5.2
- **單次輸入 Tokens**：38K
- **單次輸出 Tokens**：15K
- **單次成本**：
  - 執行者：38K × $0.003 + 15K × $0.015 = $0.339
  - 審查者：38K × $0.00175 + 15K × $0.014 = $0.277
  - **總計：$0.616/次**

#### P5 Weekly：週度市場分析
- **工作任務**：全系統週度市場分析（產業面級別）
- **執行頻率**：週度（每週一次）
- **執行者模型**：Claude Sonnet 4.5
- **審查者模型**：GPT-5.2
- **單次輸入 Tokens**：39K
- **單次輸出 Tokens**：12K
- **單次成本**：
  - 執行者：39K × $0.003 + 12K × $0.015 = $0.297
  - 審查者：39K × $0.00175 + 12K × $0.014 = $0.236
  - **總計：$0.533/次**

#### P5 Monthly：月度市場分析
- **工作任務**：全系統月度市場分析（產業面級別）
- **執行頻率**：月度（每月一次）
- **執行者模型**：Claude Sonnet 4.5
- **審查者模型**：GPT-5.2
- **單次輸入 Tokens**：45K
- **單次輸出 Tokens**：20K
- **單次成本**：
  - 執行者：45K × $0.003 + 20K × $0.015 = $0.435
  - 審查者：45K × $0.00175 + 20K × $0.014 = $0.359
  - **總計：$0.794/次**

---

### 2. 股票級別任務（批次處理）

#### P2：基本面分析
- **工作任務**：財務安全性 Gate 檢查、分層決策（CORE/STABLE_SWING/AGGRESSIVE/OPPORTUNISTIC）、同業比較
- **執行頻率**：
  - **P2 季度**：季度（每 3 個月一次）
  - **P2 月度**：月度（每月一次）
- **執行者模型**：Claude Sonnet 4.5
- **審查者模型**：GPT-5.2
- **批次大小**：6 家/批
- **批次輸入 Tokens**：55K（6 家）
- **批次輸出 Tokens**：40K（6 家）
- **批次總成本**：
  - 執行者：55K × $0.003 + 40K × $0.015 = $0.765
  - 審查者：55K × $0.00175 + 40K × $0.014 = $0.656
  - **批次總計：$1.421**
- **每檔股票成本**：$1.421 ÷ 6 = **$0.237/檔**
- **批次處理狀態**：✅ 已實現

#### P2.5：機構級籌碼面分析
- **工作任務**：13F 持倉變化、內部人交易、期權活動、Dark Pool 活動、對沖基金 Clone 分析
- **執行頻率**：
  - **P2.5 季度**：季度（每 3 個月一次）
  - **P2.5 月度**：月度（每月一次）
- **執行者模型**：Claude Sonnet 4.5
- **審查者模型**：GPT-5.2
- **批次大小**：6 家/批
- **批次輸入 Tokens**：42K（6 家）
- **批次輸出 Tokens**：52K（6 家）
- **批次總成本**：
  - 執行者：42K × $0.003 + 52K × $0.015 = $0.906
  - 審查者：42K × $0.00175 + 52K × $0.014 = $0.802
  - **批次總計：$1.708**
- **每檔股票成本**：$1.708 ÷ 6 = **$0.285/檔**
- **批次處理狀態**：✅ 已實現

#### P3：技術面分析
- **工作任務**：Cat 分類、主力行為分析、技術面詳情、掛單建議
- **執行頻率**：
  - **P3 週度**：週度（只處理有變動的股票，假設每週 20% 有變動）
  - **P3 月度**：月度（每月一次，處理所有股票）
- **執行者模型**：Claude Sonnet 4.5
- **審查者模型**：GPT-5.2
- **批次大小**：3 家/批 ⚠️ **V8.0 修正：避免 Context Window Overflow 風險**
  - 原設定 5 家/批（156K 輸入 + 52K 輸出 = 208K > 200K 限制）會導致 Overflow
  - 修正為 3 家/批後，約 94K 輸入 + 31K 輸出 = 125K，安全邊際充足
- **批次輸入 Tokens**：94K（3 家）
- **批次輸出 Tokens**：31K（3 家）
- **批次總成本**：
  - 執行者：94K × $0.003 + 31K × $0.015 = $0.282 + $0.465 = $0.747
  - 審查者：94K × $0.00175 + 31K × $0.014 = $0.165 + $0.434 = $0.599
  - **批次總計：$1.346**
- **每檔股票成本**：$1.346 ÷ 3 = **$0.449/檔**（與原成本幾乎持平）
- **批次處理狀態**：✅ 已實現

#### P5 Weekly 策略：個股週度策略
- **工作任務**：每檔股票的週度投資策略（INCREASE/DECREASE/HOLD/EXIT）、動態權重分配、掛單調整
- **執行頻率**：週度（每週一次，處理所有股票）
- **執行者模型**：Claude Sonnet 4.5
- **審查者模型**：GPT-5.2
- **批次大小**：3 家/批 ⚠️ **V8.0 修正：避免 Context Window Overflow 風險**
  - 原設定 6 家/批（177K 輸入 + 64K 輸出 = 241K > 200K 限制）會導致 Overflow
  - 修正為 3 家/批後，約 89K 輸入 + 32K 輸出 = 121K，安全邊際充足
- **批次輸入 Tokens**：89K（3 家）
- **批次輸出 Tokens**：32K（3 家）
- **批次總成本**：
  - 執行者：89K × $0.003 + 32K × $0.015 = $0.267 + $0.48 = $0.747
  - 審查者：89K × $0.00175 + 32K × $0.014 = $0.156 + $0.448 = $0.604
  - **批次總計：$1.351**
- **每檔股票成本**：$1.351 ÷ 3 = **$0.450/檔**（與原成本持平）
- **批次處理狀態**：✅ 已實現

---

### 3. P5 Daily：新聞整理與快照留存（分層執行）

- **工作任務**：新聞清洗、多語去重、分類、簡單快照留存（無深度推理）
- **執行頻率**：分層執行（根據 P4 分層結果）
  - **CORE**：每日
  - **STABLE_SWING**：週度
  - **AGGRESSIVE**：週度
  - **OPPORTUNISTIC**：月度
- **執行者模型**：Gemini 2.5 Flash（清洗）+ Gemini 3.0 Pro（去重+分類+快照）
- **審查者模型**：無（簡單整理任務，無需審查）
- **單次成本**（每檔股票，假設每天 10 筆新聞，每批 20 筆）：
  - Gemini Flash 清洗：20 筆 × 0.5K tokens × $0.0001 = $0.001
  - Gemini Pro 去重+分類+快照：20 筆 × 2K tokens × $0.002 = $0.004
  - **總計：$0.005/檔/次**
- **批次處理狀態**：✅ 已實現（無批次，單檔處理）

---

## 📊 月度成本計算（按規模模擬）

### 規模 1：50 檔股票

**假設分層比例**（基於 P4 分層）：
- CORE：12 檔（24%）
- STABLE_SWING：16 檔（32%）
- AGGRESSIVE：12 檔（24%）
- OPPORTUNISTIC：10 檔（20%）

#### 產業面級別成本（固定，與股票數量無關）

| 任務 | 執行頻率 | 執行次數/月 | 單次成本 | 月度成本（USD） |
|------|---------|------------|---------|----------------|
| **P0** | 季度 | 10 個產業面 × 0.33 = 3.33 次 | $0.668 | $2.22 |
| **P0.7** | 季度（50% 觸發） | 10 個產業面 × 0.33 × 0.5 = 1.67 次 | $0.528 | $0.88 |
| **P1** | 季度 | 10 個產業面 × 0.33 = 3.33 次 | $0.616 | $2.05 |
| **P5 Weekly** | 週度 | 1 次（全系統） | $0.533 | $2.13 |
| **P5 Monthly** | 月度 | 1 次（全系統） | $0.794 | $0.79 |

**產業面級別小計**：**$8.07/月**

---

#### 股票級別成本（50 檔）

##### P2 系列

| 任務 | 執行頻率 | 執行次數/月 | 每檔成本 | 月度成本（USD） |
|------|---------|------------|---------|----------------|
| **P2 季度** | 季度 | 50 檔 × 0.33 = 16.67 次 | $0.237 | $3.95 |
| **P2 月度** | 月度 | 50 檔 × 1 = 50 次 | $0.237 | $11.85 |

**P2 系列小計**：**$15.80/月**

**批次計算**：
- 50 檔 ÷ 6 家/批 = 8.33 批次（向上取整為 9 批次）
- P2 季度：9 批次 × 0.33 = 3 批次/月 × $1.421 = $4.26
- P2 月度：9 批次 × 1 = 9 批次/月 × $1.421 = $12.79
- **總計：$17.05/月**（與上述計算略有差異，因批次向上取整）

---

##### P2.5 系列

| 任務 | 執行頻率 | 執行次數/月 | 每檔成本 | 月度成本（USD） |
|------|---------|------------|---------|----------------|
| **P2.5 季度** | 季度 | 50 檔 × 0.33 = 16.67 次 | $0.285 | $4.75 |
| **P2.5 月度** | 月度 | 50 檔 × 1 = 50 次 | $0.285 | $14.25 |

**P2.5 系列小計**：**$19.00/月**

**批次計算**：
- 50 檔 ÷ 6 家/批 = 8.33 批次（向上取整為 9 批次）
- P2.5 季度：9 批次 × 0.33 = 3 批次/月 × $1.708 = $5.12
- P2.5 月度：9 批次 × 1 = 9 批次/月 × $1.708 = $15.37
- **總計：$20.49/月**

---

##### P3 系列

**批次計算**（P3 週度只處理有變動的股票）⚠️ **V8.0 修正：批次大小改為 3 家/批**：
- 假設每週 20% 股票有變動：50 檔 × 20% = 10 檔/週
- 10 檔 ÷ 3 家/批 = 3.33 批次（向上取整為 4 批次/週）
- P3 週度：4 批次 × 4 週 = 16 批次/月 × $1.346 = $21.54
- P3 月度：50 檔 ÷ 3 家/批 = 16.67 批次（向上取整為 17 批次/月） × $1.346 = $22.88

**P3 系列小計**：**$44.42/月**（修正：批次大小調整，但每檔成本幾乎持平）

---

##### P5 Weekly 策略

**批次計算** ⚠️ **V8.0 修正：批次大小改為 3 家/批**：
- 50 檔 ÷ 3 家/批 = 16.67 批次（向上取整為 17 批次）
- 17 批次 × 4 週 = 68 批次/月 × $1.351 = $91.87

**P5 Weekly 策略小計**：**$91.87/月**（修正：批次大小調整，但每檔成本持平）

---

##### P5 Daily（分層執行）

| Tier | 股票數 | 執行頻率 | 執行次數/月 | 單次成本 | 月度成本（USD） |
|------|--------|---------|------------|---------|----------------|
| **CORE** | 12 | 每日 | 12 × 30 = 360 | $0.005 | $1.80 |
| **STABLE_SWING** | 16 | 週度 | 16 × 4 = 64 | $0.005 | $0.32 |
| **AGGRESSIVE** | 12 | 週度 | 12 × 4 = 48 | $0.005 | $0.24 |
| **OPPORTUNISTIC** | 10 | 月度 | 10 × 1 = 10 | $0.005 | $0.05 |

**P5 Daily 小計**：**$2.41/月**

---

#### 其他成本（固定）

| 項目 | 月度成本（USD） | 說明 |
|------|----------------|------|
| **Gemini 原始文件去雜訊** | $10.00 | P0/P1 使用（估算） |
| **數據收集** | $50.00 | CSE 搜尋、API 調用等 |
| **備用預算** | $50.00 | 應急、測試、優化 |

**其他成本小計**：**$110.00/月**

---

#### 50 檔股票月度總成本

| 類別 | 月度成本（USD） | 佔比 |
|------|----------------|------|
| **產業面級別** | $8.07 | 3.3% |
| **P2 系列** | $15.80 | 6.5% |
| **P2.5 系列** | $19.00 | 7.8% |
| **P3 系列** | $44.42 | 15.2% | ⚠️ V8.0 修正：3 家/批 |
| **P5 Weekly 策略** | $91.87 | 31.5% | ⚠️ V8.0 修正：3 家/批 |
| **P5 Daily** | $2.41 | 0.8% | 新聞整理與快照 |
| **其他成本** | $110.00 | 37.7% | 數據收集、備用預算 |
| **總計** | **$291.57/月** | 100% | - |

**年度總計**：**$3,498.84/年**

---

### 規模 2：80 檔股票（推薦規模）

**假設分層比例**（基於 P4 分層）：
- CORE：20 檔（25%）
- STABLE_SWING：25 檔（31%）
- AGGRESSIVE：20 檔（25%）
- OPPORTUNISTIC：15 檔（19%）

#### 產業面級別成本（固定）

**產業面級別小計**：**$8.07/月**（與 50 檔相同）

---

#### 股票級別成本（80 檔）

##### P2 系列

| 任務 | 執行頻率 | 執行次數/月 | 每檔成本 | 月度成本（USD） |
|------|---------|------------|---------|----------------|
| **P2 季度** | 季度 | 80 檔 × 0.33 = 26.67 次 | $0.237 | $6.32 |
| **P2 月度** | 月度 | 80 檔 × 1 = 80 次 | $0.237 | $18.96 |

**P2 系列小計**：**$25.28/月**

**批次計算**：
- 80 檔 ÷ 6 家/批 = 13.33 批次（向上取整為 14 批次）
- P2 季度：14 批次 × 0.33 = 5 批次/月 × $1.421 = $7.11
- P2 月度：14 批次 × 1 = 14 批次/月 × $1.421 = $19.89
- **總計：$27.00/月**

---

##### P2.5 系列

| 任務 | 執行頻率 | 執行次數/月 | 每檔成本 | 月度成本（USD） |
|------|---------|------------|---------|----------------|
| **P2.5 季度** | 季度 | 80 檔 × 0.33 = 26.67 次 | $0.285 | $7.60 |
| **P2.5 月度** | 月度 | 80 檔 × 1 = 80 次 | $0.285 | $22.80 |

**P2.5 系列小計**：**$30.40/月**

**批次計算**：
- 80 檔 ÷ 6 家/批 = 13.33 批次（向上取整為 14 批次）
- P2.5 季度：14 批次 × 0.33 = 5 批次/月 × $1.708 = $8.54
- P2.5 月度：14 批次 × 1 = 14 批次/月 × $1.708 = $23.91
- **總計：$32.45/月**

---

##### P3 系列

**批次計算**（P3 週度只處理有變動的股票）⚠️ **V8.0 修正：批次大小改為 3 家/批**：
- 假設每週 20% 股票有變動：80 檔 × 20% = 16 檔/週
- 16 檔 ÷ 3 家/批 = 5.33 批次（向上取整為 6 批次/週）
- P3 週度：6 批次 × 4 週 = 24 批次/月 × $1.346 = $32.30
- P3 月度：80 檔 ÷ 3 家/批 = 26.67 批次（向上取整為 27 批次/月） × $1.346 = $36.34

**P3 系列小計**：**$68.64/月**（修正：批次大小調整，但每檔成本幾乎持平）

---

##### P5 Weekly 策略

**批次計算** ⚠️ **V8.0 修正：批次大小改為 3 家/批**：
- 80 檔 ÷ 3 家/批 = 26.67 批次（向上取整為 27 批次）
- 27 批次 × 4 週 = 108 批次/月 × $1.351 = $145.91

**P5 Weekly 策略小計**：**$145.91/月**（修正：批次大小調整，但每檔成本持平）

---

##### P5 Daily（分層執行）

| Tier | 股票數 | 執行頻率 | 執行次數/月 | 單次成本 | 月度成本（USD） |
|------|--------|---------|------------|---------|----------------|
| **CORE** | 20 | 每日 | 20 × 30 = 600 | $0.005 | $3.00 |
| **STABLE_SWING** | 25 | 週度 | 25 × 4 = 100 | $0.005 | $0.50 |
| **AGGRESSIVE** | 20 | 週度 | 20 × 4 = 80 | $0.005 | $0.40 |
| **OPPORTUNISTIC** | 15 | 月度 | 15 × 1 = 15 | $0.005 | $0.08 |

**P5 Daily 小計**：**$3.98/月**

---

#### 其他成本（固定）

**其他成本小計**：**$110.00/月**

---

#### 80 檔股票月度總成本

| 類別 | 月度成本（USD） | 佔比 |
|------|----------------|------|
| **產業面級別** | $8.07 | 2.0% |
| **P2 系列** | $25.28 | 6.2% |
| **P2.5 系列** | $30.40 | 7.5% |
| **P3 系列** | $68.64 | 17.0% |
| **P5 Weekly 策略** | $145.91 | 36.1% |
| **P5 Daily** | $3.98 | 1.0% |
| **其他成本** | $110.00 | 27.2% |
| **總計** | **$392.28/月** | 100% |

**年度總計**：**$4,707.36/年**

**⚠️ V8.0 批次大小修正說明**：
- **P3** 和 **P5 Weekly** 批次大小從 5-6 家/批降低到 **3 家/批**
- **原因**：避免 Context Window Overflow（輸入+輸出超過 200K 限制）
- **成本影響**：每檔股票成本幾乎持平（$0.450/檔），總成本略微降低（因批次增加但單批成本降低）

---

### 規模 3：100 檔股票

**假設分層比例**（基於 P4 分層）：
- CORE：25 檔（25%）
- STABLE_SWING：31 檔（31%）
- AGGRESSIVE：25 檔（25%）
- OPPORTUNISTIC：19 檔（19%）

#### 產業面級別成本（固定）

**產業面級別小計**：**$8.07/月**（與 50/80 檔相同）

---

#### 股票級別成本（100 檔）

##### P2 系列

| 任務 | 執行頻率 | 執行次數/月 | 每檔成本 | 月度成本（USD） |
|------|---------|------------|---------|----------------|
| **P2 季度** | 季度 | 100 檔 × 0.33 = 33.33 次 | $0.237 | $7.90 |
| **P2 月度** | 月度 | 100 檔 × 1 = 100 次 | $0.237 | $23.70 |

**P2 系列小計**：**$31.60/月**

**批次計算**：
- 100 檔 ÷ 6 家/批 = 16.67 批次（向上取整為 17 批次）
- P2 季度：17 批次 × 0.33 = 6 批次/月 × $1.421 = $8.53
- P2 月度：17 批次 × 1 = 17 批次/月 × $1.421 = $24.16
- **總計：$32.69/月**

---

##### P2.5 系列

| 任務 | 執行頻率 | 執行次數/月 | 每檔成本 | 月度成本（USD） |
|------|---------|------------|---------|----------------|
| **P2.5 季度** | 季度 | 100 檔 × 0.33 = 33.33 次 | $0.285 | $9.50 |
| **P2.5 月度** | 月度 | 100 檔 × 1 = 100 次 | $0.285 | $28.50 |

**P2.5 系列小計**：**$38.00/月**

**批次計算**：
- 100 檔 ÷ 6 家/批 = 16.67 批次（向上取整為 17 批次）
- P2.5 季度：17 批次 × 0.33 = 6 批次/月 × $1.708 = $10.25
- P2.5 月度：17 批次 × 1 = 17 批次/月 × $1.708 = $29.04
- **總計：$39.29/月**

---

##### P3 系列

**批次計算**（P3 週度只處理有變動的股票）⚠️ **V8.0 修正：批次大小改為 3 家/批**：
- 假設每週 20% 股票有變動：100 檔 × 20% = 20 檔/週
- 20 檔 ÷ 3 家/批 = 6.67 批次（向上取整為 7 批次/週）
- P3 週度：7 批次 × 4 週 = 28 批次/月 × $1.346 = $37.69
- P3 月度：100 檔 ÷ 3 家/批 = 33.33 批次（向上取整為 34 批次/月） × $1.346 = $45.76

**P3 系列小計**：**$83.45/月**（修正：批次大小調整，但每檔成本幾乎持平）

---

##### P5 Weekly 策略

**批次計算** ⚠️ **V8.0 修正：批次大小改為 3 家/批**：
- 100 檔 ÷ 3 家/批 = 33.33 批次（向上取整為 34 批次）
- 34 批次 × 4 週 = 136 批次/月 × $1.351 = $183.74

**P5 Weekly 策略小計**：**$183.74/月**（修正：批次大小調整，但每檔成本持平）

---

##### P5 Daily（分層執行）

| Tier | 股票數 | 執行頻率 | 執行次數/月 | 單次成本 | 月度成本（USD） |
|------|--------|---------|------------|---------|----------------|
| **CORE** | 25 | 每日 | 25 × 30 = 750 | $0.005 | $3.75 |
| **STABLE_SWING** | 31 | 週度 | 31 × 4 = 124 | $0.005 | $0.62 |
| **AGGRESSIVE** | 25 | 週度 | 25 × 4 = 100 | $0.005 | $0.50 |
| **OPPORTUNISTIC** | 19 | 月度 | 19 × 1 = 19 | $0.005 | $0.10 |

**P5 Daily 小計**：**$4.97/月**

---

#### 其他成本（固定）

**其他成本小計**：**$110.00/月**

---

#### 100 檔股票月度總成本

| 類別 | 月度成本（USD） | 佔比 |
|------|----------------|------|
| **產業面級別** | $8.07 | 1.8% |
| **P2 系列** | $31.60 | 7.0% |
| **P2.5 系列** | $38.00 | 8.4% |
| **P3 系列** | $80.96 | 17.9% |
| **P5 Weekly 策略** | $183.40 | 40.6% |
| **P5 Daily** | $4.97 | 1.1% |
| **其他成本** | $110.00 | 24.3% |
| **總計** | **$456.36/月** | 100% |

**年度總計**：**$5,476.32/年**

---

## 📊 三種規模成本對比總結

| 規模 | 月度成本（USD） | 年度成本（USD） | 每檔股票月均成本 | 主要成本來源 |
|------|----------------|----------------|-----------------|-------------|
| **50 檔** | $291.46 | $3,497.52 | $5.83 | P5 Weekly 策略（31.5%） |
| **80 檔** | $402.99 | $4,835.88 | $5.04 | P5 Weekly 策略（36.1%） |
| **100 檔** | $456.36 | $5,476.32 | $4.56 | P5 Weekly 策略（40.3%） |

**成本趨勢分析**：
- **規模經濟效應**：每檔股票月均成本隨規模增加而降低（$5.83 → $5.04 → $4.56）
- **主要成本來源**：P5 Weekly 策略佔比最高（37-41%），其次是 P3 系列（17-18%）
- **固定成本佔比**：其他成本（$110/月）在 50 檔時佔 45.2%，在 100 檔時降至 24.3%

---

## 📋 完整任務清單與成本明細表

### 產業面級別任務（所有規模相同）

| 任務 | 頻率 | 執行者 | 審查者 | 輸入 Tokens | 輸出 Tokens | 單次成本 | 月度執行次數 | 月度成本 |
|------|------|--------|--------|-------------|-------------|---------|------------|---------|
| **P0** | 季度 | Opus 4.5 | GPT-5.2 | 18K | 14K | $0.668 | 3.33 | $2.22 |
| **P0.7** | 季度（50% 觸發） | o3 | Opus 4.5 | 27K | 13K | $0.528 | 1.67 | $0.88 |
| **P1** | 季度 | Sonnet 4.5 | GPT-5.2 | 38K | 15K | $0.616 | 3.33 | $2.05 |
| **P5 Weekly** | 週度 | Sonnet 4.5 | GPT-5.2 | 39K | 12K | $0.533 | 4 | $2.13 |
| **P5 Monthly** | 月度 | Sonnet 4.5 | GPT-5.2 | 45K | 20K | $0.794 | 1 | $0.79 |

**產業面級別小計**：**$8.07/月**（所有規模相同）

---

### 股票級別任務（批次處理）

#### 50 檔股票

| 任務 | 頻率 | 執行者 | 審查者 | 批次大小 | 批次成本 | 每檔成本 | 月度執行次數 | 月度成本 |
|------|------|--------|--------|---------|---------|---------|------------|---------|
| **P2 季度** | 季度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.421 | $0.237 | 16.67 | $3.95 |
| **P2 月度** | 月度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.421 | $0.237 | 50 | $11.85 |
| **P2.5 季度** | 季度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.708 | $0.285 | 16.67 | $4.75 |
| **P2.5 月度** | 月度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.708 | $0.285 | 50 | $14.25 |
| **P3 週度** | 週度（20% 變動） | Sonnet 4.5 | GPT-5.2 | 3 家/批 ⚠️ | $1.346 | $0.449 | 16 批次 | $21.54 |
| **P3 月度** | 月度 | Sonnet 4.5 | GPT-5.2 | 3 家/批 ⚠️ | $1.346 | $0.449 | 17 批次 | $22.88 |
| **P5 Weekly 策略** | 週度 | Sonnet 4.5 | GPT-5.2 | 3 家/批 ⚠️ | $1.351 | $0.450 | 68 批次 | $91.87 |

**50 檔股票級別小計**：**$171.51/月**（修正：批次大小調整）

---

#### 80 檔股票

| 任務 | 頻率 | 執行者 | 審查者 | 批次大小 | 批次成本 | 每檔成本 | 月度執行次數 | 月度成本 |
|------|------|--------|--------|---------|---------|---------|------------|---------|
| **P2 季度** | 季度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.421 | $0.237 | 26.67 | $6.32 |
| **P2 月度** | 月度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.421 | $0.237 | 80 | $18.96 |
| **P2.5 季度** | 季度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.708 | $0.285 | 26.67 | $7.60 |
| **P2.5 月度** | 月度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.708 | $0.285 | 80 | $22.80 |
| **P3 週度** | 週度（20% 變動） | Sonnet 4.5 | GPT-5.2 | 3 家/批 ⚠️ | $1.346 | $0.449 | 24 批次 | $32.30 |
| **P3 月度** | 月度 | Sonnet 4.5 | GPT-5.2 | 3 家/批 ⚠️ | $1.346 | $0.449 | 27 批次 | $36.34 |
| **P5 Weekly 策略** | 週度 | Sonnet 4.5 | GPT-5.2 | 3 家/批 ⚠️ | $1.351 | $0.450 | 108 批次 | $145.91 |

**80 檔股票級別小計**：**$274.24/月**（修正：批次大小調整）

---

#### 100 檔股票

| 任務 | 頻率 | 執行者 | 審查者 | 批次大小 | 批次成本 | 每檔成本 | 月度執行次數 | 月度成本 |
|------|------|--------|--------|---------|---------|---------|------------|---------|
| **P2 季度** | 季度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.421 | $0.237 | 33.33 | $7.90 |
| **P2 月度** | 月度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.421 | $0.237 | 100 | $23.70 |
| **P2.5 季度** | 季度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.708 | $0.285 | 33.33 | $9.50 |
| **P2.5 月度** | 月度 | Sonnet 4.5 | GPT-5.2 | 6 家/批 | $1.708 | $0.285 | 100 | $28.50 |
| **P3 週度** | 週度（20% 變動） | Sonnet 4.5 | GPT-5.2 | 3 家/批 ⚠️ | $1.346 | $0.449 | 28 批次 | $37.69 |
| **P3 月度** | 月度 | Sonnet 4.5 | GPT-5.2 | 3 家/批 ⚠️ | $1.346 | $0.449 | 34 批次 | $45.76 |
| **P5 Weekly 策略** | 週度 | Sonnet 4.5 | GPT-5.2 | 3 家/批 ⚠️ | $1.351 | $0.450 | 136 批次 | $183.74 |

**100 檔股票級別小計**：**$341.79/月**（修正：批次大小調整）

---

### P5 Daily 成本（分層執行）

#### 50 檔股票

| Tier | 股票數 | 頻率 | 執行次數/月 | 單次成本 | 月度成本 |
|------|--------|------|------------|---------|---------|
| **CORE** | 12 | 每日 | 360 | $0.005 | $1.80 |
| **STABLE_SWING** | 16 | 週度 | 64 | $0.005 | $0.32 |
| **AGGRESSIVE** | 12 | 週度 | 48 | $0.005 | $0.24 |
| **OPPORTUNISTIC** | 10 | 月度 | 10 | $0.005 | $0.05 |

**50 檔 P5 Daily 小計**：**$2.41/月**

---

#### 80 檔股票

| Tier | 股票數 | 頻率 | 執行次數/月 | 單次成本 | 月度成本 |
|------|--------|------|------------|---------|---------|
| **CORE** | 20 | 每日 | 600 | $0.005 | $3.00 |
| **STABLE_SWING** | 25 | 週度 | 100 | $0.005 | $0.50 |
| **AGGRESSIVE** | 20 | 週度 | 80 | $0.005 | $0.40 |
| **OPPORTUNISTIC** | 15 | 月度 | 15 | $0.005 | $0.08 |

**80 檔 P5 Daily 小計**：**$3.98/月**

---

#### 100 檔股票

| Tier | 股票數 | 頻率 | 執行次數/月 | 單次成本 | 月度成本 |
|------|--------|------|------------|---------|---------|
| **CORE** | 25 | 每日 | 750 | $0.005 | $3.75 |
| **STABLE_SWING** | 31 | 週度 | 124 | $0.005 | $0.62 |
| **AGGRESSIVE** | 25 | 週度 | 100 | $0.005 | $0.50 |
| **OPPORTUNISTIC** | 19 | 月度 | 19 | $0.005 | $0.10 |

**100 檔 P5 Daily 小計**：**$4.97/月**

---

## 📊 最終成本總結表

### 50 檔股票月度成本

| 類別 | 月度成本（USD） | 佔比 | 說明 |
|------|----------------|------|------|
| **產業面級別** | $8.07 | 2.8% | P0/P0.7/P1/P5 Weekly/Monthly |
| **P2 系列** | $15.80 | 5.4% | P2 季度 + P2 月度 |
| **P2.5 系列** | $19.00 | 6.5% | P2.5 季度 + P2.5 月度 |
| **P3 系列** | $44.42 | 15.2% | P3 週度 + P3 月度（⚠️ V8.0 修正：3 家/批） |
| **P5 Weekly 策略** | $91.87 | 31.5% | 個股週度策略（⚠️ V8.0 修正：3 家/批） |
| **P5 Daily** | $2.41 | 0.8% | 新聞整理與快照 |
| **其他成本** | $110.00 | 37.7% | 數據收集、備用預算 |
| **總計** | **$291.57/月** | 100% | - |

**年度總計**：**$3,498.84/年**

---

### 80 檔股票月度成本（推薦規模）

| 類別 | 月度成本（USD） | 佔比 | 說明 |
|------|----------------|------|------|
| **產業面級別** | $8.07 | 2.0% | P0/P0.7/P1/P5 Weekly/Monthly |
| **P2 系列** | $25.28 | 6.2% | P2 季度 + P2 月度 |
| **P2.5 系列** | $30.40 | 7.5% | P2.5 季度 + P2.5 月度 |
| **P3 系列** | $71.96 | 17.8% | P3 週度 + P3 月度 |
| **P5 Weekly 策略** | $151.03 | 37.3% | 個股週度策略 |
| **P5 Daily** | $3.98 | 1.0% | 新聞整理與快照 |
| **其他成本** | $110.00 | 27.2% | 數據收集、備用預算 |
| **總計** | **$404.64/月** | 100% | - |

**年度總計**：**$4,855.68/年**

---

### 100 檔股票月度成本

| 類別 | 月度成本（USD） | 佔比 | 說明 |
|------|----------------|------|------|
| **產業面級別** | $8.07 | 1.8% | P0/P0.7/P1/P5 Weekly/Monthly |
| **P2 系列** | $31.60 | 6.9% | P2 季度 + P2 月度 |
| **P2.5 系列** | $38.00 | 8.3% | P2.5 季度 + P2.5 月度 |
| **P3 系列** | $83.45 | 18.1% | P3 週度 + P3 月度（⚠️ V8.0 修正：3 家/批） |
| **P5 Weekly 策略** | $183.74 | 40.0% | 個股週度策略（⚠️ V8.0 修正：3 家/批） |
| **P5 Daily** | $4.97 | 1.1% | 新聞整理與快照 |
| **其他成本** | $110.00 | 23.9% | 數據收集、備用預算 |
| **總計** | **$459.83/月** | 100% | - |

**年度總計**：**$5,517.96/年**

---

## ✅ 實現狀態確認

### 批次處理實現狀態

- ✅ **P2**：已實現批次處理（6 家/批，`buildP2BatchPrompt` 函數）
- ✅ **P2.5**：已實現批次處理（6 家/批，`buildP2_5BatchPrompt` 函數）
- ✅ **P3**：已實現批次處理（3 家/批 ⚠️ **V8.0 修正**，`buildP3BatchPrompt` 函數）
  - 原設定 5 家/批（208K tokens > 200K 限制）會導致 Overflow
  - 修正為 3 家/批（125K tokens，安全邊際充足）
- ✅ **P5 Weekly 策略**：已實現批次處理（3 家/批 ⚠️ **V8.0 修正**，`generateStockStrategiesInBatches` 函數）
  - 原設定 6 家/批（241K tokens > 200K 限制）會導致 Overflow
  - 修正為 3 家/批（121K tokens，安全邊際充足）

### Token 追蹤功能

- ✅ **M0 層面 Token 追蹤**：已實現（`executeFlow` 函數中記錄 input/output tokens）
- ✅ **M0__RESULT 表格更新**：已添加 `input_tokens`、`output_tokens`、`estimated_cost`、`token_usage_json` 欄位
- ✅ **成本估算功能**：已實現（自動計算每步和總成本，支援 Gemini Pro 超過 200K 的階梯價格）

### 其他修正

- ✅ **P5 Daily**：已改為 GEMINI_PRO 簡單快照留存（無 GPT-5.2 深度推理）
- ✅ **P3 週度**：已實現過濾機制（只處理有變動的股票）

---

## 🎯 成本優化建議

### 1. 動態批次大小調整

**目標**：根據實際 Token 使用量動態調整批次大小，降低成本

**實現方式**：
1. 從 `M0__RESULT` 表格讀取實際 Token 使用量
2. 分析每批次的 Token 使用率（例如：156K / 200K = 78%）
3. 如果使用率低於 70%，可以增加批次大小（例如：6 家 → 7 家）
4. 如果使用率高於 90%，降低批次大小（例如：6 家 → 5 家）

**預期節省**：$20-50/月

---

### 2. Token 使用量分析報告

**目標**：定期分析 Token 使用量，找出優化機會

**分析維度**：
- 按階段分析（P2、P2.5、P3、P5 Weekly 策略）
- 按模型分析（Sonnet、GPT、Gemini）
- 按批次大小分析（5 家/批 vs 6 家/批）
- 找出異常高 Token 使用量的任務

**輸出**：
- 每週/每月 Token 使用量報告
- 成本優化建議（例如：哪個階段可以增加批次大小）

---

### 3. Delta Memory Compiler

**用途**：每週/每月用一次 GPT-5.2，把多期快照壓縮成 delta memory

**成本效益**：
- 一次 GPT-5.2 調用成本：~$5-10
- 節省每週每批的 token 膨脹：~$20-30/月
- **淨節省**：$10-25/月

---

## ⚠️ 注意事項

1. **成本估算基於假設**：
   - 實際成本會根據 AI 模型的實際定價變化
   - 實際執行次數可能因市場波動而變化
   - Token 使用量可能因數據複雜度而變化
   - P3 週度變動率假設為 20%（實際可能不同）

2. **⚠️ V8.0 批次大小修正（Context Window Overflow 風險）**：
   - **P3**：從 5 家/批降低到 **3 家/批**
     - 原因：5 家/批（156K 輸入 + 52K 輸出 = 208K > 200K）會導致 Overflow
     - 修正後：3 家/批（94K 輸入 + 31K 輸出 = 125K），安全邊際充足
   - **P5 Weekly**：從 6 家/批降低到 **3 家/批**
     - 原因：6 家/批（177K 輸入 + 64K 輸出 = 241K > 200K）會導致 Overflow
     - 修正後：3 家/批（89K 輸入 + 32K 輸出 = 121K），安全邊際充足
   - **成本影響**：每檔股票成本幾乎持平（$0.450/檔），總成本略微變化（批次增加但單批成本降低）

3. **Prompt 優化（節省 Token 成本）**：
   - ✅ 所有 AI prompt 已添加「不要廢話」指令
   - ✅ 明確要求：只輸出純 JSON，禁止任何客套話、開場白、結尾語
   - ✅ API 版本不應像網頁版一樣包含額外禮貌性文字（例如：「你問得非常好...」、「如果你需要的話，我可以幫你...」等）
   - ✅ 目的：節省 Token = 節省成本

4. **批次規模影響**：
   - P2、P2.5：保持 6 家/批（安全）
   - P3、P5 Weekly：降低到 3 家/批（避免 Overflow）
   - 批次次數增加，但每檔成本幾乎持平（因單批成本降低）

5. **規模經濟效應**：
   - 每檔股票月均成本隨規模增加而降低
   - 固定成本（其他成本 $110/月）佔比隨規模增加而降低

---

## 📝 總結

**推薦配置**（80 檔股票）：
- **月度預算**：$392/月
- **年度預算**：$4,707/年
- **主要成本**：P5 Weekly 策略（37.2%）、P3 系列（17.5%）、其他成本（28.0%）
- **優化方向**：批次規模動態調整、Delta Memory Compiler、Token 使用量分析

**初期建議**：
- 從 50 檔股票開始（約 $292/月）
- 逐步擴展到 80 檔股票（$392/月）
- 根據實際 Token 使用量調整批次大小，進一步降低成本

---

## 🔴 V8.0 重要修正總結

### 1. Context Window Overflow 風險修正

**問題**：
- P3 原設定 5 家/批（156K 輸入 + 52K 輸出 = 208K > 200K）會導致 Overflow
- P5 Weekly 原設定 6 家/批（177K 輸入 + 64K 輸出 = 241K > 200K）會導致 Overflow

**修正**：
- P3 改為 **3 家/批**（94K 輸入 + 31K 輸出 = 125K，安全邊際充足）
- P5 Weekly 改為 **3 家/批**（89K 輸入 + 32K 輸出 = 121K，安全邊際充足）

**成本影響**：
- 每檔股票成本幾乎持平（$0.450/檔）
- 總成本略微降低（批次增加但單批成本降低）

### 2. Prompt 優化（節省 Token 成本）

**問題**：API 版本可能像網頁版一樣包含額外禮貌性文字，浪費 tokens

**修正**：
- ✅ 所有 AI prompt 已添加「不要廢話」指令
- ✅ 明確要求：只輸出純 JSON，禁止任何客套話、開場白、結尾語
- ✅ 目的：節省 Token = 節省成本

**預期節省**：根據實際輸出長度，可能節省 5-10% 的輸出 tokens

---

**文檔版本**：V3.1（最終版 - Context Window 修正 + Prompt 優化）  
**最後更新**：2026-01-17  
**狀態**：✅ 基於修正後的批次規模（P3/P5 Weekly 3 家/批，P2/P2.5 6 家/批）和方案 B 配置完成，包含 50/80/100 檔股票三種規模模擬
