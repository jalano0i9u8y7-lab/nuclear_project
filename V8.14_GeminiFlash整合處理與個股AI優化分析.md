# V8.14 Gemini Flash 整合處理與個股 AI 優化分析

**日期**：2026-01-19  
**版本**：V8.14

---

## 📋 變更摘要

### 1. Daily 新聞處理模型變更

**變更內容**：
- ✅ 所有 Daily 新聞處理任務（清洗、去重、分類、索引）全部改用 `gemini-3.0-flash`
- ✅ 利用 2M 長窗口特性，一次呼叫完成整合處理（不再分成清洗和去重兩個動作）
- ✅ 採用 Batch Processing 策略，一次處理約 100 則新聞

**技術細節**：
- `GEMINI_FLASH` 配置更新：
  - `model`: `gemini-2.5-flash` → `gemini-3.0-flash`
  - `maxTokens`: `128000` → `2000000` (2M)
- 新增函數：`processNewsBatchWithGeminiFlash()` - 整合處理函數
- 廢棄函數：`atomizeNewsWithGeminiFlash()` 和 `deduplicateAndCategorizeWithGeminiPro()` 保留為向後兼容

---

## 🔍 個股 AI 工作分析：可用 Gemini Flash 的場景

### 當前個股 AI 工作流程

#### P2.5（籌碼面分析）
- **當前模型**：SONNET
- **批次大小**：5 檔股票/批
- **主要任務**：
  1. 分析機構持倉（13F）變化
  2. 分析內部人交易（Insider Trading）
  3. 分析期權流向（Options Flow）
  4. 分析暗池活動（Dark Pool）
  5. 計算 Smart Money Score
  6. 生成投資建議

#### P3（技術面分析）
- **當前模型**：SONNET
- **批次大小**：5 檔股票/批
- **主要任務**：
  1. 分析技術指標（RSI, MACD, ATR, MA 等）
  2. 識別技術形態和信號
  3. 整合機構級視角（籌碼面數據）
  4. 生成技術分析結論
  5. 生成交易建議

---

## 💡 可用 Gemini Flash 的場景分析

### ✅ 適合使用 Gemini Flash 的場景（推理要求較低）

#### 1. **數據提取和標準化**（P2.5 和 P3）
- **任務**：從原始數據中提取關鍵信息並標準化格式
- **推理要求**：低（主要是模式匹配和格式化）
- **當前實現**：可能在數據收集階段完成
- **優化潛力**：⭐⭐⭐
- **建議**：
  - 如果原始數據格式不統一，可以用 Gemini Flash 進行批量標準化
  - 例如：統一 13F 數據格式、標準化期權數據格式

#### 2. **初步數據驗證和過濾**（P2.5 和 P3）
- **任務**：過濾明顯無效或異常的數據
- **推理要求**：低（主要是規則檢查）
- **當前實現**：可能在數據收集階段完成
- **優化潛力**：⭐⭐
- **建議**：
  - 使用 Gemini Flash 批量檢查數據完整性
  - 例如：檢查技術指標是否在合理範圍內、檢查籌碼數據是否異常

#### 3. **數據摘要和關鍵信息提取**（P2.5 和 P3）
- **任務**：從大量原始數據中提取關鍵信息，生成簡要摘要
- **推理要求**：中低（需要理解數據，但不需要深度分析）
- **當前實現**：由 SONNET 在分析階段完成
- **優化潛力**：⭐⭐⭐⭐
- **建議**：
  - **P2.5 場景**：使用 Gemini Flash 批量提取每檔股票的關鍵籌碼信息摘要
    - 例如：從 13F 數據中提取「機構增持/減持趨勢」
    - 例如：從期權數據中提取「異常期權活動摘要」
  - **P3 場景**：使用 Gemini Flash 批量提取每檔股票的關鍵技術信號摘要
    - 例如：從技術指標中提取「關鍵技術形態」
    - 例如：從價格行為中提取「支撐/阻力位」

#### 4. **多檔股票初步篩選**（P2.5 和 P3）
- **任務**：從大量股票中篩選出需要深度分析的候選
- **推理要求**：中低（需要判斷，但不需要深度分析）
- **當前實現**：可能由 P2 完成（Tier 分配）
- **優化潛力**：⭐⭐⭐
- **建議**：
  - 使用 Gemini Flash 批量處理 50-100 檔股票，快速篩選出需要深度分析的候選
  - 例如：根據技術指標快速篩選「突破候選」、「回調候選」
  - 例如：根據籌碼數據快速篩選「機構關注候選」

### ❌ 不適合使用 Gemini Flash 的場景（推理要求較高）

#### 1. **深度分析和策略生成**（P2.5 和 P3）
- **任務**：生成投資建議、策略建議
- **推理要求**：高（需要綜合多個因素，進行深度推理）
- **當前模型**：SONNET（適合）
- **建議**：繼續使用 SONNET

#### 2. **複雜邏輯判斷和風險評估**（P2.5 和 P3）
- **任務**：評估風險、判斷市場狀態
- **推理要求**：高（需要複雜邏輯推理）
- **當前模型**：SONNET（適合）
- **建議**：繼續使用 SONNET

---

## 🎯 推薦優化方案

### 方案一：兩階段處理（推薦）

**階段一：Gemini Flash 批量預處理**
- 使用 Gemini Flash 3.0（2M 窗口）批量處理 50-100 檔股票
- 任務：
  1. 數據提取和標準化
  2. 關鍵信息摘要
  3. 初步篩選（標記需要深度分析的候選）

**階段二：SONNET 深度分析**
- 只對階段一篩選出的候選進行深度分析
- 批次大小可以增加到 10-20 檔（因為已經過預處理）

**預期效果**：
- 減少 SONNET 需要處理的股票數量（從 100 檔減少到 20-30 檔）
- 提高整體處理速度
- 降低成本（Gemini Flash 成本遠低於 SONNET）

### 方案二：混合處理

**對於簡單任務**：
- 使用 Gemini Flash 批量處理（50-100 檔/批）
- 例如：數據標準化、初步篩選

**對於複雜任務**：
- 使用 SONNET 深度分析（5-10 檔/批）
- 例如：策略生成、風險評估

---

## 📊 預期效益

### Daily 新聞處理
- ✅ **處理速度**：從 2 次 API 呼叫減少到 1 次（整合處理）
- ✅ **批次大小**：從 20 筆增加到 100 筆（利用 2M 窗口）
- ✅ **成本**：Gemini Flash 成本遠低於 Gemini Pro

### 個股 AI 工作（如果實施方案一）
- ✅ **處理速度**：預處理階段可以批量處理 50-100 檔
- ✅ **深度分析**：只對篩選出的候選進行深度分析，減少工作量
- ✅ **成本**：Gemini Flash 預處理成本低，整體成本降低

---

## ⚠️ 注意事項

1. **推理能力限制**：Gemini Flash 推理能力較弱，不適合深度分析任務
2. **品質驗證**：需要測試 Gemini Flash 處理品質，確保不影響最終分析結果
3. **批次大小調整**：根據實際效果調整批次大小（從 100 開始測試）

---

## 🔄 實施順序

1. ✅ **Daily 新聞處理**：已完成（V8.14）
2. ⏳ **個股 AI 優化**：待實施（需要進一步分析具體場景）

---

**此文檔定義了 V8.14 的模型變更和個股 AI 優化方向。**
