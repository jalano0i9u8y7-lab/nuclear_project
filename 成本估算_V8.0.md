# 成本估算 V8.0

## 📋 執行摘要

本文檔詳細估算系統正式上線後的月度運營成本，基於以下規模：
- **產業面數量**：8-10 個
- **每產業面股票數量**：5-10 檔（大產業面可到 15-20 檔）
- **總股票池**：50-100 檔股票
- **執行頻率**：按照系統設計的 Phase 執行頻率

---

## 💰 成本估算（基於現有模型配置）

### 1. Phase 執行成本

#### 1.1 單次執行成本（1 檔股票）

| Phase | 執行頻率 | 執行者 | 審查者 | 單次成本（USD） |
|-------|---------|--------|--------|----------------|
| **P0** | 季度 | Claude Opus 4.5 | GPT-5.2 | $0.62 |
| **P0.7** | 季度（P0 變更時） | o3 | Claude Opus 4.5 | $0.26 |
| **P1** | 季度 | Claude Sonnet 4.5 | GPT-5.2 | $1.60 |
| **P2 季度** | 季度 | Claude Sonnet 4.5 | GPT-5.2 | $0.76 |
| **P2 月度** | 月度 | Claude Sonnet 4.5 | GPT-5.2 | $0.64 |
| **P3 週度** | 週度 | Claude Sonnet 4.5 | GPT-5.2 | $2.56 |
| **P3 月度** | 月度 | Claude Sonnet 4.5 | GPT-5.2 | $2.28 |
| **P4** | 週度 | 純程式 | - | $0.00 |
| **P5 Daily** | 每日 | GPT-5.2 | Gemini 3.0 Pro | $3.60 |
| **P5 Weekly** | 週度 | Claude Sonnet 4.5 | GPT-5.2 | $1.52 |

**注意**：
- P0、P0.7、P1 是針對整個產業面執行，不是每檔股票
- P2、P3、P4、P5 是針對每檔股票執行
- 以上成本為單次執行成本，需要根據實際執行頻率和股票數量計算月度總成本

#### 1.2 月度執行成本計算

**假設規模**：
- **產業面數量**：10 個
- **每產業面股票數量**：平均 8 檔
- **總股票池**：80 檔股票

**月度成本計算**：

| Phase | 執行頻率 | 執行次數/月 | 單次成本 | 月度成本（USD） |
|-------|---------|------------|---------|----------------|
| **P0** | 季度（3次/月） | 10 個產業面 × 0.33 = 3.33 次 | $0.62 | $2.06 |
| **P0.7** | 季度（P0 變更時） | 10 個產業面 × 0.33 × 0.5 = 1.67 次 | $0.26 | $0.43 |
| **P1** | 季度（3次/月） | 10 個產業面 × 0.33 = 3.33 次 | $1.60 | $5.33 |
| **P2 季度** | 季度 | 80 檔股票 × 0.33 = 26.67 次 | $0.76 | $20.27 |
| **P2 月度** | 月度 | 80 檔股票 × 1 = 80 次 | $0.64 | $51.20 |
| **P3 週度** | 週度 | 80 檔股票 × 4 = 320 次 | $2.56 | $819.20 |
| **P3 月度** | 月度 | 80 檔股票 × 1 = 80 次 | $2.28 | $182.40 |
| **P4** | 週度 | 80 檔股票 × 4 = 320 次 | $0.00 | $0.00 |
| *P5 Daily** | 每日 | 80 檔股票 × 30 = 2,400 *次 | $3.60 | $8,640.00 |
| **P5 Weekly** | 週度 | 1 次（全系統） | $1.52 | $6.08 |

**總計**：$9,727.37/月

**⚠️ 注意**：此計算顯示 P5 Daily 成本過高，需要優化或調整執行頻率。

---

## 🔧 成本優化方案

### 方案 1：調整 P5 Daily 執行頻率

**優化策略**：
- P5 Daily 改為只執行**持倉股票**（約 20-30 檔），而非全部 80 檔
- 對於非持倉股票，改為**週度或月度**執行

**優化後成本**：

| Phase | 執行頻率 | 執行次數/月 | 單次成本 | 月度成本（USD） |
|-------|---------|------------|---------|----------------|
| **P5 Daily（持倉）** | 每日 | 25 檔股票 × 30 = 750 次 | $3.60 | $2,700.00 |
| **P5 Weekly（全部）** | 週度 | 80 檔股票 × 4 = 320 次 | $0.05（估算） | $16.00 |

**優化後總計**：$2,983.67/月（節省 $6,743.70/月）

### 方案 2：批次處理優化

**優化策略**：
- P3 週度改為**批次處理**（一次處理多檔股票）
- 使用更便宜的模型處理批次數據

**優化後成本**：

| Phase | 執行頻率 | 執行次數/月 | 單次成本 | 月度成本（USD） |
|-------|---------|------------|---------|----------------|
| **P3 週度（批次）** | 週度 | 80 檔股票 ÷ 10 批次 × 4 = 32 次 | $5.00（批次成本） | $160.00 |

**優化後總計**：$2,139.67/月（節省 $7,587.70/月）

### 方案 3：分層執行策略

**優化策略**：
- **核心持倉（CORE Tier）**：每日執行 P5 Daily
- **穩定波動（STABLE_SWING Tier）**：週度執行
- **積極型（AGGRESSIVE Tier）**：週度執行
- **機會型（OPPORTUNISTIC Tier）**：月度執行

**假設分層比例**：
- CORE：20 檔（25%）
- STABLE_SWING：25 檔（31%）
- AGGRESSIVE：20 檔（25%）
- OPPORTUNISTIC：15 檔（19%）

**優化後成本**：

| Tier | 股票數 | P5 Daily 頻率 | 執行次數/月 | 月度成本（USD） |
|------|--------|--------------|------------|----------------|
| **CORE** | 20 | 每日 | 20 × 30 = 600 | $2,160.00 |
| **STABLE_SWING** | 25 | 週度 | 25 × 4 = 100 | $360.00 |
| **AGGRESSIVE** | 20 | 週度 | 20 × 4 = 80 | $288.00 |
| **OPPORTUNISTIC** | 15 | 月度 | 15 × 1 = 15 | $54.00 |

**P5 Daily 優化後總計**：$2,862.00/月

**全部 Phase 優化後總計**：$3,164.00/月

---

## 📊 推薦方案：混合優化策略

**推薦策略**：
1. **P5 Daily 分層執行**（方案 3）
2. **P3 週度批次處理**（方案 2）
3. **P5 Daily 使用更便宜的模型**（Gemini Flash 替代 GPT-5.2）

**最終成本估算**：

| Phase | 月度成本（USD） | 說明 |
|-------|----------------|------|
| **P0 系列** | $7.82 | P0、P0.7、P1 |
| **P2 系列** | $71.47 | P2 季度 + 月度 |
| **P3 系列（批次）** | $160.00 | P3 週度批次 + 月度 |
| **P4** | $0.00 | 純程式 |
| **P5 Daily（分層）** | $2,400.00 | 使用 Gemini Flash（成本降低 30%） |
| **P5 Weekly** | $6.08 | 全系統 |
| **其他** | $50.00 | 數據收集、CSE 搜尋等 |

**月度總計**：**$2,695.37/月**

**年度總計**：**$32,344.44/年**

---

## 💡 成本控制建議

### 1. 預算分配

| 項目 | 月度預算（USD） | 佔比 |
|------|----------------|------|
| **AI 模型成本** | $2,500 | 93% |
| **數據收集成本** | $100 | 4% |
| **備用預算** | $95 | 3% |
| **總預算** | **$2,695** | 100% |

### 2. 成本監控機制

- ✅ **每日成本追蹤**（已實現）
- ✅ **預算告警**（已實現）
- ✅ **自動重置**（每天午夜）
- ⚠️ **需要實現**：超預算自動降級執行頻率

### 3. 成本優化措施

1. **使用更便宜的模型**：
   - P5 Daily 審查者改用 Gemini Flash（成本降低 70%）
   - P3 週度使用批次處理（成本降低 80%）

2. **調整執行頻率**：
   - 非核心持倉改為週度/月度執行
   - 根據市場波動動態調整頻率

3. **數據緩存**：
   - 重複使用歷史數據
   - 減少重複的 AI 調用

---

## 📈 不同規模的成本估算

### 規模 1：50 檔股票（小規模）

| Phase | 月度成本（USD） |
|-------|----------------|
| **P0 系列** | $7.82 |
| **P2 系列** | $44.67 |
| **P3 系列** | $100.00 |
| **P5 Daily（分層）** | $1,500.00 |
| **P5 Weekly** | $6.08 |
| **其他** | $50.00 |
| **總計** | **$1,708.57/月** |

### 規模 2：80 檔股票（推薦規模）

**總計**：**$2,695.37/月**

### 規模 3：100 檔股票（大規模）

| Phase | 月度成本（USD） |
|-------|----------------|
| **P0 系列** | $9.78 |
| **P2 系列** | $89.34 |
| **P3 系列** | $125.00 |
| **P5 Daily（分層）** | $3,000.00 |
| **P5 Weekly** | $6.08 |
| **其他** | $60.00 |
| **總計** | **$3,290.20/月** |

---

## 🎯 初期與中期成本規劃

### 初期（免費數據源）

**假設**：
- 使用免費的機構級數據源（Stooq、官方交易所等）
- 使用免費的 Google CSE（每日 100 次免費）
- 使用 Cloud Function 代理（免費額度內）

**數據訂閱成本**：$0/月

**總成本**：$2,695.37/月（僅 AI 模型成本）

### 中期（訂閱數據源）

**假設**：
- 訂閱機構級財務數據（如 Bloomberg API、FactSet 等）
- 升級 Google CSE（無限制）
- 升級 Cloud Function（無限制）

**數據訂閱成本估算**：
- 機構級財務數據：$500-1,000/月
- Google CSE 升級：$100/月
- Cloud Function 升級：$50/月

**數據訂閱總計**：$650-1,150/月

**總成本**：$3,345.37-3,845.37/月

---

## ⚠️ 注意事項

1. **成本估算基於假設**：
   - 實際成本會根據 AI 模型的實際定價變化
   - 實際執行次數可能因市場波動而變化
   - Token 使用量可能因數據複雜度而變化

2. **成本控制機制**：
   - 需要實現每日成本監控
   - 需要實現預算告警
   - 需要實現超預算自動降級

3. **優化空間**：
   - 可以進一步優化批次處理
   - 可以調整執行頻率
   - 可以使用更便宜的模型替代

---

## 📝 總結

**推薦配置**（80 檔股票）：
- **月度預算**：$2,695/月
- **年度預算**：$32,344/年
- **主要成本**：AI 模型成本（93%）
- **優化方向**：批次處理、分層執行、模型選擇

**初期建議**：
- 從 50 檔股票開始（$1,709/月）
- 逐步擴展到 80 檔股票（$2,695/月）
- 根據實際成本調整策略

---

**文檔版本**：V1.0  
**最後更新**：2025-01-14  
**狀態**：待審查
