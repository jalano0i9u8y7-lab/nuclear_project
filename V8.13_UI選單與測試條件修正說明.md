# V8.13 UI選單與測試條件修正說明

**日期**：2026-01-19  
**問題**：UI選單沒有變動，測試條件需要確認

---

## ✅ 已修正項目

### 1. UI選單修正

**檔案**：`src/25_UI_MAIN.js`

**修正內容**：
- ✅ 已將三個測試按鍵從子選單改為獨立按鍵：
  - `🧪 數據源測試（Daily市場數據）`
  - `📰 一般新聞源測試（一般當日新聞）`
  - `⭐ 機構評級源測試（機構評級新聞）`

**注意**：Google Apps Script需要重新載入才能看到新的選單。請：
1. 重新打開Google Sheets
2. 或者刷新頁面（F5）
3. 或者重新執行`onOpen()`函數

---

### 2. 測試條件設定

#### A. 一般新聞源測試（P5 NEWS）

**檔案**：`src/25_UI_DATA_SOURCE_TEST.js` → `menuTestDailyNews()`

**測試條件**（已設定）：
- ✅ **時效性**：測試模式放寬到前一天（`isTestMode: true`）
- ✅ **收集數量**：英文50則、中文25則、日文25則（已在`collectRawNews`中設定）
- ✅ **測試模式標記**：已加入Logger日誌，顯示測試模式設定

**實施位置**：
- `src/24_P5_DAILY_NEWS.js` → `collectRawNews()`：時效性放寬到前一天
- `src/24_P5_DAILY_NEWS.js` → `atomizeNewsWithGeminiFlash()`：時效性放寬到前一天

#### B. 機構評級源測試（P5 Ratings）

**檔案**：`src/25_UI_DATA_SOURCE_TEST.js` → `menuTestInstitutionalRatings()`

**測試條件**（已設定）：
- ✅ **時效性**：測試模式不限制時效性（`isTestMode: true`）
- ✅ **測試股票**：10檔隨機股票（美股5檔、台股3檔、日股2檔）
- ✅ **測試模式標記**：已加入Logger日誌，顯示測試模式設定

**實施位置**：
- `src/24_P5_DAILY_INSTITUTIONAL_RATINGS.js` → `collectInstitutionalRatings()`：接收`isTestMode`參數
- `src/24_P5_DAILY_INSTITUTIONAL_RATINGS.js` → `collectRatingsForTicker()`：接收`isTestMode`參數並傳遞
- `src/24_P5_DAILY_INSTITUTIONAL_RATINGS.js` → `buildRatingQueries()`：測試版已移除"today"等日期限制

---

## 📝 測試條件確認清單

### 一般新聞源測試
- [x] 時效性放寬到前一天（`isTestMode: true`）
- [x] 收集數量：英文50則、中文25則、日文25則
- [x] Flash清洗：雜訊過濾、時效性檢查（測試模式放寬）
- [x] Gemini Pro：多語去重、多維度標籤分類
- [x] 驗證機制：數據驗證、Proxy驗證
- [x] 個股索引：建立反向索引

### 機構評級源測試
- [x] 時效性：不限制（`isTestMode: true`）
- [x] 測試股票：10檔隨機股票（美股5檔、台股3檔、日股2檔）
- [x] Flash清洗：雜訊過濾（不限制時效性）
- [x] Gemini Pro：多語去重
- [x] 機構名稱標準化
- [x] 評級動作標準化
- [x] 個股索引：建立反向索引

---

## ⚠️ 注意事項

1. **UI選單重新載入**：
   - Google Apps Script需要重新載入才能看到新的選單
   - 請重新打開Google Sheets或刷新頁面

2. **測試模式確認**：
   - 所有測試函數都已正確設定`isTestMode: true`
   - Logger日誌會顯示測試模式設定，方便確認

3. **時效性處理**：
   - NEWS測試：時效性放寬到前一天
   - Ratings測試：不限制時效性（允許收集非當日評級）

---

## 🚀 下一步

請重新載入Google Apps Script，然後執行測試：
1. 重新打開Google Sheets
2. 點擊選單：`🚀 Nuclear Project` → `📰 一般新聞源測試（一般當日新聞）`
3. 查看Logger日誌，確認測試模式設定正確
4. 執行測試並回傳結果
