# 全系統 AI 工作紀錄（V8.0）

**目的**：為 GAS → Python 改寫做準備，將主程式碼中所有會用到 AI 模型的地方，按 Phase 整理：工作內容、對齊目標、目前寫好的 Prompt 位置與要點。

**最後更新**：2026-01-26（⭐ V8.31 憲法補丁；⭐ V8.32 DSFP 定案並納入 SSOT）  
**對應 SSOT**：`V8.0架構定案文檔_SSOT.md`  
**相關文檔**：`各階段Prompt補強參考_2026-01-26.md`、`定案用檢查清單_2026-01-26.md`、`DSFP身份動態化原則_討論整理_待定案.md`

---

## 一、總覽：AI 調用架構

- **統一入口**：所有 Phase 的 AI 調用皆經由 **M0__JOB_QUEUE**，由 `03_M0_CORE.js` 的 `M0_Execute()` 執行；P0–P5 不直接呼叫各 Provider API。
- **API 路由** ⭐ V8.29：除 **o3**（Batch 維持 OpenAI API 直連）外，**其餘模型一律經 OpenRouter API**；M0 保留統一路由層（Job 隊列、重試、Token、審查觸發、Batch 提交），內部為 OpenRouter Adapter + OpenAI 直連 Adapter（僅 o3）。
- **雙模型流程**：多數 Phase 為「執行者（Analyst）+ 第一層審查（Scout）」；當 Analyst 與 Scout **明顯分歧**時觸發 **Deep Auditor（一律 o3）** 產出該 Phase 最終結論（覆寫）。若 Scout 僅補強則不觸發。**無 Scout/Deep Auditor**：P0.7、P2-1、P5 Daily D-1～D-4。
- **模型配置**：`02_M0_CONFIG.js` 的 `TASK_TO_EXECUTOR`、`getAuditor()`（Scout）、Deep Auditor 觸發邏輯；Batch 適用性見 `shouldUseBatch(projectId)`。
- **憲法與 Prompt 強化** ⭐ V8.29/V8.31：系統最高總則六條（**1. 未來可驗證**—產物以未來可驗證為終點，輸出 1～3 關鍵驗證訊號+時間窗口；2. 未來優先；3. 市場視角高於真相；4. 因果鏈完整性；5. 反敘事義務；6. 角色即主力）；各 Phase Prompt 最前「角色校準器」、最後「未來對齊三問」；P4 心法「約束範圍、風險下限」、P5 心法「機率校準器」。**Daily 史官鐵律**：D-3/D-4 不得改寫歷史，僅能追加 delta/link/tag/branch，保留舊 evidence。詳見 `各階段Prompt補強參考_2026-01-26.md`。
- **動態現況優先原則（DSFP）** ⭐ V8.32：任何金融商品判斷不得依賴歷史標籤、必須依賴當前狀態（五模組：價格位置、流動性、衍生品槓桿、參與者結構、規則機制）。**Daily** 只標記（IDENTITY_SHIFT_SIGNALS、EVENT_CLUSTER_UPDATE、WEEKLY_ESCALATION_HINT），不裁決身份。**Weekly** 身份裁決；≥3 項顯著變化 → IDENTITY_DRIFT = TRUE；Weekly 下修信任/提升風險/身份轉變說明，P4 降 U 增現金。⭐ V8.30 目標架構下 **WB-1** 為 DSFP 身份裁決執行層（對關鍵資產做 DSFP-5 判斷，產出 asset_identity_map、framework_stability_score 等）。各 Phase 加強塊、GLOBAL_SYSTEM_BLOCK_DSFP_V1 見 SSOT「DSFP 五模組與全 Phase 植入規範」。

---

## 二、按 Phase 的 AI 工作紀錄

### 1. P0（產業工程學分析）

| 項目 | 內容 |
|------|------|
| **執行頻率** | 季度 |
| **執行者** | Claude Opus 4.5 |
| **Scout（第一層審查）** | GPT-5.2；分歧時 **Deep Auditor o3** |
| **是否 Batch** | 否（單一巨上下文） |
| **工作內容** | 建立「必然位置表」：找出未來 3–10 年在物理/工程與制度/通道/流程層面不可或缺且難以被 scale 替代的 Theme/Subtheme；P0-ENG 工程必然分析、P0-STRUCT 結構性定價權分析；輸出 problem_oneliner、failure_mode、no_alternative_reason、convergence_evidence、long_term_time_window；時效性防呆：產出 validation_questions，供後續 Gemini 讀取 PDF 驗證。 |
| **對齊目標** | 不選股、只產出必然位置表；兩大類都要找（工程瓶頸 + 定價權獨佔）；允許說「沒有」時明確輸出 "This is NOT a valid structural theme"；測試模式可簡化為 2 個面向（1 工程 + 1 結構）。 |
| **Prompt 位置** | `09_P0_INDUSTRY_ENGINEERING.js` → `buildP0Prompt(userInput, context)` |
| **Prompt 要點** | 角色：產業工程學分析師（⭐ 校準器：未來節點掃描）；Phase 0 目標是建立必然位置表；P0-2 分析模組固定順序（P0-ENG A–E、P0-STRUCT）；P0-3 強制輸出五項缺一不可；P0-4 否決檢查；輸出 JSON（themes, subthemes）；時效性防呆：列出內建知識不足而必須查核的關鍵問題、資料來源、審查標準；**最後**未來對齊三問。 |
| **Scout / Deep Auditor** | Scout 發現分析框架盲點與視角偏差；輸出 Critique/Discovery、Most_Probable_Alternative、Weight_Sensitivity、Hidden_Signal_Candidates、Decisive_Tests；分歧時 Deep Auditor o3 產出最終結論（覆寫）。 |

---

### 2. P0 時效性驗證（Gemini 讀取 PDF + OPUS 重新分析）

| 項目 | 內容 |
|------|------|
| **觸發** | P0 第一次分析後，OPUS 產出 validation_questions；人工下載 PDF 至 Google Drive。 |
| **AI 使用** | ① Gemini File API 讀取 PDF，提取相關原文段落（附頁數）；② OPUS 重新分析（標明問題已解決 + 資料來源 + 影響：支持/中立/修正）；③ GPT-5.2 審查。 |
| **對齊目標** | 確保 P0 分析基於可驗證的最新資料；審查標準：來源權威性、時效性、引用精確度。 |
| **Prompt 位置** | `09_P0_VALIDATION.js` → `buildP0ReanalysisPrompt(initialAnalysis, validationResults)`；Gemini 調用為 File API 讀取 PDF，非 M0 隊列。 |

---

### 3. P0.5（產業鏈地圖 / 供應鏈情報）

| 項目 | 內容 |
|------|------|
| **執行頻率** | Mode 1 季度；Mode 2 台股月度（每月 12 號）、美日股季度 |
| **執行者** | Claude Opus 4.5 |
| **審查者** | GPT-5.2 |
| **是否 Batch** | Mode 2 適用 Batch（各產業獨立） |
| **工作內容** | **Mode 1**：把 P0 必然性翻譯成產業鏈結構圖（上中下游、瓶頸、定價權、單點失效、資金流/訂單流）；**Mode 2**：Chain Dynamics Monitor，三階段推理（產業生態識別 → 上中下游行為抽象 → 一致性與異常推演），輸出 chain_dynamics_monitor_json（meta / signals / diagnosis / handoff）；**V8.18**：瓶頸轉移觀測（current_bottleneck、easing_signals、next_bottleneck_candidates），僅觀測、禁止引用股價/新聞。 |
| **對齊目標** | 只畫地圖（Mode 1）、只做偵測與推演（Mode 2）；不下投資結論、不做時間定位（Early/Mid/Late 屬 P0.7）；節點標註 investment_relevance（INVESTABLE_CHOKEPOINT / SUPPORTING_NODE / CONTEXT_ONLY）。 |
| **Prompt 位置** | `08_P0_5_INDUSTRY_CHAIN.js` → `buildP0_5Prompt(p0Output, context)`（Mode 1）、`buildChainDynamicsPrompt(p0Output, chainBehaviorData, p0_7TimeWindowConstraints, context)`（Mode 2） |
| **Prompt 要點** | 角色：結構翻譯器；職權邊界（可做/禁止）；輸入 P0 輸出；任務 1–6（節點拆解、瓶頸/定價權/單點失效、強化不可替代性、風險、資金流與訂單流、投資相關性標籤）；V8.18 瓶頸轉移觀測格式；不確定性聲明補丁；輸出 industry_chain_maps 或 chain_dynamics_monitor_json。 |

---

### 4. P0.7（系統動力學驗證）

| 項目 | 內容 |
|------|------|
| **執行頻率** | 季度 |
| **執行者** | O3 |
| **審查者** | Claude Opus 4.5 |
| **是否 Batch** | 否（因果循環、單一巨上下文） |
| **工作內容** | 在 P0 必然性確認後，用系統動力學裁決：時間序位置（Early/Mid/Late/Transition）、迴路主導（R/B/Mixed）、槓桿點角色類型；輸出 dynamic_problem_oneliner、loop_dominance、time_position、leveraged_role_type、risk_note；敘事與結構錯位檢查；時間漂移防護（相對 P0 必然性，不受短期宏觀噪音影響）。 |
| **對齊目標** | 純學術、不包含籌碼面；輸出為「公司類型」而非公司名；不確定時明確標註、不填補空白。 |
| **Prompt 位置** | `19_P0_7_SYSTEM_DYNAMICS.js` → `buildP0_7Prompt(userInput, p0Output)` |
| **Prompt 要點** | 角色：系統動力學分析師；P0.7-2 概念（R/B 迴路）；P0.7-3 分析模組固定順序（動態性問題定義、Stocks/Flows、CLD 裁決、時間序位置、槓桿點角色類型、錯位檢查）；P0.7-4 強制輸出五項；全系統補丁（不確定性聲明）；輸出 JSON。 |

---

### 5. P1 Step 1（股票池生成）

| 項目 | 內容 |
|------|------|
| **執行頻率** | 季度（與 P0/P0.5/P0.7 同步） |
| **執行者** | Gemini Flash 3.0 |
| **審查者** | 無（純提取/蒐集） |
| **是否 Batch** | 是 |
| **工作內容** | 僅做資料蒐集：依 P0/P0.5/P0.7 產出 15–30 檔公司清單（美:台:日 建議 5:3:2）；只選映射到 P0.5 INVESTABLE_CHOKEPOINT 的公司；結構性角色 A/B/C；市場限制僅 US/JP/TW；不分析、不判斷產業鏈位置、不獵殺舊技術龍頭。 |
| **對齊目標** | Gate Clause：僅選 INVESTABLE_CHOKEPOINT；錯殺保護：不確定時優先 EXCLUDE，最多 3 個 borderline 並說明；精確而非詳盡。 |
| **Prompt 位置** | `20_P1_V8_14.js` → `buildP1Step1Prompt(userInput, p0Output, p0_5Output, p0_7Output)` |
| **Prompt 要點** | 角色：資料蒐集員；SSOT 唯一權威為 P0；符合條件標準（結構性瓶頸/定價權/依賴錨點）；供應鏈包含規則、排除規則、市場限制、輸出格式（company_pool + summary）；不確定性聲明補丁。 |

---

### 6. P1 財報提取（Flash 三欄位）

| 項目 | 內容 |
|------|------|
| **觸發** | Step 1 完成後財報下載；美股自動抓 SEC；台/日股人工放 PDF 後掃描。 |
| **執行者** | Gemini Flash（如 gemini-2.5-flash-lite / gemini-3-flash-preview） |
| **審查者** | 無 |
| **工作內容** | 讀取財報（PDF/HTML），原封不動提取三段：P1_Industry_Evidence、P2_Financial_Evidence、P3_Technical_Evidence；每段附 page_number、filing_period、context；禁止分析與計算。 |
| **對齊目標** | 法醫級提取、NO Analysis、NO Hallucination、Verbatim & Citation；分離三欄位對應 P1/P2/P3 下游。 |
| **Prompt 位置** | `20_P1_FINANCIAL_REPORTS.js` → `buildFinancialReportExtractionPrompt(ticker, market, filingPeriod)`；直接呼叫 Gemini generateContent，不經 M0。 |
| **Prompt 要點** | Role: Forensic Data Extractor；Iron Rules（不詮釋、不改字、原文+前後文、頁數、三組分離）；Extraction Scope（Group 1/2/3 對應 P1/P2/P3）；Output 嚴格 JSON（p1_industry_evidence, p2_financial_evidence, p3_technical_evidence）。 |

---

### 7. P1 Step 2（結構分級）

| 項目 | 內容 |
|------|------|
| **執行頻率** | 季度（Step 1 與財報提取完成後） |
| **執行者** | Gemini Pro 3.0 |
| **Scout** | Llama 3.3 70B ⭐ V8.29；分歧時 **Deep Auditor o3** |
| **是否 Batch** | 否（與 Step 1 順序依賴） |
| **工作內容** | 讀取 Flash 的 P1/P2/P3 證據，做產業鏈位置定位、主動獵殺舊技術龍頭、Tier S/A/B/X 分級、受益/受害機制；繼承 P0+P0.5+P0.7，禁止用財務績效/估值/技術/股價做分級。 |
| **對齊目標** | Rerate_State 僅能由 P0/0.7/1 裁決；禁止用 P3 技術面改判 R；輸出寫入 Phase1_Company_Pool。 |
| **Prompt 位置** | `20_P1_V8_14.js` → `buildP1Step2Prompt(companyPool, financialReportData, p0Output, p0_5Output, p0_7Output)` |
| **Scout / Deep Auditor** | Scout 須對照 Flash 財報資料驗證 Tier、產業鏈定位、受益/受害機制；分歧時 Deep Auditor o3 產出最終結論。 |

---

### 8. P2（基本面財務分析）⭐ V8.29 拆為 P2-1（事實建模）+ P2-2（因果推演）

| 項目 | 內容 |
|------|------|
| **執行頻率** | P2_MONTHLY / P2_QUARTERLY |
| **P2-1（事實建模）** | **執行者** DeepSeek V3 (671B)；**Scout** Llama 3.3 70B；**無 Deep Auditor**。任務：財報表/註解/管理層說明分類；安全性/成長性/潛力突破指標及初步解釋；**中性、不推論、不編敘事**；同業比較 Stage 1、財務數據抓取與一致性、Growth Quality、Safety Score、FPE A/B、P1 財報段落抽取；**只產出分數**。產出寫入中間表 **P2_1_FACT_MODEL**。 |
| **P2-2（因果推演）** | **執行者** Hermes 4；**Scout** o3 batch；分歧時 **Deep Auditor o3**。任務：因果鏈統整、權重與主導變數、Base/Bull/Bear 前瞻推演、會計與財務工程拆彈、產業鏈與循環位置、Step 0 產業邏輯注入（讀取 P0/P1 邏輯卡）、Mispricing Map；**Gate、Track、6 類、Milestones to Verify** 均在 P2-2。僅 P2-2 寫入對外 **Phase2_Output**。 |
| **對齊目標** | 同業定義為相同細分產業、同規模分類；Gate 基於同業比較；Safety 硬門檴、Growth/Future 決定上限；三軸獨立評估、不互相補償；Runway &lt; 4 季 Frontier 硬門檴。 |
| **Prompt 位置** | P2-1：新建或 `21_P2_FACT_MODEL.js`；P2-2：`21_P2_FUNDAMENTAL_ANALYSIS.js`（或拆分後對應模組）→ `buildP2Prompt`、`buildP2BatchPrompt`、`buildP2SystemBlocks()`、`buildP2UserPayloadForBatch()` |
| **Prompt 要點** | P2-1：僅事實、不推論、不編敘事、不判斷好壞；P2-2：未來經營狀態預測者、因果鏈、三路徑、產業邏輯卡 Step 0；P2-2 輸出 Phase2_Output Schema；角色校準器與未來對齊三問。 |

---

### 9. P2.5（機構級籌碼分析）

| 項目 | 內容 |
|------|------|
| **執行頻率** | P2.5_MONTHLY / P2.5_QUARTERLY |
| **執行者** | Claude Sonnet 4.5 |
| **審查者** | GPT-5.2 |
| **是否 Batch** | 是 |
| **工作內容** | 13F 持倉變化、內部人交易、期權活動、Dark Pool、對沖基金 Clone；輸出 Smart_Money_Score 及相關信號；避免過度解讀，無異常時輸出 NO SIGNAL。 |
| **對齊目標** | 籌碼面為因、技術面為果；數據來自 P5 Daily 的 SMART_MONEY_DAILY 等，不自行搜尋。 |
| **Prompt 位置** | `21_P2_5_PROMPT.js` → `buildP2_5Prompt(tickers, smartMoneyData, frequency)`、`buildP2_5BatchPrompt(...)`；`21_P2_5_SMART_MONEY.js` → `buildP2_5StaticSystemBlocks()` |
| **Prompt 要點** | 投資哲學（基本面底、籌碼面因、技術面果）；任務目標五項；V8.17.1 防幻覺（NO SIGNAL）；輸入股票列表與機構/內部人/期權/Dark Pool/Clone 數據；輸出格式與批次分隔規則。 |

---

### 10. P3（技術面與掛單建議）

| 項目 | 內容 |
|------|------|
| **執行頻率** | 週度（由 P5 Weekly 或 P2/P2.5 變動觸發）；僅處理有變動標的 |
| **執行者** | Claude Sonnet 4.5 |
| **審查者** | GPT-5.2（觸發式，約 15–25%） |
| **是否 Batch** | 是 |
| **工作內容** | 機構級預測視角：主力行為解釋、意圖判斷、未來預測；Cat 分類 + Buy/Stop 條件性價格（IF-THEN）；趨勢位階檢查（週線優先、日線驗證、Bull Trap 防禦）；整合 P2.5；risk_overlay_level；迴力鏢/Re-entry、相對強度抗跌；禁止僅輸出「根據 RSI/MACD/均線」等程式即可算的結論。 |
| **對齊目標** | 數據來自 Layer 1 程式計算與 P5 Daily 表格；週線若為派發末端則日線再漂亮也視為誘多；Cat 轉換規則（validateCatTransition）由程式強制。 |
| **Prompt 位置** | `22_P3_AI_ANALYSIS.js` → `buildP3Prompt(frequency, phase2Output, technicalData, smartMoneyData)`、`buildP3BatchPrompt(...)`；`22_P3_CORE.js` → `buildP3StaticSystemBlocks()`、`buildP3UserMessageForBatch()` |
| **審查者 Prompt** | `22_P3_CORE.js` → `buildP3AuditorPrompt(executorOutput, stockData, reviewReasons)`；審查者收到執行者輸出、原始股票數據、觸發原因，驗證 Cat/Buy/Stop 與硬規則。 |
| **Prompt 要點** | 機構級主力分析師；Layer 1 已算好、Layer 2 做判讀；最高等級原則（量大於價、主力行為/意圖/預測）；條件性價格 IF-THEN；數據來源說明（P2 繼承、P2.5 必須整合、Layer 1 結果）；趨勢位階檢查（週線先、日線後、Bull Trap 否決）；禁止僅技術公式結論；批次格式 <<<COMPANY: TICKER>>>。 |

---

### 11. P4（資金分配）

| 項目 | 內容 |
|------|------|
| **AI 使用** | **無**。純計算：讀取 P2/P3 快照，Cat 權重矩陣、U 配置、Tier 映射、Portfolio Correlation Lock、Market Climate Override 等皆為程式邏輯。 |
| **備註** | P4 完成後會觸發「持股財報完整分析」（見下 27_HOLDINGS_EARNINGS_COMPLETE）。 |

---

### 12. P5 Daily（新聞與數據監控）⭐ V8.29 工作拆分 D-1～D-4 + V8.30 第三類輸入「網路文章與討論」

| 項目 | 內容 |
|------|------|
| **輸入總覽** | **第一類**：新聞（白名單 CSE、機構評級）；**第二類**：宏觀數據；**第三類** ⭐ V8.30：**網路文章與討論（網路熱度）**—使用者不定期貼文 + 每日論壇搜尋，產出散戶溫度因子；**絕對權重遠低於**系統與機構/主力結論。 |
| **D-1（grok 4.1 fast）** | **同一模型，分開 Prompt、分開呼叫**，權威新聞與散戶論壇**嚴格分隔、絕不互相汙染**。**D-1A（新聞管線）**：輸入僅權威新聞（白名單 CSE）；新聞專用 Prompt；輸出僅新聞表（`NEWS_ATOMS_DAILY`、`STOCK_NEWS_INDEX_DAILY` 等）。**D-1B（論壇管線）**：輸入僅散戶論壇討論（論壇白名單）；論壇專用 Prompt；輸出僅 `WEB_SENTIMENT_DAILY`（清洗、判讀、去重、分析、散戶溫度計、個股/宏觀索引連結）。grok 以 X 資料訓練最適合判讀散戶語言。**無 Scout/Deep Auditor**。 |
| **D-2～D-4** | D-2 DeepSeek V3：新聞↔個股索引；D-3 Llama 3.3 70B：事件叢/敘事；D-4 Hermes 4：宏觀世界觀。**D-3/D-4 須遵守史官鐵律**（不得改寫歷史、僅追加 delta/link/tag/branch、保留舊 evidence）。**無 Scout/Deep Auditor**。 |
| **第三類：網路文章與討論** ⭐ V8.30 | **來源一（使用者貼文）**：使用者貼上網上討論（UI 待實現）→ AI 判讀、抽取有價值部分、連接個股索引；僅經判讀確認者納入參考因子。**來源二（每日論壇）**：論壇討論文由 **D-1B 論壇管線** 處理（與 D-1A 分開 Prompt、分開呼叫）。 |
| **對齊目標** | 第三類僅作研究散戶追逐趨勢與參考；小型/新創敘事股可適度參考；不取代、不覆寫機構與主力預測。論壇使用白名單。**D-1A / D-1B 絕不混用輸入或輸出。** |
| **Prompt 位置** | **D-1A**：新聞專用 Prompt（如 `buildD1_NewsPrompt`）→ `24_P5_DAILY_NEWS.js` 或等效。**D-1B**：論壇專用 Prompt（如 `buildD1_ForumPrompt`）→ 新建或擴充（論壇輸入 → `WEB_SENTIMENT_DAILY`）。兩次獨立 API 呼叫。使用者貼文：新建或擴充（如 `24_P5_DAILY_USER_PASTE.js`）；D-2～D-4：新建或既有 Daily 模組。 |

---

### 13. P5 Weekly（雙層：P5-B 狀態評估 + P5-A 深度覆審）⭐ V8.30 目標架構：WB-1 / WB-2 / W-A

| 項目 | 內容 |
|------|------|
| **現行** | **P5-B**：執行者 Claude Sonnet 4.5，無審查者（僅 Validator）；Batch；產出 state_vector、parameter_adjustment_vector、escalation_score；Strategy Skeleton 由程式生成，AI 只調參數。**P5-A**：執行者 Claude Opus 4.5，審查者 GPT-5.2（約 10–20%）；Batch；深度覆審與策略調整。 |
| **⭐ V8.30 目標** | **WB-1**：分析 Hermes 4 405B，無審查；宏觀世界觀 + 個股狀態快照與 escalation 判定。**WB-2**：分析 Hermes 4 405B，審查 o3（原廠 batch）；兩類個股（輕度/重度）產出策略與掛單。**W-A**：僅觸發時工作，o3（不 batch）；① 世界觀劇變 審查/重建 ② 個股 escalation 審查報告 → P1–P4 更新 → WB-2 重度。個股 escalation 重跑範圍 P1–P4（不含 P0）。詳見 SSOT V8.30。 |
| **工作內容** | 載入 Learning State、Delta Pack、硬約束/軟引導/自由空間三層決策；基準權重（fundamental/chips/tech/macro/sentiment）與偏差原則；P0 必然性等級動態調整因子權重；P2 安全閘門、反覆矛盾新聞深度思考、逆向投資信號檢測；產出掛單策略（Order DSL）、OCO/保鮮期/財報前清倉等。 |
| **對齊目標** | 越獄防護：只輸出 parameter_adjustment_vector，不輸出絕對價位；Learning constraints override strategy preferences；硬約束不可討論。 |
| **Prompt 位置** | `24_P5_WEEKLY_DUAL_LAYER.js` → `buildP5_BPrompt(batchStockData, context)`、`buildP5_APrompt(batchStockData, context)`、`buildP5_BSystemBlocks()`、`buildP5_BUserPayloadForBatch()`、`buildP5_ASystemBlocks()`、`buildP5_AUserPayloadForBatch()` |
| **Prompt 要點** | CRITICAL RULE：Parameter Adjuster 非 Price Setter；SYSTEM_FLAGS（P0.5）、P6 頻率趨勢；Strategy Skeleton 引用；V8.26 基準權重與調整原則；V8.27 P0 必然性等級權重、P2 安全閘門、反覆矛盾新聞、逆向投資信號；Delta Pack、MISSION_CONSTRAINTS、learning_feedback。 |
| **其他 Prompt** | `24_P5_WEEKLY_PROMPT.js` → `buildP5WeeklyPrompt()`、`buildWorldviewPrompt()`、`buildStockStrategyPrompt()`、`buildP5WeeklyIntegratedPrompt()`；`24_P5_WEEKLY_STOCK_STRATEGY.js` → `buildStockStrategyBatchPrompt()`；`24_P5_WEEKLY_CORE.js` 會組裝整合 Prompt。 |

---

### 14. P5 Monthly / P5 Quarterly

| 項目 | 內容 |
|------|------|
| **執行者** | Claude Sonnet 4.5 |
| **審查者** | GPT-5.2 |
| **工作內容** | 月度/季度回顧、策略比對（上一週/月/季策略 vs 市場實際）、學習日誌與參數校準輸入。 |
| **Prompt 位置** | `24_P5_MONTHLY.js` → `buildP5MonthlyPrompt(data)`、`buildLearningAnalysisPrompt(historicalSnapshots)`；`24_P5_QUARTERLY.js` → `buildP5QuarterlyPrompt(data)` |

---

### 15. 持股財報完整分析（P4 完成後觸發）

| 項目 | 內容 |
|------|------|
| **執行者** | Sonnet 4.5（正式）或 Gemini 2.5 Lite（測試） |
| **工作內容** | 一次產出：過去五年歷史經驗 + 預估今年財報日期；更新 EARNINGS_CALENDAR、EARNINGS_HISTORICAL_EXPERIENCE。 |
| **Prompt 位置** | `27_HOLDINGS_EARNINGS_COMPLETE.js`（呼叫 M0 或同步 API）；`27_EARNINGS_HISTORICAL_EXPERIENCE.js` → `buildEarningsHistoricalExperiencePrompt(ticker, quarter)`；`27_HOLDINGS_EARNINGS_GENERATOR.js` → `buildEarningsDatesPrompt(ticker)`；`27_HOLDINGS_EARNINGS_COMPLETE.js` → `buildSingleTickerPrompt()`、`buildBatchPrompt()` |

---

### 16. 重大財經事件 / 行事曆歷史經驗

| 項目 | 內容 |
|------|------|
| **執行者** | Sonnet 4.5（正式）或 Gemini 2.5 Lite（測試） |
| **工作內容** | 重大財經事件強化分析；行事曆歷史經驗生成（五年市場反應等）。 |
| **Prompt 位置** | `18_P5_CALENDAR_MANAGER.js` → `buildCalendarHistoricalExperiencePrompt(event)`；M0 配置：P5_CALENDAR_INTENSIVE_ANALYSIS、CALENDAR_HISTORICAL_EXPERIENCE、EARNINGS_HISTORICAL_EXPERIENCE |

---

### 17. P5 Weekly Learning（策略 vs 實際比對）

| 項目 | 內容 |
|------|------|
| **工作內容** | 偏差分析、策略與實際比對（compareStrategyWithReality）；產出學習反饋供 P5-B 使用。 |
| **Prompt 位置** | `24_P5_WEEKLY_LEARNING.js` → `buildDeviationAnalysisPrompt(strategyData, actualData)` |

---

### 18. Scout（第一層審查）/ Deep Auditor（最高層仲裁）/ 事實查證

| 項目 | 內容 |
|------|------|
| **Scout 通用** | ⭐ V8.29：發現分析框架盲點與視角偏差；三職權（框架盲點、權重偏差、敘事與現實不一致）；輸出 Critique/Discovery、Most_Probable_Alternative、Weight_Sensitivity、Hidden_Signal_Candidates、Decisive_Tests。若僅補強、未與 Analyst 明顯分歧則不觸發 Deep Auditor。 |
| **Deep Auditor** | 觸發時一律 **o3**；產出該 Phase **最終結論（覆寫）**：Rebuild the Causal Chain、Scenario Probability Table、Action Under Uncertainty、What Analyst Missed。 |
| **通用審查者 Prompt** | `03_M0_CORE.js` → `buildAuditorPromptWithQuestions(...)`：Scout 須對照原始資料（財務數據、master_candidates、P1 財報、同業、P2 evidence、P2.5、技術指標、snapshot_diff）驗證執行者結論。 |
| **事實查證審查** | `03_M0_CORE.js` → `buildAuditorPromptWithFactCheck(...)`：融合 Gemini 搜尋結果做最終決策。 |
| **P1 Step 2 Scout** | `03_M0_CORE.js` → `buildP1Step2AuditorPrompt(executorOutput, financialReportData, executorQuestions)`：對照 Flash 財報資料驗證結構分級；Scout 為 Llama 3.3 70B。 |

---

## 三、未經 M0 的 AI 調用（直接 API）

| 用途 | 檔案 | 說明 |
|------|------|------|
| P1 財報提取 | `20_P1_FINANCIAL_REPORTS.js` | Gemini generateContent + `buildFinancialReportExtractionPrompt` |
| P0 驗證（PDF 提取） | `09_P0_VALIDATION.js` | Gemini File API 讀取 PDF，提取段落 |
| P5 Daily 新聞 | `24_P5_DAILY_NEWS.js` | Gemini Flash/Pro 原子化、去重、分類（依函數內建或傳入指令） |

其餘 Phase（P0、P0.5、P0.7、P1 Step1/Step2、P2、P2.5、P3、P5 Weekly/Monthly/Quarterly、持股財報、行事曆歷史經驗）均經 M0__JOB_QUEUE + M0_Execute()。

---

## 四、SSOT 與本紀錄對照

- 模型配置與 Batch 適用性：以 `02_M0_CONFIG.js` 與 SSOT「M0 統一 AI 調用」「模型配置表（分析師/審查官總表）」為準；⭐ V8.29 含 Scout/Deep Auditor、P2-1/P2-2、P5 Daily D-1～D-4。
- 各 Phase 職責與禁止事項：以 SSOT 各 Phase 小節為準；本紀錄僅整理「AI 工作內容、對齊目標、Prompt 位置與要點」，供改寫 Python 時不遺漏任何 AI 呼叫與 Prompt 邏輯。
- **各階段 Prompt 補強參考**：`各階段Prompt補強參考_2026-01-26.md`（角色校準器、未來對齊三問、Scout/Deep Audit 補強概念）。
- **定案用檢查清單**：`定案用檢查清單_2026-01-26.md`（定案前逐項勾選）。

---

**文檔結束**
